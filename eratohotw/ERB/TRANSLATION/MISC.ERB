;-------------------------------------------------
;最大幅の定義関数
;-------------------------------------------------
@MAXWIDTH
#FUNCTION
RETURNF STRLENS(DRAWLINESTR)

;-------------------------------------------------
;Shortcut for usual way of handling paging with infinite scroll
;-------------------------------------------------
@PAGE_HANDLE(nCode, nBackPageCode, nCurPage, nFirstPage, nLastPage)
#FUNCTION
#DIM nCode
#DIM nBackPageCode
#DIM nCurPage
#DIM nFirstPage
#DIM nLastPage

RETURNF nCode == nBackPageCode ? ROUND_DECREMENT(nCurPage, nFirstPage, nLastPage) # ROUND_INCREMENT(nCurPage, nFirstPage, nLastPage)

;-------------------------------------------------
;指定範囲内で数値をインクリメントさせる関数
;-------------------------------------------------
@ROUND_INCREMENT(OPERAND, MINVAL, MAXVAL)
#FUNCTION
#DIM OPERAND
#DIM MINVAL
#DIM MAXVAL
OPERAND ++
SIF OPERAND > MAXVAL
	OPERAND = MINVAL

RETURNF OPERAND

;-------------------------------------------------
;指定範囲内で数値をインクリメントさせる関数
;-------------------------------------------------
@ROUND_DECREMENT(OPERAND, MINVAL, MAXVAL)
#FUNCTION
#DIM OPERAND
#DIM MINVAL
#DIM MAXVAL
OPERAND --
SIF OPERAND < MINVAL
	OPERAND = MAXVAL

RETURNF OPERAND

;----------------------------------------------------------
;ARG行になるまでラインを追加
;----------------------------------------------------------
@EQUATE_LINE, ARG
WHILE LINECOUNT < ARG
	PRINTL 
WEND

;-------------------------------------------------
;ARGを(ARG:1 / 100)倍する
;A = MULTIPLY(A, 150)　は　TIMES A, 1.50　と等しい。
;A = MULTIPLY(A, B)　でB <= 0ならば計算結果はマイナスでなくA*1/100とする。
;-------------------------------------------------
@MULTIPLY(ARG, ARG:1)
#FUNCTION
;0以下の数をかけたときには ARG:1 = 1 とする
SIF ARG:1 <= 0
	ARG:1 = 1
LOCAL = ARG * ARG:1 / 100
RETURNF LOCAL

;-------------------------------------------------
;ARGを(100/ARG:1)倍する
;A = DIVIDE(A, 150)　は　TIMES A, 0.66　と大体等しく、A = A * 100 / 150　と等しい
;A = DIVIDE(A, B)　でB <= 0ならば計算結果は無限やマイナスでなくAのままとなる。
;-------------------------------------------------
@DIVIDE(ARG, ARG:1)
#FUNCTION
;0以下の数では割れない
SIF ARG:1 <= 0
	RETURNF ARG
LOCAL = ARG * 100 / ARG:1
RETURNF LOCAL

;---------------------------------------------------------
;10* larger than usable to simulate decimal
;---------------------------------------------------------
;This is to compensate for the engine's tendency to round numbers toward zero.
@ROUND_NEAREST(ARG:0 = 0, ARG:1 = 0)
#FUNCTION
IF ARG:0 == 0
	RETURNF ARG:0
ELSEIF ARG:1 == 1 || ARG:1 == 0
	RETURNF ARG:0
ELSEIF ARG:0 > 0
	RETURNF (ARG:0 + (ARG:1 / 2)) / ARG:1
ELSE
	RETURNF (ARG:0 - (ARG:1 / 2)) / ARG:1
ENDIF

;-------------------------------------------------
;確率判定関数@PERCENT
;式中で使用する関数です。引数％の確率判定を行います。通れば1を返します
;常用する関数ですが、なぜ本体にこれ無いんだろ…。
;-------------------------------------------------
@PERCENT(ARG)
#FUNCTION
RETURNF (ARG - RAND:100) > 0

;-------------------------------------------------------
;get percent from GvT
;-------------------------------------------------------
@GETPERCENT, ARG:0, ARG:1, ARG:2
#FUNCTION
SIF ARG:0 == 0 || ARG:1 == 0
	RETURNF 0 
SIF ARG:2
	RETURNF ROUND_NEAREST(ARG:0*100, ARG:1)
LOCAL = ARG:0*100 / ARG:1
RETURNF LOCAL

@RESET_PARTS(ARG)
FOR LOCAL, 0, VARSIZE("EXPNAME")
	EXP:ARG:LOCAL = CSVEXP(ARG, LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("ABLNAME")
	ABL:ARG:LOCAL = CSVABL(ARG, LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("EXPNAME")
	EXP:ARG:LOCAL = CSVEXP(ARG, LOCAL)
NEXT
TALENT:ARG:ヤリマン = CSVTALENT(ARG,142)
TALENT:ARG:貞操 = CSVTALENT(ARG,30)
TALENT:ARG:性別嗜好 = CSVTALENT(ARG,81)
TALENT:ARG:無知 = CSVTALENT(ARG,27)

;-------------------------------------------------
;半角でARG:1文字以上ARG文字以下の文字列入力をさせて、RESULTSでかえす
;-------------------------------------------------
@INPUTS_SELECT, ARG, ARG:1
INPUTS
SELECTCASE STRLENS(RESULTS)
CASE IS < ARG:1
	IF STRLENS(RESULTS) == 0
		PRINTL You have to input something.
	ELSE
		PRINTFORML %RESULTS% is too short. You have to input at least {ARG:1} symbols, up to {ARG}.
	ENDIF
	RESTART
CASE IS > ARG
	PRINTFORML %RESULTS% is too long {STRLENS(RESULTS)}/{ARG}.
	RESTART
CASEELSE

ENDSELECT

;-------------------------------------------------
;半角スペースの出力
;-------------------------------------------------
@BL(ARG)
#FUNCTIONS
LOCALS = 
SIF ARG <= 0
	RETURNF LOCALS
LOCALS = %" "*ARG%
RETURNF LOCALS

;-------------------------------------------------
;文字列の桁数を合わせる
;RJは右詰、LJは左詰め
;-------------------------------------------------
@TEXT_RJ(ARGS, ARG)
#FUNCTIONS
SELECTCASE STRLENS(ARGS)
CASE IS >= ARG
	RETURNF ARGS
CASEELSE
	LOCALS = %BL(ARG-STRLENS(ARGS) )%%ARGS%
ENDSELECT
RETURNF LOCALS

@TEXT_LJ(ARGS, ARG)
#FUNCTIONS
SELECTCASE STRLENS(ARGS)
CASE IS >= ARG
	RETURNF ARGS
CASEELSE
	LOCALS = %ARGS%%BL(ARG-STRLENS(ARGS) )%
ENDSELECT
RETURNF LOCALS

@BASE_TR(ARGS)
#FUNCTIONS
SELECTCASE ARGS
	CASE "体力"
		RETURNF "STA"
	CASE "気力"
		RETURNF "ENE"
	CASE "精力"
		RETURNF "VIG"
	CASE "勃起"
		RETURNF "EREC"
	CASE "酒気"
		RETURNF "DRK"
	CASE "射精"
		RETURNF "Cum"
	CASE "母乳"
		RETURNF "Milk"
	CASEELSE
		RETURNF ARGS
ENDSELECT 

@FESTIVAL_DAY()
#FUNCTIONS
IF DAY:2 == 1
	SELECTCASE DAY:3
		CASE 1
			RETURNF "It's "
		CASE 3
			RETURNF "It's "
		CASE 11
			RETURNF "It's "
		CASE 14
			RETURNF "It's "
		CASE 25
			RETURNF "It's the Day of the "
	ENDSELECT
ELSEIF DAY:2 == 2
	SELECTCASE DAY:3
		CASE 7
			RETURNF "It's the Day of the "
		CASE 14
			RETURNF "It's the Day of the "
	ENDSELECT
ELSEIF DAY:2 == 3
	SELECTCASE DAY:3
		CASE 1
			RETURNF "Today's forecast is: "
		CASE 15
			RETURNF "It's the Day of the "
		CASE 27
			RETURNF "It's the Day of the "
		CASE 30
			RETURNF "It's "
	ENDSELECT
ELSEIF DAY:2 == 4
	SELECTCASE DAY:3
		CASE 3
			RETURNF "It's "
		CASE 24
			RETURNF "It's "
		CASE 25
			RETURNF "It's "
		CASE 31
			RETURNF "It's "
	ENDSELECT
ENDIF

;-------------------------------------------------
;if you want to get name of month - sometimes looks/reads/feels better than number
;-------------------------------------------------
@MONTH_NAME(ARG:0)
#FUNCTIONS
SELECTCASE ARG:0
	CASE 1
		RETURNF "January"
	CASE 2
		RETURNF "February"
	CASE 3
		RETURNF "March"
	CASE 4
		RETURNF "April"
	CASE 5
		RETURNF "May"
	CASE 6
		RETURNF "June"
	CASE 7
		RETURNF "July"
	CASE 8
		RETURNF "August"
	CASE 9
		RETURNF "September"
	CASE 10
		RETURNF "October"
	CASE 11
		RETURNF "November"
	CASE 12
		RETURNF "December"
	CASEELSE
		RETURNF "wrong month..."
ENDSELECT

@SEASON_NAME(ARG:0 = -1)
#FUNCTIONS
#DIMS strSeason = "", "Spring", "Summer", "Fall", "Winter"
SIF ARG:0 == -1
	ARG:0 = DAY:2
RETURNF strSeason:ARG

@NAME_MOON_TR(MOON)
#FUNCTIONS
#DIM  MOON;MOONにはDAY:3を渡すこと
#DIMS CONST NAME_MOON = "", "New", "First", "Waxing Crescent", "First Quarter", "Waxing Gibbous", "Waxing Gibbous", "13th Night", "14th Night", "Full Moon", "16th Night", "Waning Gibbous", "Waning Gibbous", "Third Quarter", "Waning crescent", "30th Night"

MOON = MAX(MOON_WATCH(MOON), 0)
SIF DAY:2 == 3 && MOON == 9
	RETURNF "Full Moon -Harvest Moon- "
RETURNF NAME_MOON:MOON

@ORDINAL(ARG)
#FUNCTIONS
IF ARG >= 11 && ARG <= 13
    LOCALS = th
ELSE
    SELECTCASE (ARG % 10)
    CASE 1
        LOCALS = st
    CASE 2
        LOCALS = nd
    CASE 3
        LOCALS = rd
    CASEELSE
        LOCALS = th
    ENDSELECT
ENDIF
RETURNF TOSTR(ARG) + LOCALS

;--------------------------------------------------------
;Group the digits for the ease of reading
;Can take any value, uses money by default
;Custom value must be higher than 0, or it will use money
;-------------------------------------------------
@DIGIT_GROUP(ARG)
#FUNCTIONS

RETURNF @"\@(ARG:0 == 0) ? 0 # %TOSTR(ARG:0,"#,###")%\@"


;ARG, who it is
;ARG:1, if it's His/Her or his/her
@HE_SHE(ARG, ARG:1)
#FUNCTIONS
#DIMS OUTPUT
OUTPUT '= @"%TALENT:ARG:性別 == 2?"He"#"She"%"
SIF !ARG:1
	OUTPUT = %TOLOWER(OUTPUT)%
RESULT = LOCAL
RETURNF OUTPUT

;ARG, who it is
;ARG:1, if it's His/Her or his/her
@HES_SHES(ARG, ARG:1)
#FUNCTIONS
#DIMS OUTPUT
OUTPUT '= @"%TALENT:ARG:性別 == 2?"He's"#"She's"%"
SIF !ARG:1
	OUTPUT = %TOLOWER(OUTPUT)%
RETURNF OUTPUT


;ARG, who it is
;ARG:1, if it's His/Her or his/her
@HIS_HER(ARG, ARG:1)
#FUNCTIONS
#DIMS OUTPUT
OUTPUT '= @"%TALENT:ARG:性別 == 2?"His"#"Her"%"
SIF !ARG:1
	OUTPUT = %TOLOWER(OUTPUT)%
RETURNF OUTPUT

;ARG, who it is
;ARG:1, if it's His/Her or his/her
;ARG:2, force third person (avoids "you"s)
@HIM_HER(ARG, ARG:1, ARG:2)
#FUNCTIONS
#DIMS OUTPUT
IF !ARG && !THIRD_PERSON && !ARG:2
	OUTPUT = You
ELSE
	OUTPUT '= @"%TALENT:ARG:性別 == 2?"Him"#"Her"%"
ENDIF
SIF !ARG:1
	OUTPUT = %TOLOWER(OUTPUT)%
RETURNF OUTPUT

;ARG, who it is
;ARG:1, if it's His/Her or his/her
;ARG:2, force third person (avoids "you"s)
@HIS_HERS(ARG, ARG:1, ARG:2)
#FUNCTIONS
#DIMS OUTPUT
IF !ARG && !THIRD_PERSON && !ARG:2
	OUTPUT = Your
ELSE
	OUTPUT '= @"%TALENT:ARG:性別 == 2?"His"#"Hers"%"
ENDIF
SIF !ARG:1
	OUTPUT = %TOLOWER(OUTPUT)%
RETURNF OUTPUT

;ARG, who it is
;ARG:1, if it's Himself/Herself or himself/herself
;ARG:2, force third person (avoids "yourself")
@HIMSELF_HERSELF(ARG, ARG:1, ARG:2)
#FUNCTIONS
#DIMS OUTPUT
OUTPUT '= @"%TALENT:ARG:性別 == 2?"Himself"#"Herself"%"
SIF !ARG:1
	OUTPUT = %TOLOWER(OUTPUT)%
RETURNF OUTPUT

;*************************************************
;Print mutually exclusive terms depending on the condition per function
;Default returning terms defined here can be overridden with _ to define your own
;Example: %PRINT_MALE("man_:breeding sow")%
;Capitalization depends on the case of the arguments
;*************************************************
@PRINT_MALE(ARGS, ARG:0 = -1)
#FUNCTIONS
SIF ARG < 0
	ARG = TARGET
SIF !STRLENS(ARGS)
	ARGS = guy
IF STRFIND(ARGS, "_") >= 0
	ARGS '= REPLACE(ARGS, "_", "")
	GOTO CUSTOM
ENDIF
	
SELECTCASE SPLIT_SINGLE(TOLOWER(ARGS:0))
	CASE "boy"
		LOCALS '= IS_MALE(ARG:0) ? TOLOWER(ARGS:0) # "girl"
	CASE "man"
		LOCALS '= IS_MALE(ARG:0) ? TOLOWER(ARGS:0) # "woman"
	CASE "lad"
		LOCALS '= IS_MALE(ARG:0) ? TOLOWER(ARGS:0) # "lass"
	CASE "guy"
		LOCALS '= IS_MALE(ARG:0) ? TOLOWER(ARGS:0) # "girl"
	CASE "fellow", "fella"
		LOCALS '= IS_MALE(ARG:0) ? TOLOWER(ARGS:0) # "gal"
	CASE "male"
		LOCALS '= IS_MALE(ARG:0) ? TOLOWER(ARGS:0) # "female"
	CASE "mister"
		LOCALS '= IS_MALE(ARG:0) ? TOLOWER(ARGS:0) # "miss"
	CASE "mr."
		LOCALS '= IS_MALE(ARG:0) ? TOLOWER(ARGS:0) # "ms."
	CASE "incubus"
		LOCALS '= IS_MALE(ARG:0) ? TOLOWER(ARGS:0) # "succubus"
	CASE "shota"
		LOCALS '= IS_MALE(ARG:0) ? TOLOWER(ARGS:0) # "loli"
	CASE "son"
		LOCALS '= IS_MALE(ARG:0) ? TOLOWER(ARGS:0) # "daughter"
	CASE "sir"
		LOCALS '= IS_MALE(ARG:0) ? TOLOWER(ARGS:0) # "miss"
CASEELSE
	$CUSTOM
	LOCALS '= IS_MALE(ARG:0) ? SPLIT_SINGLE(TOLOWER(ARGS:0)) # SPLIT_SINGLE(TOLOWER(ARGS:0), 1)
ENDSELECT
RETURNF IS_CAPITALIZED(ARGS:0) ? CAPITALIZE(LOCALS) # LOCALS

@PRINT_CLIT(ARG = -1)
#FUNCTIONS
SIF ARG == -1
	ARG = TARGET
SIF HAS_PENIS(ARG)
	RETURNF FSYN("penis")
RETURNF SPLIT_G("clitoris:clit")

@PRINT_HASPENIS(ARGS, ARG = -1)
#FUNCTIONS
SIF ARG == -1
	ARG = TARGET
RETURNF RETURN_CAP(ARGS, HAS_PENIS(ARG) ? SPLIT_SINGLE(TOLOWER(ARGS:0)) # SPLIT_SINGLE(TOLOWER(ARGS:0), 1))

;inside:outside
@PRINT_OUTSIDE(ARGS, ARG = -1)
#FUNCTIONS
#DIM nRefPoint
;create point of reference
SIF ARG == -1
	ARG = PLAYER
nRefPoint = INROOM(CFLAG:ARG:現在位置)

SIF !STRLENS(ARGS)
	ARGS = floor
IF STRFIND(ARGS, "_") >= 0
	ARGS '= REPLACE(ARGS, "_", "")
	GOTO CUSTOM
ENDIF
	
SELECTCASE SPLIT_SINGLE(TOLOWER(ARGS:0))
	CASE "floor"
		LOCALS '= nRefPoint ? TOLOWER(ARGS:0) # "ground"
	CASE "bed"
		LOCALS '= nRefPoint ? TOLOWER(ARGS:0) # "ground"
	CASE "room"
		LOCALS '= nRefPoint ? TOLOWER(ARGS:0) # "place"
	CASE "ceiling"
		LOCALS '= nRefPoint ? TOLOWER(ARGS:0) # "sky"
CASEELSE
	$CUSTOM
	LOCALS '= nRefPoint ? SPLIT_SINGLE(TOLOWER(ARGS:0)) # SPLIT_SINGLE(TOLOWER(ARGS:0), 1)
ENDSELECT

RETURNF IS_CAPITALIZED(ARGS:0) ? CAPITALIZE(LOCALS) # LOCALS

@SPLIT_G(ARGS, ARGS:1 = ":")
#FUNCTIONS

VARSET LOCALS

LOCAL = RESULT

SPLIT ARGS, ARGS:1, LOCALS

LOCAL:1 = RESULT
RESULT = LOCAL

RETURNF LOCALS:(RAND:(LOCAL:1))

;--------------------------------------------------------
;choose only unique non-repeating strings per multiple splits
;in case you want to cram things like "hot and soft", "soft and warm" into one split
;how it works -
;specify the string in the first argument, a string to pad them with in the second argument,
;and amount of times it needs to be output in the third
;for example - SPLIT_M("Fuah:Haah:Fah:Kh:Mmm:Nn:Ah", "...: ", 3) would output
;"Kh... Ah... Fah..." without repeating once, which is equivalent to doing SPLIT_R() three times, except this doesn't repeat
;specify empty space as a split to separate strPad character with spaces
;additionally strPad can be specified with noed command as a split to remove the pad string at the end
;example - SPLIT_M("warm:soft:hot:fuzzy", " and :noed", 2) - "soft and warm", removing " and " at the end
;one thing to watch out for - nCount should never be greater than the split amount, or it will not work due to unique string check
;--------------------------------------------------------
@SPLIT_M(strIn, strPad, nCount)
#FUNCTIONS
#DIM nLoop
#DIM nLoop1
#DIMS strIn
#DIMS DYNAMIC strPad
#DIMS DYNAMIC strTemp, 100
#DIMS DYNAMIC strPrevName, 100
#DIMS DYNAMIC strOutput
#DIM DYNAMIC nCount

SIF STRCOUNT(strIn, ":") + 1 < nCount
	RETURNF "@SPLIT_M has less splits than the amount to output, which will result in an infinite loop (String - " + strIn + "; Amount - " + TOSTR(nCount)

FOR nLoop, 0, nCount
	DO
		;prepare do loop in case of duplicate
		LOCAL = 0
		;generate top part of the name
		strTemp:nLoop '= SPLIT_G(strIn)
		;this thing kinda supposed to make all names unique, ie do not repeat twice within one roll
		FOR nLoop1, 0, nCount
			IF strTemp:nLoop == strPrevName:nLoop1
				LOCAL++
				BREAK
			ENDIF
		NEXT
	LOOP LOCAL
	
	strPrevName:nLoop '= strTemp:nLoop
	
	strOutput = %strOutput%%strTemp:nLoop%%SPLIT_SINGLE(strPad)%\@ SPLIT_CHECK(strPad, " ") && nLoop != nCount-1 ? %BL(1)% # \@
NEXT
;remove the pad symbol at the end if specified
SIF SPLIT_CHECK(strPad, "noed")
	strOutput '= REPLACE(strOutput, SPLIT_SINGLE(strPad) + "$", "")

RETURNF strOutput

;--------------------------------------------------------
;searches and returns a specified part of a split string if any part matches (greedy)
;--------------------------------------------------------
@MATCH_SPLIT(ARGS:0, ARGS:1, ARGS:2 = ":")
#FUNCTIONS
#DIMS DYNAMIC strSplit, 30

SPLIT ARGS:0, ARGS:2, strSplit

FOR LOCAL, 0, RESULT
	SIF STRCOUNT(strSplit:(LOCAL), ARGS:1)
		RETURNF strSplit:(LOCAL)
NEXT

;title name, takes care of the "the"-part as well
;the titles are unique
;ARG - character ID
;ARG:1 - capital letter at start
;ARG:2 - removes the "the" 
@TNAME(ARG, ARG:1 = 0, ARG:2 = 0)
#FUNCTIONS
LOCALS = 
IF ARG:1
	LOCALS = The 
ELSE
	LOCALS = the 
ENDIF
IF ARG == RANDOM_CHARANUM
	IF TALENT:ARG:水棲
		RETURNF @"%ARG:2?""#@"%ARG:1?"The "#"the "%"%Kappa"
	ELSEIF TALENT:ARG:妖精
		RETURNF @"%ARG:2?""#@"%ARG:1?"The "#"the "%"%Fairy"
	ELSE
		RETURNF @"%ARG:2?""#@"%ARG:1?"The "#"the "%"%Girl"
	ENDIF
ENDIF
SIF ARG:2
	RETURNF @"%SPLIT_G(TITLES(ARG))%"
RETURNF @"%LOCALS% %SPLIT_G(TITLES(ARG))%"

;ARG:1 flag
;0 - ongoing - "X is ...", also "X has finished ..."
;1 - for when pregnant - "X will have to stop ..."
;2 - future - "X goes from Y to Z to ..."
;3 - progress - "There's just a bit of ... left to do"
;4 - finished - "X has finished"
@GET_JOBNAME_TR(ARG,ARG:1=0)
#FUNCTIONS
VARSET LOCALS
SELECTCASE ARG
CASE [[霊夢]] ;reimu
	LOCALS = cleaning
	SIF ARG:1 == 2
		LOCALS = clean
CASE [[る～こと]] ;ruukoto
	LOCALS = housekeeping
	SIF ARG:1 == 2
		LOCALS = do some housekeeping
	SIF ARG:1 == 4
		LOCALS = the housekeeping
CASE [[魅魔]] ;mima
	IF YOUBI_MATCH(DAY, "月水")
		LOCALS = training
		SIF ARG:1 == 2
			LOCALS = train
	ELSEIF YOUBI_MATCH(DAY, "日") && INRANGE(DAY:3, 8, 14)
		LOCALS = attending the girls only club
		SIF ARG:1 == 2
			LOCALS = attend the girls only club
		SIF ARG:1 == 3
			LOCALS = girls only club attending
	ENDIF
CASE [[ちゆり]], [[夢美]] ;chiyuri, yumemi
	LOCALS = researching
	SIF ARG:1 == 2
		LOCALS = do some research
	SIF ARG:1 == 3
		LOCALS = research
CASE [[萃香]] ;suika
	IF YOUBI_MATCH(DAY, "水")
		LOCALS = training
		SIF ARG:1 == 2
			LOCALS = train
	ELSE
		LOCALS = drinking
		SIF ARG:1 == 2
			LOCALS = drink
	ENDIF
CASE [[魔理沙]] ;Marisa
	IF CFLAG:ARG:職種 == 42
		LOCALS = training
		SIF ARG:1 == 2
			LOCALS = train
	ELSE
		LOCALS = rummaging
		SIF ARG:1 == 2
			LOCALS = look for cool things
	ENDIF
	
	;addition custom code
	IF CFLAG:ARG:職種 == 43
		LOCALS = researching
		SIF ARG:1 == 2
			LOCALS = do some research
		SIF ARG:1 == 3
			LOCALS = research
	ENDIF
CASE [[ルーミア]] ;Rumia
	LOCALS = securing food
	SIF ARG:1 == 2
		LOCALS = secure food
	SIF ARG:1 == 3
		LOCALS = food securing
CASE [[チルノ]] ;Cirno
	LOCALS = selling ice cream
	SIF ARG:1 == 2
		LOCALS = sell ice cream
	SIF ARG:1 == 3
		LOCALS = ice cream selling
CASE [[咲夜]] ;Sakuya
	IF CFLAG:ARG:職種 == 40
		LOCALS = cleaning
		SIF ARG:1 == 2
			LOCALS = clean
	ELSE
		LOCALS = cooking
		SIF ARG:1 == 2
			LOCALS = cook
	ENDIF
CASE [[レミリア]] ;Remilia
	LOCALS = doing their sunday routine
	SIF ARG:1 == 2
		LOCALS = do their sunday routine
	SIF ARG:1 == 3
		LOCALS = sunday training
	SIF ARG:1 == 4
		LOCALS = their sunday routine
CASE [[アリス]] ;Alice
;手伝えないなら人形劇、料理なら家事
	IF TCVAR:ARG:手伝えない
		LOCALS = hosting a puppet show
		SIF ARG:1 == 1
			LOCALS = hosting puppet shows
		SIF ARG:1 == 2
			LOCALS = host a puppet show
		SIF ARG:1 == 3
			LOCALS = puppet show hosting
		SIF ARG:1 == 4
			LOCALS = hosting the puppet show
	ELSEIF CFLAG:ARG:職種 == 44
		LOCALS = doing some housekeeping
		SIF ARG:1 == 1
			LOCALS = hosting housekeeping
		SIF ARG:1 == 2
			LOCALS = doing housekeeping
		SIF ARG:1 == 3
			LOCALS = housekeeping
		SIF ARG:1 == 4
			LOCALS = the housekeeping
	ELSE
		LOCALS = cleaning up after the performance
		SIF ARG:1 == 2
			LOCALS = clean up after the performance
		SIF ARG:1 == 3
			LOCALS = cleaning up
		SIF ARG:1 == 4
			LOCALS = cleaning up
	ENDIF
;三姉妹
CASE [[ルナサ]], [[メルラン]], [[リリカ]] ;Lunasa, Merlin, Lyrica
	LOCALS = holding a concert
	SIF ARG:1 == 1
		LOCALS = holding concerts
	SIF ARG:1 == 2
		LOCALS = hold a concert
	SIF ARG:1 == 3
		LOCALS = concert holding
	SIF ARG:1 == 4
		LOCALS = holding the concert
CASE [[妖夢]] ;Youmu
	LOCALS = shopping
	SIF ARG:1 == 1
		LOCALS = going shopping
	SIF ARG:1 == 2
		LOCALS = do some shopping
CASE [[藍]] ;Ran
	LOCALS = performing barrier maintenance
	SIF ARG:1 == 2
		LOCALS = perform barrier maintenance
	SIF ARG:1 == 3
		LOCALS = barrier maintenance
	SIF ARG:1 == 4
		LOCALS = performing the barrier maintenance
CASE [[紫]] ;Yukari
	IF (DAY:2 == 4 && DAY:3 == 30)
		LOCALS = performing barrier maintenance
		SIF ARG:1 == 2
			LOCALS = perform barrier maintenance
		SIF ARG:1 == 3
			LOCALS = barrier maintenance
		SIF ARG:1 == 4
			LOCALS = performing the barrier maintenance
	ELSEIF YOUBI_MATCH(DAY, "日") && INRANGE(DAY:3, 8, 14)
		LOCALS = attending the girls only club
		SIF ARG:1 == 2
			LOCALS = attend the girls only club
		SIF ARG:1 == 3
			LOCALS = girls only club attending
	ENDIF
CASE [[ミスティア]] ;Mystia
	IF BASE:ARG:仕事量 > 3000
		LOCALS = stocking up
		SIF ARG:1 == 2
			LOCALS = stock up their cart
		SIF ARG:1 == 4
			LOCALS = stocking up their cart
	ELSE
		LOCALS = working at their cart
		SIF ARG:1 == 2
			LOCALS = work at their cart
	ENDIF
CASE [[文]] ;Aya
	LOCALS = writing articles
	SIF ARG:1 == 2
		LOCALS = write some articles
	SIF ARG:1 == 3
		LOCALS = article writing
	SIF ARG:1 == 4
		LOCALS = writing the articles
CASE [[映姫]] ;Shikieiki
	IF INRANGE(TIME, CLOCK_TO_TIME(9, 0), CLOCK_TO_TIME(11, 59))
		LOCALS = conducting a trial
		SIF ARG:1 == 1
			LOCALS = conducting trials
		SIF ARG:1 == 2
			LOCALS = conduct a trial
		SIF ARG:1 == 3
			LOCALS = judging
		SIF ARG:1 == 4
			LOCALS = judging
	ELSEIF INRANGE(TIME, CLOCK_TO_TIME(12, 0), CLOCK_TO_TIME(12, 59))
		LOCALS = having a lunch break
		SIF ARG:1 == 1
			LOCALS = having lunch breaks
		SIF ARG:1 == 2
			LOCALS = have a lunch break
		SIF ARG:1 == 3
			LOCALS = lunch breaking
		SIF ARG:1 == 4
			LOCALS = having her lunch break
	ELSEIF INRANGE(TIME, CLOCK_TO_TIME(13, 0), CLOCK_TO_TIME(16, 59))
		LOCALS = doing office work
		SIF ARG:1 == 1
			LOCALS = doing office work
		SIF ARG:1 == 2
			LOCALS = doing office work
		SIF ARG:1 == 3
			LOCALS = do some office work
		SIF ARG:1 == 4
			LOCALS = doing office work
	ELSE
		LOCALS = filing documents
		SIF ARG:1 == 1
			LOCALS = filing documents
		SIF ARG:1 == 2
			LOCALS = file some documents
		SIF ARG:1 == 3
			LOCALS = filing
		SIF ARG:1 == 4
			LOCALS = filing documents
	ENDIF
CASE [[早苗]] ;Sanae
	LOCALS = canvassing
	SIF ARG:1 == 2
		LOCALS = spread their religion
CASE [[神奈子]] ;Kanako
	IF DAY:2 == 2 && DAY:3 == 5
		LOCALS = taking part of the annual school health and growth checkup
		SIF ARG:1 == 2
			LOCALS = take part of the annual school health and growth checkup
		SIF ARG:1 == 3
			LOCALS = health and growth checkup
		SIF ARG:1 == 4
			LOCALS = the health and growth checkup
	ELSEIF YOUBI_MATCH(DAY, "日") && INRANGE(DAY:3, 8, 14)
		LOCALS = attending the girls only club
		SIF ARG:1 == 2
			LOCALS = attend the girls only club
		SIF ARG:1 == 3
			LOCALS = girls only club attending
	ENDIF
CASE [[諏訪子]] ;Suwako
	LOCALS = cooking
	SIF ARG:1 == 2
		LOCALS = cook
CASE [[天子]] ;Tenshi
	LOCALS = performing buddhist prayers
	SIF ARG:1 == 2
		LOCALS = perform buddhist prayers
	SIF ARG:1 == 3
		LOCALS = buddhist prayers
	SIF ARG:1 == 4
		LOCALS = performing the buddhist prayers
CASE [[衣玖]] ;Iku
	LOCALS = conversing
	SIF ARG:1 == 2
		LOCALS = converse
CASE [[お燐]] ;Rin
	LOCALS = managing evil spirits
	SIF ARG:1 == 2
		LOCALS = manage evil spirits
	SIF ARG:1 == 3
		LOCALS = evil spirits management
	SIF ARG:1 == 4
		LOCALS = managing the evil spirits
CASE [[お空]] ;Utsuho
	LOCALS = managing the nuclear output
	SIF ARG:1 == 2
		LOCALS = manage the nuclear output
	SIF ARG:1 == 3
		LOCALS = nuclear output management
	SIF ARG:1 == 4
		LOCALS = managing the nuclear output
CASE [[小傘]] ;Kogasa
	LOCALS = babysitting
	SIF ARG:1 == 2
		LOCALS = do some babysitting
CASE [[ぬえ]] ;Nue
	LOCALS = cooking
	SIF ARG:1 == 2
		LOCALS = cook
CASE [[華扇]] ;Kasen
	IF YOUBI_MATCH(DAY, "土")
		LOCALS = sampling restaurants
		SIF ARG:1 == 2
			LOCALS = sample restaurants
		SIF ARG:1 == 3
			LOCALS = restaurant sampling
	ELSE
		LOCALS = performing ascetic training
		SIF ARG:1 == 2
			LOCALS = perform ascetic training
		SIF ARG:1 == 3
			LOCALS = ascetic training
		SIF ARG:1 == 4
			LOCALS = their ascetic training
	ENDIF
CASE [[エレン]] ;Ellen
	IF GROUPMATCH(DAY:3, 15, 30)
		LOCALS = on a business trip for the magic shop
		SIF ARG:1 == 1
			LOCALS = going on a business trips for the magic shop
		SIF ARG:1 == 2
			LOCALS = go on a business trips for the magic shop
		SIF ARG:1 == 3
			LOCALS = business
		SIF ARG:1 == 4
			LOCALS = the business trip
	ELSE
		LOCALS = gathering materials
		SIF ARG:1 == 2
			LOCALS = gather some materials
		SIF ARG:1 == 3
			LOCALS = material gathering
		SIF ARG:1 == 4
			LOCALS = gathering some materials
	ENDIF
CASE [[鈴仙]] ;Reisen
	IF YOUBI_MATCH(DAY, "火")
		LOCALS = selling medicine
		SIF ARG:1 == 2
			LOCALS = sell medicine
		SIF ARG:1 == 3
			LOCALS = medicine selling
	ELSE
		LOCALS = making medicine
		SIF ARG:1 == 2
			LOCALS = make medicine
		SIF ARG:1 == 3
			LOCALS = medicine making
	ENDIF
CASE [[パチュリー]] ;Patchouli
	LOCALS = reading
	SIF ARG:1 == 2
		LOCALS = read
CASE [[白蓮]] ;Byakuren
	IF YOUBI_MATCH(DAY, "月木")
		LOCALS = canvassing
		SIF ARG:1 == 2
			LOCALS = spread their religion
	ELSEIF YOUBI_MATCH(DAY, "日") && INRANGE(DAY:3, 8, 14)
		LOCALS = attending the girls only club
		SIF ARG:1 == 2
			LOCALS = attend the girls only club
		SIF ARG:1 == 3
			LOCALS = girls only club attending
	ENDIF
CASE [[神子]] ;Miko
	LOCALS = performing ascetic training
	SIF ARG:1 == 2
		LOCALS = perform ascetic training
	SIF ARG:1 == 3
		LOCALS = ascetic training
	SIF ARG:1 == 4
		LOCALS = their ascetic training
CASE [[こころ]] ;Kokoro
	IF FESTIVAL() == "例大祭"
		LOCALS = performing a Noh play
		SIF ARG:1 == 1
			LOCALS = performing Noh plays
		SIF ARG:1 == 2
			LOCALS = perform a Noh play
		SIF ARG:1 == 3
			LOCALS = Noh performance
		SIF ARG:1 == 4
			LOCALS = performing the Noh play
	ELSE
		LOCALS = practicing for Noh plays
		SIF ARG:1 == 2
			LOCALS = practice for Noh plays
		SIF ARG:1 == 3
			LOCALS = Noh practicing
	ENDIF
CASE [[美鈴]] ;Meiling
	LOCALS = gatekeeping
	SIF ARG:1 == 2
		LOCALS = do some gatekeeping
	SIF ARG:1 == 4
		LOCALS = protecting the gate
CASE [[小悪魔]] ;Koakuma
	LOCALS = cooking
	SIF ARG:1 == 2
		LOCALS = cook
CASE [[パルスィ]] ;Parsee
	LOCALS = bridgekeeping
	SIF ARG:1 == 2
		LOCALS = do some bridgekeeping
	SIF ARG:1 == 4
		LOCALS = protecting the bridge
CASE [[輝夜]] ;Kaguya
	LOCALS = cultivating a bonsai tree
	SIF ARG:1 == 1
		LOCALS = looking after their bonsai tree
	SIF ARG:1 == 2
		LOCALS = look after their bonsai tree
	SIF ARG:1 == 3
		LOCALS = bonsai tree cultivation
	SIF ARG:1 == 4
		LOCALS = caring for the bonsai tree
CASE [[勇儀]] ;Yuugi
	LOCALS = drinking
	SIF ARG:1 == 2
		LOCALS = drink
CASE [[椛]] ;Momiji
	LOCALS = patrolling
	SIF ARG:1 == 2
		LOCALS = patrol
CASE [[慧音]] ;Keine
	IF INRANGE(TIME, CLOCK_TO_TIME(12, 0), CLOCK_TO_TIME(12, 59))
		LOCALS = having a lunch break
		SIF ARG:1 == 1
			LOCALS = having lunch breaks
		SIF ARG:1 == 2
			LOCALS = have a lunch break
		SIF ARG:1 == 3
			LOCALS = lunching
		SIF ARG:1 == 4
			LOCALS = their lunch break
	ELSEIF TIME >= CLOCK_TO_TIME(14, 0)
		LOCALS = cleaning up
		SIF ARG:1 == 2
			LOCALS = clean up
	ELSE
		LOCALS = teaching in class
		SIF ARG:1 == 2
			LOCALS = teach in class
	ENDIF
CASE [[幽香]] ;Yuuka
	LOCALS = looking after flowers
	SIF ARG:1 == 2
		LOCALS = look after the flowers
	SIF ARG:1 == 3
		LOCALS = flowing caring
	SIF ARG:1 == 1
		LOCALS = looking after the flowers
CASE [[小鈴]] ;Kosuzu
	IF YOUBI_MATCH(DAY, "水木")
		LOCALS = managing the store
		SIF ARG:1 == 2
			LOCALS = manage the store
		SIF ARG:1 == 3
			LOCALS = store management
	ELSE
		LOCALS = sorting their book collection
		SIF ARG:1 == 2
			LOCALS = sort their book collection
		SIF ARG:1 == 3
			LOCALS = book sorting
	ENDIF
CASE [[永琳]] ;Eirin
	IF YOUBI_MATCH(DAY, "月火金")
		LOCALS = performing medical examinations
		SIF ARG:1 == 2
			LOCALS = perform medical examinations
		SIF ARG:1 == 3
			LOCALS = medical examination performance
		SIF ARG:1 == 4
			LOCALS = performing the medical examinations
		
	ELSEIF YOUBI_MATCH(DAY, "日") && INRANGE(DAY:3, 8, 14)
		LOCALS = attending the girls only club
		SIF ARG:1 == 2
			LOCALS = attend the girls only club
		SIF ARG:1 == 3
			LOCALS = girls only club attending
	ENDIF
CASE [[メディスン]] ;Medicine
	LOCALS = collecting poison
	SIF ARG:1 == 2
		LOCALS = collect poison
	SIF ARG:1 == 3
		LOCALS = poison collection
CASE [[小町]] ;Komachi
	LOCALS = ferrying dead spirits
	SIF ARG:1 == 2
		LOCALS = ferry dead spirits
	SIF ARG:1 == 3
		LOCALS = dead spirit ferrying
	SIF ARG:1 == 4
		LOCALS = ferrying the dead spirits
CASE [[雛]] ;Hina
	LOCALS = collecting misfortune
	SIF ARG:1 == 2
		LOCALS = collect misfortune
	SIF ARG:1 == 3
		LOCALS = misfortune collection
CASE [[阿求]] ;Akyuu
	LOCALS = writing chronicles
	SIF ARG:1 == 2
		LOCALS = write chronicles
	SIF ARG:1 == 3
		LOCALS = chronicle writing
CASE [[蓮子]] ;Renko
	LOCALS = writing a report
	SIF ARG:1 == 2
		LOCALS = write a report
	SIF ARG:1 == 3
		LOCALS = report writing
	SIF ARG:1 == 4
		LOCALS = writing the report
CASE [[メリー]] ;Maribel
	LOCALS = writing a report
	SIF ARG:1 == 2
		LOCALS = write a report
	SIF ARG:1 == 3
		LOCALS = report writing
	SIF ARG:1 == 4
		LOCALS = writing the report
CASE [[一輪]] ;Ichirin
	LOCALS = cleaning
	SIF ARG:1 == 2
		LOCALS = clean
CASE [[星]] ;Shou
	IF YOUBI_MATCH(DAY, "金")
		LOCALS = preaching
		SIF ARG:1 == 2
			LOCALS = preach
	ELSE
		LOCALS = performing buddhist religious services
		SIF ARG:1 == 2
			LOCALS = perform buddhist religious services
		SIF ARG:1 == 3
			LOCALS = buddhist religious service performance
		SIF ARG:1 == 4
			LOCALS = performing the buddhist religious services
	ENDIF
CASE [[芳香]] ;Yoshika
	LOCALS = undergoing maintenance
	SIF ARG:1 == 2
		LOCALS = undergo maintenance
	SIF ARG:1 == 2
		LOCALS = maintenance undergoing
CASE [[青娥]] ;Seiga
	LOCALS = performing maintenance
	SIF ARG:1 == 2
		LOCALS = perform maintenance
	SIF ARG:1 == 2
		LOCALS = maintenance performing
CASE [[布都]] ;Futo
	LOCALS = conversing
	SIF ARG:1 == 2
		LOCALS = converse
CASE [[弁々]], [[八橋]] ;Benben, Yatsuhashi
	LOCALS = holding a concert
	SIF ARG:1 == 1
		LOCALS = holding concerts
	SIF ARG:1 == 2
		LOCALS = hold a concert
	SIF ARG:1 == 3
		LOCALS = concert holding
	SIF ARG:1 == 4
		LOCALS = holding the concert
CASE [[雷鼓]] ;Raiko
	IF DAY % 28 == 7
		LOCALS = holding a concert
		SIF ARG:1 == 1
			LOCALS = holding concerts
		SIF ARG:1 == 2
			LOCALS = hold a concert
		SIF ARG:1 == 3
			LOCALS = concert holding
		SIF ARG:1 == 4
			LOCALS = holding the concert
	ELSE
		LOCALS = conversing
		SIF ARG:1 == 2
			LOCALS = converse
	ENDIF
CASE [[幽々子]] ;Yuyuko
	IF YOUBI_MATCH(DAY, "日") && INRANGE(DAY:3, 8, 14)
		LOCALS = attending the girls only club
		SIF ARG:1 == 2
			LOCALS = attend the girls only club
		SIF ARG:1 == 3
			LOCALS = girls only club attending
	ENDIF
CASE [[隠岐奈]] ;Okina
	IF YOUBI_MATCH(DAY, "日") && INRANGE(DAY:3, 8, 14)
		LOCALS = attending the girls only club
		SIF ARG:1 == 2
			LOCALS = attend the girls only club
		SIF ARG:1 == 3
			LOCALS = girls only club attending
	ENDIF
CASE [[神綺]] ;Shinki
	IF YOUBI_MATCH(DAY, "日") && INRANGE(DAY:3, 8, 14)
		LOCALS = attending the girls only club
		SIF ARG:1 == 2
			LOCALS = attend the girls only club
		SIF ARG:1 == 3
			LOCALS = girls only club attending
	ENDIF
CASE [[夢子]] ;Yumeko
	IF YOUBI_MATCH(DAY,"月木")
		LOCALS = cleaning
		SIF ARG:1 == 2
			LOCALS = clean
	ENDIF
CASE [[久侘歌]] ;Kutaka
	LOCALS = overseeing the gateway
	SIF ARG:1 == 2
		LOCALS = do some gatekeeping
	SIF ARG:1 == 3
		LOCALS = gatekeeping
	SIF ARG:1 == 4
		LOCALS = protecting the gateway
CASE [[美宵]] ;Miyoi
	LOCALS = serving
	SIF ARG:1 == 1
		LOCALS = serving
	SIF ARG:1 == 2
		LOCALS = serve
	SIF ARG:1 == 3
		LOCALS = serving
	SIF ARG:1 == 4
		LOCALS = work
ENDSELECT
SIF LOCALS == ""
	LOCALS = %GET_JOBNAME(ARG)%
IF LOCALS == "仕事"
	LOCALS = working
	SIF ARG:1 == 2
		LOCALS = work
ENDIF
RETURNF LOCALS

@UNIQUE_COM_TR(ARGS)
#FUNCTIONS
SELECTCASE ARGS
	CASE "おみくじ契約"
		RETURNF "Omikuji Contract"
	CASE "気配を探る"
		RETURNF "Detect Presence"
	CASE "人助け"
		RETURNF "Help Out"
	CASE "アイスを買う"
		RETURNF "Buy Ice Cream"
	CASE "紅魔館出張サービス"
		RETURNF "SDM Services"
	CASE "屋台で食事"
		RETURNF "Eat at the Stall"
	CASE "新聞購読"
		RETURNF "Newspaper Subscription"
	CASE "天候操作"
		RETURNF "Weather Manipulation"
	CASE "ダウジング"
		RETURNF "Dowsing"
	CASE "傘の修理"
		RETURNF "Umbrella Repair"
	CASE "道具を買う"
		RETURNF "Buy Tools"
	CASE "薬を買う"
		RETURNF "Buy Medicine"
	CASE "千里眼"
		RETURNF "Telegnosis"
	CASE "弾幕勝負"
		RETURNF "Danmaku"
	CASE "生薬を売る"
		RETURNF "Sell Herbal Medicine"
	CASE "魚の交換"
		RETURNF "Trade Fish"
		
	;addition custom code
	CASE "厄を払う"
		RETURNF "Cleanse Misfortune"
	CASEELSE
		RETURNF ARGS
ENDSELECT

;-------------------------------------------------
;Get Train command num by its name (original japanese name)
;-------------------------------------------------
@TNUM(ARGS)
#FUNCTION
SIF GETNUM(TRAINNAME, ARGS) < 0
	THROW @"Unrecognized TRAINNAME is being specified for TNUM (%ARGS%)"

RETURNF GETNUM(TRAINNAME, ARGS)

;-------------------------------------------------
;Confirm if ARGS equals currently selected Train command (multiple can be specified with / split)
;-------------------------------------------------
@IS_SELECTCOM(ARGS, ARG = 0)
#FUNCTION
#DIM nLoop

SPLIT ARGS, "/", LOCALS, LOCAL
FOR nLoop, 0, LOCAL
	SIF SELECTCOM:ARG == TNUM(LOCALS:nLoop)
		RETURNF SELECTCOM:ARG == TNUM(LOCALS:nLoop)
NEXT

;-------------------------------------------------
;Same as above but for previous command
;-------------------------------------------------
@IS_PREVCOM(ARGS, ARG = 0)
#FUNCTION
#DIM nLoop

SPLIT ARGS, "/", LOCALS, LOCAL
FOR nLoop, 0, LOCAL
	SIF PREVCOM:ARG == TNUM(LOCALS:nLoop)
		RETURNF PREVCOM:ARG == TNUM(LOCALS:nLoop)
NEXT

;-------------------------------------------------
;末尾に空行ひとつだけを残した状態にする関数
;Function to leave only one blank line at the end
;-------------------------------------------------
@SINGLE_EMPTY_LINE()
WHILE 1
	IF HTML_GETPRINTEDSTR(0) != "<p align='left'><nobr> </nobr></p>"
		PRINTL
		BREAK
	ELSEIF HTML_GETPRINTEDSTR(1) == "<p align='left'><nobr> </nobr></p>"
		CLEARLINE 1
	ELSE
		BREAK
	ENDIF
WEND

@MUTUAL_KISS(ARG = -1, ARG:1 = 1, ARG:2 = 1)
SIF ARG == -1
	ARG = TARGET
CALL ADD_KISS(ARG, ARG:1, ARG:2)

;undo translation of name, that way functions which use names don't have to be changed
;does not contain all names yet since only one function using the original names have been found
;and it doesn't use all the names
@UN_TR_NAME(ARGS)
#FUNCTIONS
SELECTCASE ARGS
	CASE "Reimu"
		RETURNF "霊夢"
	CASE "Sunny" 
		RETURNF "サニー"
	CASE "Luna" 
		RETURNF "ルナ"
	CASE "Star" 
		RETURNF "スター"
	CASE "Suika" 
		RETURNF "萃香"
	CASE "Marisa" 
		RETURNF "魔理沙"
	CASE "Cirno" 
		RETURNF "チルノ"
	CASE "Remilia" 
		RETURNF "レミリア"
	CASE "Ran" 
		RETURNF "藍"
	CASE "Yukari" 
		RETURNF "紫"
	CASE "Wriggle" 
		RETURNF "リグル"
	CASE "Aya" 
		RETURNF "文"
	CASE "Shikieiki" 
		RETURNF "映姫"
	CASE "Sanae" 
		RETURNF "早苗"
	CASE "Kanako" 
		RETURNF "神奈子"
	CASE "Suwako" 
		RETURNF "諏訪子"
	CASE "Tenshi" 
		RETURNF "天子"
	CASE "Rin" 
		RETURNF "お燐"
	CASE "Utsuho" 
		RETURNF "お空"
	CASE "Nazrin" 
		RETURNF "ナズーリン"
	CASE "Satori" 
		RETURNF "さとり"
	CASE "Nitori" 
		RETURNF "にとり"
	CASE "Tewi" 
		RETURNF "てゐ"
	CASE "Byakuren" 
		RETURNF "白蓮"
	CASE "Koakuma" 
		RETURNF "小悪魔"
	CASE "Parsee" 
		RETURNF "パルスィ"
	CASE "Momiji" 
		RETURNF "椛"
	CASE "Yuyuko" 
		RETURNF "幽々子"
	CASE "Yuuka" 
		RETURNF "幽香"
	CASE "Mamizou" 
		RETURNF "マミゾウ"
	CASE "Shinmyoumaru" 
		RETURNF "針妙丸"
	CASE "Eirin" 
		RETURNF "永琳"
	CASE "Sekibanki" 
		RETURNF "蛮奇"
	CASE "Shizuha" 
		RETURNF "静葉"
	CASE "Minoriko" 
		RETURNF "穣子"
	CASE "Hina" 
		RETURNF "雛"
	CASE "Akyuu" 
		RETURNF "阿求"
	CASE "Tojiko" 
		RETURNF "屠自古"
ENDSELECT
RETURNF LOCALS

;differentiate between "moved to [the] bridge" and "moved to [] Sunny's Boudoir"
;If the location is caught by a case a "the" isn't added before it
@LOC_THE(ARG,ARG:1)
#FUNCTIONS
LOCALS = 
SELECTCASE ARG
CASE 15, 19 TO 23
CASE 26 TO 51
CASE 53
CASE 8109, 8113 TO 8118
CASE 8125, 8127, 8128, 8213, 8221, 8224, 8226
CASE 8230 TO 8235
CASE 8311, 8312, 8320, 8326
CASE 8334 TO 8342
CASE 8344 TO 8346
CASE 8348, 8410, 8411, 8413, 8414, 8432, 8437
CASE 8443 TO 8445
CASE 8450 TO 8466
CASE 8502, 8506
CASE 8511 TO 8515
CASE 8521 TO 8531
CASE 8534 TO 8537
CASE 8544
CASE 8602, 8604, 8608, 8609
CASE 8615 TO 8616, 8618, 8623 TO 8625, 8633 TO 8635, 8638, 8644 TO 8648, 8651
CASE 8541 TO 8544
CASE 8702
CASE 8705 TO 8707
CASE 8715 TO 8730
CASE 8733, 8736 
CASE 8806 TO 8809
CASE 8817, 8818, 8820, 8823, 8831, 8840, 8841, 8901, 8902, 8911, 8912, 8918, 8919, 8927, 8928, 8930, 8936
CASE 8851 TO 8856, 8929, 8930
CASE 8940 TO 8942
CASEELSE
	LOCALS = %"the "%
	SIF ARG:1
		LOCALS = %"The "%
ENDSELECT
RETURNF LOCALS

;changes "the" to "The"
@THE_CASE_SHIFT(ARGS)
#FUNCTIONS
SUBSTRING ARGS, 0, 1
IF RESULTS:0 == "t"
	SUBSTRING ARGS, 1, -1
	RETURNF @"T%RESULTS%"
ELSE
	RETURNF ARGS
ENDIF

;--------------------------------------------------------
;Taken from GrammarAnon's thing in eratohoK
;Inserts line breaks at the last word space of each line for the passed string and returns it.
;nIndent = number of spaces indented (optional)
;strBreakLine = additional thing to print when breaking a line
;nLength = total character width including indent (optional)
;strMatch = character to match after which line break occurs, any space character by default
;CHAR_PER_LINE defined in TRANSLATION.ERH
;Use with PRINTFORM or variants, as the returned string ends in \n
;Should there be non-whitespace characters in excess of specified width, that line will roll over to next and correct formatting will continue at next whitespace
;--------------------------------------------------------
@BREAKENG(strInput, nIndent = 0, strBreakLine = "\n", nLength = 0, strMatch = "\s")
#FUNCTIONS
#DIM LINELENGTH
#DIM nIndent
#DIM nLength
#DIMS strInput
#DIMS strBreakLine
#DIMS strMatch

SIF !nLength
	nLength = MAXWIDTH() - 19
LINELENGTH = nLength - nIndent

IF LINELENGTH < 1
	THROW @BREAKENG Usable length cannot be less than 1, strInput - %strInput%, nIndent - {nIndent}
ELSE
	LOCALS '= REPLACE(strInput, "(.{1," + TOSTR(LINELENGTH) + "})(?:" + strMatch + "|$)", " "*nIndent + "$1" + strBreakLine)
	;remove strBreakLine contents at the end
	RETURNF SUBSTRING(LOCALS, 0, STRLENS(LOCALS) - STRLENS(strBreakLine))
ENDIF

;--------------------------------------------------------
;print dialogue line with linebreaks
;legend: w - wait flag, d - slow type mode with default settings, dc - default color, p - parenthesis mode, t - third person quotes
;--------------------------------------------------------
@PRINT_DIALOGUE, ARGS, ARGS:1
IF SPLIT_CHECK(TOLOWER(ARGS:1), "p")
	LOCALS:0 = （
	LOCALS:1 = ）
ELSEIF SPLIT_CHECK(TOLOWER(ARGS:1), "t")
	LOCALS:0 = 『
	LOCALS:1 = 』
ELSE
	LOCALS:0 = 「
	LOCALS:1 = 」
ENDIF

IF SPLIT_CHECK(TOLOWER(ARGS:1), "d")
	CALL KEYTYPING(BREAKENG(LOCALS:0 + ARGS + LOCALS:1, 0, "\n　", MAXWIDTH() - 19), "l", 1, 2)
ELSEIF SPLIT_CHECK(TOLOWER(ARGS:1), "dc")
	PRINTSDL BREAKENG(LOCALS:0 + ARGS + LOCALS:1, 0, "\n　", MAXWIDTH() - 19)
ELSE
	PRINTSL BREAKENG(LOCALS:0 + ARGS + LOCALS:1, 0, "\n　", MAXWIDTH() - 19)
ENDIF
SIF SPLIT_CHECK(TOLOWER(ARGS:1), "w")
	WAIT
	
;--------------------------------------------------------
;When I want to have BREAKENG applied on the text without moving the entire text into LOCALS first
;First we need to prepare the text by removing line breaks from PRINT instruction
;use this regex PRINT(|FORM)(L|W) (.*) and replace with PRINTFORM $3
;all line breaks will be replaced with <br>, additional line breaks can be inserted the same way
;if there's any kind of WAIT in the text, use that line as the last one and then put WAIT after this function
;colored text is not supported
;--------------------------------------------------------
@PRINT_BREAK(ARGS = "\n", ARGS:1)
#DIMS DYNAMIC PARTS, 100
#DIMS DYNAMIC strFlag, 100
#DIM DYNAMIC nLength
LOCALS '= HTML_TOPLAINTEXT(HTML_POPPRINTINGSTR())
SPLIT LOCALS, "<br>", PARTS

FOR LOCAL, 0, RESULT
	SIF STRLENS(PARTS:LOCAL) == 0
		CONTINUE
		
	VARSET nLength
	;process the flags
	IF STRCOUNT(PARTS:LOCAL, "<wait>")
		PARTS:LOCAL '= REPLACE(PARTS:LOCAL, "<wait>", "")
		strFlag:LOCAL = wait:
	ENDIF
	IF STRCOUNT(PARTS:LOCAL, "<right>")
		PARTS:LOCAL '= REPLACE(PARTS:LOCAL, "<right>", "")
		ALIGNMENT RIGHT
	ENDIF
	;cut a little shorter if there are double-width characters, add on demand
	SIF STRCOUNT(PARTS:LOCAL, "↓|♪")
		nLength = MAXWIDTH()-10
	SIF SPLIT_CHECK(ARGS:1, "br") && LOCAL == 0 ;break line at the beginning
		PRINTL
	IF SPLIT_CHECK(ARGS:1, "dc")
		PRINTSDL BREAKENG(PARTS:LOCAL, , ARGS, nLength)
	ELSEIF SPLIT_CHECK(ARGS:1, "d")
		CALL PRINT_DIALOGUE(PARTS:LOCAL)
	ELSEIF SPLIT_CHECK(ARGS:1, "noLB")
		PRINTS BREAKENG(PARTS:LOCAL, , ARGS, nLength)
	ELSE
		PRINTSL BREAKENG(PARTS:LOCAL, , ARGS, nLength)
	ENDIF
	ALIGNMENT LEFT
	IF SPLIT_CHECK(strFlag:LOCAL, "wait")
		WAIT
	ENDIF
NEXT

SIF SPLIT_CHECK(ARGS:1, "wait") && STRLENS(PARTS:0)
	WAIT

;To avoid messing with japanese code that uses strings for everything
@REQUEST_NAMES_TR(ARGS)
#FUNCTIONS
SELECTCASE ARGS
	CASE "掃除を手伝って"
		LOCALS = Help with cleaning
	CASE "街頭アンケート"
		LOCALS = Street Survey
	CASE "掃除を手伝って"
		LOCALS = Help with cleaning
	CASE "お花に水をあげて"
		LOCALS = Water flowers
	CASE "特訓につきあって"
		LOCALS = Special training
	CASE "いっしょにあそぼ"
		LOCALS = Let's play
	CASE "料理上手になりたい"
		LOCALS = I want to become a good cook
	CASE "特訓につきあって"
		LOCALS = Help with special training
	CASE "誰か教えて！"
		LOCALS = Someone teach me!
	CASE "大掃除が終わらない"
		LOCALS = Spring cleaning isn't done
	CASE "手紙を届けて"
		LOCALS = Deliver the letter
	CASE "誰かの落とし物"
		LOCALS = Someone's lost something
	CASE "どうしてもみつからない"
		LOCALS = Can't find it
	CASE "懲らしめて！"
		LOCALS = Beat em up!
	CASE "うまい魚が食べたいなぁ"
		LOCALS = I want some good fish
	CASE "薪を切らしてる"
		LOCALS = Out of timber
	CASE "肩もみ"
		LOCALS = Shoulder massage
	CASE "グルメリポート"
		LOCALS = Gourmet Report
	CASE "魔理沙の忘れ物"
		LOCALS = Marisa forgot her stuff
	CASE "宴会用の酒"
		LOCALS = Sake for the banquet
	CASE "酒をのませろ"
		LOCALS = Drink sake
	CASE "大アイス"
		LOCALS = Ice cream bomb
	CASE "あー！そー！ぼー！"
		LOCALS = Play～! With～! Me～!
	CASE "美鈴に差し入れ"
		LOCALS = Provisions for Meiling
	CASE "カリスマ切れ"
		LOCALS = 100 charisma
	CASE "お酒をください"
		LOCALS = Sake, please
	CASE "お説教たいむ"
		LOCALS = Time for a sermon
	CASE "参考文献"
		LOCALS = Reference literature
	CASE "図書の返却（人里）"
		LOCALS = Return book (Human Village)
	CASE "図書の返却（紅魔館）"
		LOCALS = Return book (Scarlet Devil Mansion)
	CASE "にとりときゅうり"
		LOCALS = Nitori and cucumber
	CASE "かっぱすたーたー"
		LOCALS = Kappa-Starter
	CASE "甘酒ください"
		LOCALS = Sweet sake, please
	CASE "お盆マジつらい"
		LOCALS = Lantern festival is suuuch a drag
	CASE "お悩み相談"
		LOCALS = Listen and give advice
	CASEELSE
		LOCALS = %ARGS%
ENDSELECT
;SIF GROUPMATCH(ARGS, "弾幕の特訓を手伝う")
;	LOCALS = @"Help %CALLNAME:ARG% with special danmaku training"
RETURNF LOCALS

;Rather than CSV
@CFLAGNAME_TR(ARGS)
#FUNCTIONS
SELECTCASE ARGS
	CASE "好感度"
		LOCALS = Favorability
	CASE "信頼度"
		LOCALS = Reliability
	CASE "既成事実"
		LOCALS = Consent (Bit-operation, setting to 0 will reset it)
	CASE "弱み握り"
		LOCALS = Can blackmail you
	CASE "弱み握られ"
		LOCALS = Caught them masturbating
	CASE "デート後イベントフラグ"
		LOCALS = Can confess after date (Bit-operation, setting to 0 will reset it)
	CASE "生解禁"
		LOCALS = Raw sex consent (1 - only on safe days, 2 - always)
	CASE "面識"
		LOCALS = Acquaintance (If you've ever met)
	CASE "ヤラせちゃった"
		LOCALS = We fucked (Before consent)
	CASEELSE
		LOCALS = %ARGS%
ENDSELECT
RETURNF LOCALS

;shorthand instead of remembering the exact code
;@HAS_PENIS(ARG)
;#FUNCTION
;RETURNF (TALENT:ARG:性別 & 2) == 2

@CLOTHES_TYPE_TR(ARGS)
#FUNCTIONS
SELECTCASE ARGS
	CASE "おきにいり衣装"
		LOCALS = favorite costume
	CASE "普段着"
		LOCALS = casual wear
	CASE "現在の衣装"
		LOCALS = current costume
	CASEELSE
		LOCALS = %ARGS%
ENDSELECT
RETURNF LOCALS

@CLOTHES_CAT_TR(ARGS)
#FUNCTIONS
SELECTCASE ARGS
	CASE "基本衣装セット"
		LOCALS = Normal costumes
	CASE "コスプレ衣装セット"
		LOCALS = Cosplay costumes
	CASE "キャラ特殊衣装セット"
		LOCALS = Special character costumes
	CASE "現在の衣装"
		LOCALS = Current clothes
	CASE "今日の衣装"
		LOCALS = Everyday clothes
	CASE "今日のパジャマ"
		LOCALS = Everyday pajamas
	CASE "おきにいり衣装"
		LOCALS = Everyday casual wear
	CASEELSE
		LOCALS = %ARGS%
ENDSELECT
RETURNF LOCALS

@WEAREDPANTIES_TRANSPARENCY_TR(ARGS)
#DIM ぱんつ状況

;パンツを奪ったorもらったor元から穿いてない場合
IF CFLAG:ノーパン || (CFLAG:205 == 0 && CFLAG:206 == 0)
	ぱんつ状況 = 0
;パンツを一旦脱いでいた場合
ELSEIF !EQUIP:下半身下着１ && !EQUIP:下半身下着２
	ぱんつ状況 = 1
ELSE
	ぱんつ状況 = 2
ENDIF


IF !ぱんつ状況
	PRINTFORMDL %CALLNAME:TARGET% doesn't have any underwear to put on.
	IF ARGS == "SPERM"
		PRINTFORMDL %CALLNAME:TARGET% has to make do without them for today, leaving %HIM_HER(TARGET)% with nothing to stop the %EXPR_VAR("SPERM")% from dripping down %HIS_HER(TARGET)% leg.
	ELSE
		PRINTFORMDL %CALLNAME:TARGET% has to make do without them for today, leaving %HIM_HER(TARGET)% with nothing to hide %HIS_HER(TARGET)% drenched %EXPR_VAR("CROTCH")%.
	ENDIF
;パンツがある場合
ELSE
	IF ぱんつ状況 == 1
		PRINTFORMDL %CALLNAME:TARGET% puts %HIS_HER(TARGET)% underwear back on.
		PRINTFORMD They 
	ELSE
		PRINTFORMD %CALLNAME:TARGET%'s panties 
	ENDIF
	PRINTFORMD are 
	SELECTCASE RAND:3
	CASE 0
		PRINTFORMD sopping wet from 
	CASE 1
		PRINTFORMD drenched with 
	CASEELSE
		PRINTFORMD soaked with 
	ENDSELECT
	IF ARGS == "SPERM"
		PRINTFORMD %EXPR_VAR("SPERM")% that leaks out
	ELSE
		PRINTFORMD an unending torrent of fluid
	ENDIF
	;パンツが透けうる場合
	IF PANTIES_TRANSPARENCY(TARGET)
		PRINTFORMD  making them transparent, revealing the contours of %HIS_HER(TARGET)% \@TALENT:TARGET:2 == 2 || TALENT:TARGET:2 == 3?%TINKO_TR(TARGET)% #%SLIT_TR(TARGET,1)%\@.
	ELSE
		PRINTFORMD .
	ENDIF
	CALL PRINT_BREAK,,"dc"
ENDIF

;ARG - whose ass it is
;LONG ensures it stays long
;ARG:1 - stops prevention of duplicates
;Max length - 24 with SHORT, else 60+
@HIP_TR(ARG, LONG = 0, ARG:1)
#FUNCTIONS
#DIM LONG
VARSET LOCALS
;Custom code, moved adjective-structure around
IF TALENT:ARG:体型 == -2
	SELECTCASE RAND:2
	CASE 0
		LOCALS += "small and smooth ass"
	CASE 1
		LOCALS += "cutesy ass"
	ENDSELECT
ELSEIF TALENT:ARG:バストサイズ < 0
	SELECTCASE RAND:3
	CASE 0
		LOCALS += "thin ass"
	CASE 1
		LOCALS += "slender ass"
	CASE 2
		LOCALS += "small ass"
	ENDSELECT
ELSEIF TALENT:ARG:バストサイズ - CFLAG:ARG:乳ランクアップ > 0
	SELECTCASE RAND:4
	CASE 0
		LOCALS += "well-padded ass"
	CASE 1
		LOCALS += "plentiful ass"
	CASE 2
		LOCALS += "plump ass"
	CASE 3
		LOCALS += "voluptuous ass"
	;Removed "child-bearing" since it could sort of duplicate
	ENDSELECT
ELSE
	SELECTCASE RAND:5
	CASE 0
		IF CFLAG:ARG:乳ランクアップ
			LOCALS += "maternal and rounded ass"
		ELSE
			LOCALS += "shapely ass"
		ENDIF
	CASE 1
		LOCALS += "supple ass"
	CASE 2
		LOCALS += "tight ass"
	CASE 3
		LOCALS += "slender ass"
	CASE 4
		LOCALS += "juicy ass"
	ENDSELECT
ENDIF
IF !LONG
	IF LOCALS == LOCALS:1 && !ARG:1 ;If it is about to return the same thing in a row
		FOR LOCAL, 0, 3
			LOCALS = %HIP_TR(ARG, LONG, 1)%
			SIF LOCALS != LOCALS:1
				BREAK
		NEXT
	ENDIF
	SIF !ARG:1
		LOCALS:1 = LOCALS
	RETURNF LOCALS
ENDIF
IF PALAM:ARG:欲情 >= PALAMLV:4 && !RAND:6
	;Nopan should block this, but somehow doesn't
	IF CFLAG:ARG:ノーパン || STRCOUNT(TOLOWER(PANTSNAME(EQUIP:ARG:下半身下着２, ARG)), "no underwear")
		LOCALS += " dripping with beads of sweat"
	ELSE
		LOCALS += @", %HIS_HER(ARG)% %PANTSNAME(EQUIP:ARG:下半身下着２, ARG)% clinging to the skin, transparent with sweat"
	ENDIF
ELSEIF !RAND:5 && EXP:ARG:出産経験 && TALENT:ARG:バストサイズ <= 0
	LOCALS += @" that belies her having given birth to {EXP:ARG:出産経験} children"
ELSEIF !RAND:5 && TALENT:ARG:バストサイズ > 0
	LOCALS += " that seems made to rear children"
ENDIF
IF LOCALS == LOCALS:1 && !ARG:1 ;If it is about to return the same thing in a row
	FOR LOCAL, 0, 3
		LOCALS = %HIP_TR(ARG, LONG, 1)%
		SIF LOCALS != LOCALS:1
			BREAK
	NEXT
ENDIF
SIF !ARG:1
	LOCALS:1 = LOCALS
RETURNF LOCALS

@MESSAGE_COM416_TR
#DIM DYNAMIC 楽器弾き
#DIM DYNAMIC 歌唄い
#DIMS DYNAMIC 楽器筆頭
#DIMS DYNAMIC 歌筆頭
VARSET LOCAL
LOCAL = -1
WHILE 1
	SIF LOCAL >= (CHARANUM - 1)
		BREAK
	LOCAL = FINDCHARA(TALENT:音楽知識, 1, LOCAL + 1)
	SIF LOCAL < 0
		BREAK
	SIF !LOCAL
		CONTINUE
	IF CFLAG:MASTER:現在位置 == CFLAG:LOCAL:現在位置
		IF !ACCOMPANY_ABLE(LOCAL) || TARGET == LOCAL
			CONTINUE
		ELSE
			IF !楽器弾き
				楽器筆頭 = %CALLNAME:LOCAL%
			ELSEIF !RAND:楽器弾き
				楽器筆頭 = %CALLNAME:LOCAL%
			ENDIF
			楽器弾き ++
		ENDIF
	ENDIF
WEND
LOCAL:1 = -1
WHILE 1
	LOCAL:1 = FINDCHARA(TALENT:音楽知識, 2, LOCAL:1 + 1)
	SIF LOCAL:1 <0
		BREAK
	SIF !LOCAL:1
		CONTINUE
	IF CFLAG:MASTER:現在位置 == CFLAG:(LOCAL:1):現在位置
		IF !ACCOMPANY_ABLE(LOCAL:1) || TARGET == LOCAL:1
			CONTINUE
		ELSE
			IF !歌唄い
				歌筆頭 = %CALLNAME:(LOCAL:1)%
			ELSEIF !RAND:歌唄い
				歌筆頭 = %CALLNAME:(LOCAL:1)%
			ENDIF
			歌唄い ++
		ENDIF
	ENDIF
WEND
SIF 楽器弾き > 1
	楽器筆頭 += " group"
SIF 歌唄い > 1
	歌筆頭 += " group"
IF TFLAG:使用楽器 != 0
	PRINTFORM %PARSE("You play")% the 
	SELECTCASE TFLAG:使用楽器
		CASE 1
			PRINT keyboard
		CASE 2
			PRINT piano
		CASE 3
			PRINT guitar
		CASE 4
			PRINT trumpet
		CASE 5
			PRINT violin
	ENDSELECT
	;楽器持ちキャラ、プリリバ三姉妹と九十九姉妹と雷鼓がTARGETで彼女らの音楽技能を上回っている
	IF TARGET > 0 && (ABL:MASTER:音楽技能 >= ABL:TARGET:音楽技能) && TALENT:TARGET:音楽知識 == 1 && ACCOMPANY_ABLE(TARGET)
		PRINTFORM  along with %CALLNAME:TARGET%
	;歌唱キャラ、ミスティアと響子、エレンがTARGETで彼女らの音楽技能を上回っている
	ELSEIF TARGET > 0 && (ABL:MASTER:音楽技能 >= ABL:TARGET:音楽技能) && TALENT:TARGET:音楽知識 == 2 && ACCOMPANY_ABLE(TARGET)
		PRINTFORM  accompanied by %CALLNAME:TARGET%'s singing
	;あなたの音楽技能がTARGETより低いかTARGETが音楽知識を持っている
	ELSEIF TARGET > 0 && (ABL:MASTER:音楽技能 <= ABL:TARGET:音楽技能 || TALENT:TARGET:音楽知識)
		PRINTFORM  under the supervision of %CALLNAME:TARGET%
	ELSEIF 楽器弾き && 歌唄い
		PRINTFORM  along with %楽器筆頭%, accompanied by %歌筆頭%'s singing
		LOCAL:2 = 3
	ELSEIF 楽器弾き
		PRINTFORM  along with %楽器筆頭%
		LOCAL:2 = 2
	ELSEIF 歌唄い
		PRINTFORM  accompanied by %歌筆頭%'s singing
		LOCAL:2 = 1
	ENDIF
	PRINTL .
	IF TFLAG:193 == 1
		IF LOCAL:2
			IF TARGET && !GROUPMATCH(TARGET,20,21,22,28,44,88,94,95,96)
				PRINTFORM %CALLNAME:TARGET% \@ IN_ROOM_NUMBER(CFLAG:MASTER:現在位置) > 2 ? and the others are # is \@ absorbed listening to %PARSE("your")%
				IF LOCAL:2 == 3
					PRINTFORM , %楽器筆頭%'s, and %歌筆頭%'s improvised live performance
				ELSEIF LOCAL:2 == 2
					PRINTFORM  and %楽器筆頭%'s ensemble
				ELSEIF LOCAL:2 == 1
					PRINTFORM  and %歌筆頭%'s duet
				ENDIF
				PRINTFORML .
			ELSE
				PRINTFORML %CALLNAME:TARGET% greatly enjoys listening to %PARSE("your")% jamming.
			ENDIF
		ELSE
			IF TARGET
				IF !GROUPMATCH(TARGET,20,21,22,28,44,88,94,95,96)
					PRINTFORM %CALLNAME:TARGET% \@ IN_ROOM_NUMBER(CFLAG:MASTER:現在位置) > 2 ? and the others are# is\@ absorbed listening to %PARSE("you")%.
				ELSE
					PRINTFORML %CALLNAME:TARGET% greatly enjoys listening to %PARSE("your")% jamming.
				ENDIF
			ELSEIF (WITH_MOB() || DATE_HITOGOMI()) && !GROUPMATCH(TIME:2,1,6,7)
				PRINTFORML \@ (MAIN_MAP !=9 && CFLAG:MASTER:現在位置 == 960) || (IN_HOME(CFLAG:MASTER:現在位置) && !CHK_FOCUS(927,CFLAG:MASTER:現在位置,948) && (ROOMDATA:(CFLAG:MASTER:現在位置 % 100) & 場所_モブ)) ? %ANIMALNAME()% # %DATE_HITOGOMI_SYUBETU()% \@ is absorbed listening by %PARSE("your")% side.
			ELSE
				PRINTFORML The amazing musical piece falls unfortunately on no ears...
			ENDIF
		ENDIF
	ELSEIF TFLAG:193 == -1
		IF LOCAL:2
			IF TARGET && !GROUPMATCH(TARGET,20,21,22,28,44,88,94,95,96)
				PRINTFORM %CALLNAME:TARGET% is grimacing while enduring %PARSE("your")%
				IF LOCAL:2 == 3
					PRINTFORM , %楽器筆頭%'s, and %歌筆頭%'s
				ELSEIF LOCAL:2 == 2
					PRINTFORM  and %楽器筆頭%'s
				ELSEIF LOCAL:2 == 1
					PRINTFORM  and %歌筆頭%'s
				ENDIF
				PRINTFORML  cacophony.
			ELSE
				PRINTFORML %CALLNAME:TARGET% runs away from %PARSE("your")% "musical" session in a hurry.
			ENDIF
		ELSE
			IF TARGET
				PRINTFORML %CALLNAME:TARGET% has both %HIS_HER(TARGET)% hands over %HIS_HER(TARGET)% ears.
			ELSEIF WITH_MOB() || DATE_HITOGOMI()
				PRINTFORML \@ (MAIN_MAP !=9 && CFLAG:MASTER:現在位置 == 960) || (IN_HOME(CFLAG:MASTER:現在位置) && !CHK_FOCUS(927,CFLAG:MASTER:現在位置,948) && (ROOMDATA:(CFLAG:MASTER:現在位置 % 100) & 場所_モブ)) ? %ANIMALNAME()% # %DATE_HITOGOMI_SYUBETU()% \@ ran away from %PARSE("your")% side in a hurry.
			ELSE
				PRINTFORML The loud cacophony is disturbing the surrounding area.
			ENDIF
		ENDIF
	ELSE
		IF LOCAL:2
			IF TARGET && !GROUPMATCH(TARGET,20,21,22,28,44,88,94,95,96)
				PRINTFORM %CALLNAME:TARGET% \@ IN_ROOM_NUMBER(CFLAG:MASTER:現在位置) > 2 ? and the others are # is \@ watching %PARSE("your")%
				IF LOCAL:2 == 3
					PRINTFORM , %楽器筆頭%'s, and %歌筆頭%'s improvised jamming session
				ELSEIF LOCAL:2 == 2
					PRINTFORM  and %楽器筆頭%'s ensemble
				ELSEIF LOCAL:2 == 1
					PRINTFORM  and %歌筆頭%'s duet
				ENDIF
				PRINTFORML  in admiration.
			ELSE
				PRINTFORML %CALLNAME:TARGET% enjoys listening to %PARSE("your")% jamming.
			ENDIF
		ELSE
			IF TARGET
				IF !GROUPMATCH(TARGET,20,21,22,28,44,88,94,95,96)
					PRINTFORML %CALLNAME:TARGET% \@ IN_ROOM_NUMBER(CFLAG:MASTER:現在位置) > 2 ? and the others are # is \@ listening in admiration.
				ELSE
					PRINTFORML %CALLNAME:TARGET% enjoys listening to %PARSE("your")% jamming.
				ENDIF
			ELSEIF WITH_MOB() || DATE_HITOGOMI()
				PRINTFORML \@ (MAIN_MAP !=9 && CFLAG:MASTER:現在位置 == 960) || (IN_HOME(CFLAG:MASTER:現在位置) && !CHK_FOCUS(927,CFLAG:MASTER:現在位置,948) && (ROOMDATA:(CFLAG:MASTER:現在位置 % 100) & 場所_モブ)) ? %ANIMALNAME()% # %DATE_HITOGOMI_SYUBETU()% \@ is leaning against %PARSE("you")%.
			ELSE
				PRINTFORML The musical performance falls on no ears.
			ENDIF
		ENDIF
	ENDIF
ENDIF

;process giving you the music scores after good performance (from original function)
;楽譜入手処理
PRINTL
LOCAL = -1
SIF TFLAG:193 == 1
	LOCAL = 楽譜入手_演奏大成功(TARGET)
SIF (LOCAL == -1) && TARGET && (TFLAG:193 != -1) && (RAND:(100) < 30)
	RESULT = 楽譜入手_ランダム()

;Like textr but it checks against duplication, registering if needed
@USE_WORDS(ARGS)
#DIM DYNAMIC FOUND_WORD
#DIMS DYNAMIC STR_ARRAY, 100
#DIM DYNAMIC SHAFFLE_TEMP, 100
#DIMS DYNAMIC CHOSEN_WORD
#DIM LAST_RESULT
#DIM WORD_COUNT
#FUNCTIONS

LAST_RESULT = RESULT ;Store the result from before
SPLIT ARGS, "/", STR_ARRAY ;Split the string, the amount of resulting strings is RESULT
WORD_COUNT = RESULT ;Save the amount of words
CALLF FUNC_FISHER_YATES_SHAFFLE(SHAFFLE_TEMP, WORD_COUNT) ;Sets SHAFFLE_TEMP to be a random enumeration of STR_ARRAY

FOR LOCAL, 0, WORD_COUNT ;For every word
	IF !USED_WORD(STR_ARRAY:(SHAFFLE_TEMP:LOCAL)) ;If it hasn't been used
		CHOSEN_WORD '= @"%USE_WORD(STR_ARRAY:(SHAFFLE_TEMP:LOCAL))%" ;Select it as chosen
		FOUND_WORD = 1
		GOTO DONE
	ENDIF
NEXT
SIF FOUND_WORD == 0
	CHOSEN_WORD '= @"%STR_ARRAY:(SHAFFLE_TEMP:0)%"

$DONE
RESULT = LAST_RESULT
RETURNF CHOSEN_WORD

;Registers a word as being used and returns it
@USE_WORD(ARGS)
#DIM DYNAMIC FOUND_WORD
#DIM LAST_RESULT
#FUNCTIONS
LAST_RESULT = RESULT ;Store the result from before

FOR LOCAL, 0, USED_WORDS_I
	IF USED_WORDS:LOCAL == BASE_FORM(TOLOWER(ARGS))
		FOUND_WORD = 1
		BREAK
	ENDIF
NEXT
IF !FOUND_WORD
	USED_WORDS:USED_WORDS_I '= BASE_FORM(TOLOWER(ARGS))
	USED_WORDS_I ++
ENDIF
RESULT = LAST_RESULT
RETURNF ARGS

;Returns true if a word has been used
@USED_WORD(ARGS)
#FUNCTION
FOR LOCAL, 0, USED_WORDS_I
	IF USED_WORDS:LOCAL == BASE_FORM(TOLOWER(ARGS))
		RETURNF 1
	ENDIF
NEXT
RETURNF 0

;Does each case independently 
@VENT_TR(ARGS)
#FUNCTIONS
SELECTCASE ARGS
	CASE "新しいスペルカードはどんなのがいいかな？"
		LOCALS = Do you have any ideas for a new Spell Card?
	CASE "新しいスペルカードはどんなのがいいかしら？"
		LOCALS = What would a cool new Spell Card look like?
	CASE "新しいスペルカードはどんなのがいいでしょうか？"
		LOCALS = I need inspiration for a new Spell Card.
	CASE "今日の晩酌は何がいいと思うかしら？"
		LOCALS = What should I have as drink for the dinner?
	CASE "今日の晩酌は何がいいと思うかしら？"
		LOCALS = I don't know what drink to have for dinner.
	CASE "今日の晩酌は何がいいと思いますか？"
		LOCALS = Do you have any recommendations for what I should drink for the dinner?
	CASE "今日の晩酌はどうしよう？"
		LOCALS = How should I drink tonight?
	CASE "今日の晩酌はどうしようかしら？"
		LOCALS = Should I just get hammered this evening or?
	CASE "今日の晩酌はどうしましょう？"
		LOCALS = How should I handle myself in regards to alcohol this evening?
	CASE "新しく本を読むならどれがいいかな？"
		LOCALS = Do you have any book recommendations?
	CASE "新しく本を読むならどれがいいかしら？"
		LOCALS = You know any good books?
	CASE "新しく本を読むならどれがいいでしょうか？"
		LOCALS = I find myself wanting for reading materials.
	CASE "部屋に香料を置くならどれがいいかな？"
		LOCALS = What incense should I use in my room?
	CASE "部屋に香料を置くならどれがいいかしら？"
		LOCALS = What should my room smell like?
	CASE "部屋に香料を置くならどれがいいでしょうか？"
		LOCALS = What fragrance should I use in my room?
	CASE "気分転換にいい音楽はどれかな？"
		LOCALS = I need something to listen to.
	CASE "気分転換にいい音楽はどれかしら？"
		LOCALS = Got any cool song recommendations?
	CASE "気分転換にいい音楽はどれでしょうか？"
		LOCALS = What music do you propose I should listen to?
	CASE "東方の曲ってどれがいいかな？"
		LOCALS = What are the best songs from Touhou?
	CASE "東方の曲ってどれがいいかしら？"
		LOCALS = What're the best songs from Touhou?
	CASE "東方の曲ってどれがいいでしょうか？"
		LOCALS = Which type of Touhou theme is your favorite?
	CASE "衣替えするならどんな服がいいかな？"
		LOCALS = I want to get some clothes that fits the season better.
	CASE "衣替えするならどんな服がいいかしら？"
		LOCALS = I wanna wear something different, you know?
	CASE "衣替えするならどんな服がいいでしょうか？"
		LOCALS = I feel it is time for a wardrobe change, any recommendations?
	CASE "髪を切ろうと思うんだけど、どんな髪型にしようかな？"
		LOCALS = I'm thinking of getting a haircut, what kind should I get?
	CASE "髪を切ろうと思うんだけど、どんな髪型にしようかしら？"
		LOCALS = I'm gonna cut my hair, what hairstyle should I get?
	CASE "髪を切ろうと思うんだけど、どんな髪型にしようでしょうか？"
		LOCALS = I have considered a change in hairstyle, do you have any input on the matter?
	CASE "願掛けに行くならどこがいいかな？"
		LOCALS = Where should I go to pray?
	CASE "願掛けに行くならどこがいいかしら？"
		LOCALS = I'm looking for some place to pray.
	CASE "願掛けに行くならどこがいいでしょうか？"
		LOCALS = Where should I go to commune?
	CASE "お腹のお肉が気になるのだけど、どうしたらいいかな？"
		LOCALS = My stomach has been acting up recently.
	CASE "お腹のお肉が気になるのだけど、どうしたらいいかしら？"
		LOCALS = My stomach hurts!
	CASE "お腹のお肉が気になるのだけど、どうしたらいいでしょうか？"
		LOCALS = I've been struggling with indigestion as of late.
	CASE "家庭菜園で何を作ろうかな？"
		LOCALS = It's about time to start sowing again...
	CASE "家庭菜園で何を作ろうかしら？"
		LOCALS = What should I grow in the garden?
	CASE "家庭菜園で何を作ろうでしょうか？"
		LOCALS = I am unsure what I should grow in the garden.
	CASE "プランターで何を育てようかな？"
		LOCALS = What should I put in my planter?
	CASE "プランターで何を育てようかしら？"
		LOCALS = I need to put something in my planter.
	CASE "プランターで何を育てようでしょうか？"
		LOCALS = I should sow something my planter.
	CASE "次の休日は何をして過ごそうかな？"
		LOCALS = What should I do during my next holiday?
	CASE "次の休日は何をして過ごそうかしら？"
		LOCALS = I've got no idea what to do next holiday.
	CASE "次の休日は何をして過ごそうでしょうか？"
		LOCALS = What activities should I undertake during my next day off?
	CASE "最近人気が落ちてる気がする"
		LOCALS = Feels like my popularity has been dropping.
	CASE "最近人気が落ちてる気がするわ"
		LOCALS = I'm worried my popularity's slipping.
	CASE "最近人気が落ちてる気がします"
		LOCALS = I am concerned about the yearly popularity poll.
	CASE "最近どうも気が抜けてるなぁ"
		LOCALS = Maaan, I've been feeling a little out of it lately...
	CASE "最近どうも気が抜けてるわ"
		LOCALS = I've noticed that I've been out of sorts as of late...
	CASE "最近どうも気が抜けてます"
		LOCALS = I have been feeling lethargic recently...
	CASE "最初の三匹のうちどれにしよう？"
		LOCALS = Which one of the three starters should I choose?
	CASE "最初の三匹のうちどれにしようかしら？"
		LOCALS = Which starter's the best?
	CASE "最初の三匹のうちどれにしましょう？"
		LOCALS = Which of the three starters has the greatest utility?
	CASE "何タイプに進化させよう？"
		LOCALS = What type should I evolve it into?
	CASE "何タイプに進化させようかしら？"
		LOCALS = What should I evolve it into?
	CASE "何タイプに進化させましょう？"
		LOCALS = What type should I evolve it into?
	CASEELSE
		LOCALS = %ARGS%
ENDSELECT
RETURNF LOCALS

;Returns the base form of a verb, driving -> drive
;Always returns lower case
@BASE_FORM(ARGS)
#DIMS BASE_WORD
#FUNCTIONS
BASE_WORD '= ARGS
IF STRCOUNT(ARGS, " ") > 0
	SPLIT ARGS, " ", LOCALS 
	BASE_WORD '= LOCALS:0
ENDIF
;if it ends with -ing
;check special case
;else replace -ing with -e
IF WORD_ENDS_IN(BASE_WORD, "ing")
	SELECTCASE BASE_WORD
		CASE "driving", "forcing"
			BASE_WORD '= REPLACE(BASE_WORD, "ing$", "e")
		CASEELSE
			BASE_WORD '= REPLACE(BASE_WORD, "ing$", "")
	ENDSELECT
ENDIF
RETURNF BASE_WORD
;ARG - Whose dick it is
;ARG:1 - makes it longer
;ARG:2 - stops prevention of duplicates
;Max length: at least 29
@TINKO_TR(ARG, ARG:1, ARG:2)

#FUNCTIONS
;Custom code, I VARSET LOCAL just in case
VARSET LOCAL
VARSET LOCALS
SIF !ARG
	ARG = MASTER
SIF !HAS_PENIS(ARG)
	RETURNF "strapon"
;地の文と辻褄合わせが必要なのでとりあえず汚れ描写は保留
[SKIPSTART]
IF GETBIT(STAIN:ARG:2,64)
	LOCALS = 破瓜血
	LOCAL ++
ENDIF
IF GETBIT(STAIN:ARG:2,8)
	SIF LOCAL
		LOCALS += "と"
	LOCALS += "腸液"
	LOCAL ++
ENDIF
IF GETBIT(STAIN:ARG:2,4)
	SIF LOCAL
		LOCALS += "と"
	LOCALS += "精液"
	LOCAL ++
ENDIF
IF GETBIT(STAIN:ARG:2,1)
	SIF LOCAL
		LOCALS += "と"
	LOCALS += "愛液"
	LOCAL ++
ENDIF
SIF LOCAL
	LOCALS += "にまみれた"
[SKIPEND]
;確率で形容詞がつく
IF !RAND:4 && ARG == MASTER && TCVAR:ARG:100 != TARGET && TCVAR:ARG:101 != TARGET
	IF BASE:ARG:勃起 > 1000 
		SELECTCASE RAND:5
			CASE 0
				LOCALS += "twitching "
			CASE 1
				LOCALS += "stiffened "
			CASE 2
				LOCALS += "engorged "
			CASE 3
				LOCALS += "precum-oozing "
			CASE 4
				LOCALS += "hard "
		ENDSELECT
	ELSEIF BASE:ARG:勃起 > 500
		SELECTCASE RAND:3
			CASE 0
				LOCALS += "increasingly hard "
			CASE 1
				LOCALS += "hardening "
			CASE 2
				LOCALS += "semi-erect "
		ENDSELECT
	ELSE
		LOCALS += "still soft "	
	ENDIF
ELSEIF !RAND:3
	SELECTCASE TALENT:ARG:形状
		CASE 1
			;未熟
			SELECTCASE RAND:3
				CASE 0
					LOCALS += "adorable "
				CASE 1
					LOCALS += "child-like "
				CASE 2
					LOCALS += "cutesy "
			ENDSELECT
		CASE 2
			;粗末
			LOCALS += "thin "
		CASE 3
			;普通
			;LOCALS += "robust "
		CASE 4
			;光る
			SELECTCASE RAND:3
				CASE 0
					LOCALS += "sparkling "
				CASE 1
					LOCALS += "flickering "
				CASE 2
					LOCALS += "shining "
			ENDSELECT
		CASE 5
			SELECTCASE RAND:3
				CASE 0
					LOCALS += "grotesque "
				CASE 1
					LOCALS += "brutal "
				CASE 2
					LOCALS += "warty "
			ENDSELECT
		CASE 6
			;ごんぶと
			LOCALS += "long "
		CASE 10
			;馬並
			LOCALS += "horse-length "
	ENDSELECT
ELSEIF ARG == MASTER && TARGET && ARG:1
	IF !RAND:3
		;Custom code, add this to the end instead
		LOCAL = 1
		
	ELSEIF !RAND:2 && 妊娠可否(TARGET) && CFLAG:TARGET:生理周期 == 7 && TEQUIP:TARGET:50 == MASTER
		LOCAL = 2
	ENDIF
ENDIF
SELECTCASE RAND:6
	CASE 0
		LOCALS += "manhood"
	CASE 1
		LOCALS += "cock"
	CASE 2
		LOCALS += "dick"
	CASE 3
		LOCALS += "prick"
	CASE 4
		LOCALS += "shaft"
	CASEELSE
		LOCALS += "penis"
ENDSELECT
IF LOCAL == 1
	IF TALENT:TARGET:妊娠
		LOCALS += @" that impregnated %HIM_HER(TARGET)%"
	ELSEIF GETBIT (CFLAG:TARGET:処女喪失対象,1)
		LOCALS += @" that made %HIM_HER(TARGET)% a woman"
	ENDIF
ELSEIF LOCAL == 2
	LOCALS += " brimming with semen"
ENDIF

IF LOCALS == LOCALS:1 && !ARG:2 ;If it is about to return the same thing in a row
	FOR LOCAL, 0, 3
		LOCALS = %TINKO_TR(ARG, ARG:1, ARG:2)%
		SIF LOCALS != LOCALS:1
			BREAK
	NEXT
ENDIF
SIF !ARG:2
	LOCALS:1 = LOCALS
RETURNF LOCALS

;note - 35 characters limit for dish name
@DISHNAME_TR(ARGS)
#FUNCTIONS
SIF ARGS == ""
	ARGS '= @"%DISH_NAME%"
SELECTCASE ARGS
	CASE "スシ"
		LOCALS = Sushi
	CASE "焼き魚"
		LOCALS = Grilled Fish
	CASE "煮魚"
		LOCALS = Boiled Fish
	CASE "蒲焼き"
		LOCALS = Grilled Eel
	CASE "生け作り"
		LOCALS = Ikizukuri
	CASE "マリネ"
		LOCALS = Marinated Fish
	CASE "ムニエル"
		LOCALS = Fish with Meuniere
	CASE "刺身"
		LOCALS = Sashimi
	CASE "照り焼き"
		LOCALS = Teriyaki
	CASE "竜田揚げ"
		LOCALS = Tatsutaage
	CASE "フィッシュカレー"
		LOCALS = Fish Curry
	CASE "スターゲイジーパイ"
		LOCALS = Stargazy Pie
	CASE "カエルのから揚げ"
		LOCALS = Deep-fried Frog
	CASE "カエルカレー"
		LOCALS = Frog Curry
	CASE "カエルのソテー"
		LOCALS = Sauteed Frog
	CASE "カエルの塩焼き"
		LOCALS = Salt-grilled Frog
	CASE "揚げローター"
		LOCALS = Deep-fried Rotor
	CASE "Eマッサージャ風ローターの湯引き"
		LOCALS = E-Massager Flavored Boiled Rotor
	CASE "クリキャップ用ローターの握り"
		LOCALS = Clit-cap Rotor Nigirizushi
	CASE "オナホール仕立てのローター煮込み"
		LOCALS = Onahole-shaped Rotor Stew
	CASE "サンドイッチ"
		LOCALS = Sandwich
	CASE "おにぎり"
		LOCALS = Onigiri
	CASE "ハンバーガー"
		LOCALS = Hamburger
	CASE "スコーン"
		LOCALS = Scone
	CASE "シウマイ"
		LOCALS = Shumai
	CASE "肉まん"
		LOCALS = Meat Bun
	CASE "フィッシュ＆チップス"
		LOCALS = Fish & Chips
	CASE "タコス"
		LOCALS = Taco
	CASE "たこ焼き"
		LOCALS = Takoyaki
	CASE "プリン"
		LOCALS = Pudding
	CASE "ケーキ"
		LOCALS = Cake
	CASE "ゼリー"
		LOCALS = Jelly
	CASE "タルト"
		LOCALS = Tart
	CASE "クッキー"
		LOCALS = Cookies
	CASE "パイ"
		LOCALS = Pie
	CASE "羊羹"
		LOCALS = Sweet Bean Jelly
	CASE "大福"
		LOCALS = Daifuku
	CASE "カステラ"
		LOCALS = Castella Sponge Cake
	CASE "団子"
		LOCALS = Dango
	CASE "フルーツ盛り合わせ"
		LOCALS = Fruit Platter
	CASE "パウンドケーキ"
		LOCALS = Pound cake
	CASE "あんみつ"
		LOCALS = Anmitsu
	CASE "マカロン"
		LOCALS = Macaron
	CASE "タピオカミルクティー"
		LOCALS = Tapioca Milk Tea
	CASE "やしょうま"
		LOCALS = Yashouma
	CASE "雑炊"
		LOCALS = Rice and Vegetable Porridge
	CASE "卵かけご飯"
		LOCALS = Egg on Rice
	CASE "野菜炒め"
		LOCALS = Fried Vegetables
	CASE "味噌汁"
		LOCALS = Miso Soup
	CASE "おひたし"
		LOCALS = Boiled Greens in Soy Sauce
	CASE "うどん"
		LOCALS = Udon Noodles
	CASE "素麺"
		LOCALS = Somen Noodles
	CASE "蕎麦"
		LOCALS = Soba Noodles
	CASE "ヲムレツ"
		LOCALS = Omelet
	CASE "シチュー"
		LOCALS = Stew
	CASE "ハンバーグ"
		LOCALS = Hamburg Steak
	CASE "グラタン"
		LOCALS = Gratin
	CASE "カレーライス"
		LOCALS = Curry and Rice
	CASE "しゃぶしゃぶ"
		LOCALS = Shabu-Shabu
	CASE "ラーメン"
		LOCALS = Ramen
	CASE "生姜焼き"
		LOCALS = Pork Fried with Ginger
	CASE "ステーキ"
		LOCALS = Steak
	CASE "油淋鶏"
		LOCALS = Yurinchi Chicken
	CASE "モッツァレラチーズとトマトのサラダ"
		LOCALS = Mozzarella Cheese & Tomato Salad
	CASE "ドーピングコンソメスープ"
		LOCALS = Doping Consomme Soup
	CASE "義大莉而鳥苗鳥肉"
		LOCALS = Chinese-Style Ostrich Carpaccio
	CASE "ギンギー料理"
		LOCALS = Gingy Dish
	CASE "天麩羅"
		LOCALS = Tempura
	CASE "やまもりごはん"
		LOCALS = Plate Full of Rice
	CASE "漬物に大盛り飯"
		LOCALS = Large Bowl of Rice with Tsukemono
	CASE "もやし炒め"
		LOCALS = Stir-fried Bean Sprouts
	CASE "モッツァレラチーズだけのサラダ"
		LOCALS = Mozzarella Cheese Only Salad
	CASE "大盛り飯"
		LOCALS = Large bowl of rice
	CASE "おひたさない"
		LOCALS = Boiled Greens Sans Greens
	CASE "のり巻き"
		LOCALS = Vinegar Onigiri
	CASE "かっぱ巻き"
		LOCALS = Kappa Maki
	CASE "フレンチトースト"
		LOCALS = French Toast
	CASE "ホットドッグ"
		LOCALS = Hot Dog
	CASE "ラピュタパン"
		LOCALS = Laputa Fried Egg on Toast
	CASE "コーンフレーク"
		LOCALS = Breakfast Cereal
	CASE "カロリーバー"
		LOCALS = Calorie Bar
	CASE "ポップコーン"
		LOCALS = Popcorn
	CASE "サラダ"
		LOCALS = Salad
	CASE "山菜サラダ"
		LOCALS = Sansai Salad
	CASE "漬物"
		LOCALS = Tsukemono
	CASE "ビーフン"
		LOCALS = Rice Vermicelli
	CASE "オムレツ"
		LOCALS = Omelette
	CASE "ゆでたまご"
		LOCALS = Boiled Egg
	CASE "肉じゃが"
		LOCALS = Meat and Potato Stew
	CASE "茶碗蒸し"
		LOCALS = Chawanmushi
	CASE "ロールキャベツ"
		LOCALS = Cabbage Roll
	CASE "ポトフ"
		LOCALS = Pot-au-feu
	CASE "キムチ"
		LOCALS = Kimchi
	CASE "イナゴの佃煮"
		LOCALS = Inago Tsukudani
	CASE "蜂の子"
		LOCALS = Hachinoko
	CASE "干物"
		LOCALS = Dried Fish
	CASE "茹でた枝豆"
		LOCALS = Boiled Edamame
	CASE "からあげ"
		LOCALS = Karaage
	CASE "フライドチキン"
		LOCALS = Fried Chicken
	CASE "フランクフルト"
		LOCALS = Frankfurt
	CASE "コロッケ"
		LOCALS = Croquette
	CASE "餃子"
		LOCALS = Gyoza
	CASE "フライ"
		LOCALS = Deep-Fried Fish
	CASE "塩焼き"
		LOCALS = Salt-Boiled Fish
	CASE "煮付け"
		LOCALS = Soy-Boiled Fish
	CASE "天ぷら"
		LOCALS = Tempura
	CASE "焼きいも"
		LOCALS = Roasted Sweet Potato
	CASE "フライドポテト"
		LOCALS = French Fries
	CASE "じゃがバター"
		LOCALS = Buttery Potatoes
	CASE "おしるこ"
		LOCALS = Sweet Red-Bean Soup
	CASE "豚汁"
		LOCALS = Pork Miso Soup
	CASE "コーンスープ"
		LOCALS = Corn Soup
	CASE "カップ麺"
		LOCALS = Cup Noodles
	CASE "ちくわ"
		LOCALS = Chikuwa
	CASE "納豆"
		LOCALS = Natto
	CASE "豆腐"
		LOCALS = Tofu
	CASE "梅干し"
		LOCALS = Dried Plum
	CASE "葛切り"
		LOCALS = Kuzukiri
	CASE "煎餅"
		LOCALS = Rice Crackers
	CASE "お茶漬け"
		LOCALS = Ochazuke
	CASE "たけのこごはん"
		LOCALS = Bamboo Rice
	CASE "赤飯"
		LOCALS = Sekihan
	CASE "カツ丼"
		LOCALS = Katsudon
	CASE "牛丼"
		LOCALS = Gyuudon
	CASE "親子丼"
		LOCALS = Oyakodon
	CASE "天丼"
		LOCALS = Tempura Rice
	CASE "海鮮丼"
		LOCALS = Seafood Bowl
	CASE "寿司"
		LOCALS = Sushi
	CASE "うな重"
		LOCALS = Unajuu
	CASE "オムライス"
		LOCALS = Omurice
	CASE "チャーハン"
		LOCALS = Chinese-style fried rice
	CASE "ドリア"
		LOCALS = Fish Doria
	CASE "粉末成形スシ"
		LOCALS = Reconstituted Sushi
	CASE "そば"
		LOCALS = Soba
	CASE "そうめん"
		LOCALS = Soumen
	CASE "担々麺"
		LOCALS = Dandan Noodles
	CASE "スパゲッティ"
		LOCALS = Spaghetti
	CASE "焼きそば"
		LOCALS = Yakisoba
	CASE "冷やし中華"
		LOCALS = Hiyashi Chuuka
	CASE "水炊き"
		LOCALS = Chicken Hot Pot
	CASE "すき焼き"
		LOCALS = Sukiyaki
	CASE "おでん"
		LOCALS = Oden
	CASE "チゲ鍋"
		LOCALS = Jjigae
	CASE "チーズフォンデュ"
		LOCALS = Cheese Fondue
	CASE "ボルシチ"
		LOCALS = Borscht
	CASE "ブレッドボウルシチュー"
		LOCALS = Bread Bown Stew
	CASE "ピザ"
		LOCALS = Pizza
	CASE "お好み焼き"
		LOCALS = Okonomiyaki
	CASE "麻婆茄子"
		LOCALS = Fried Eggplant with Red Pepper
	CASE "中華あんかけ"
		LOCALS = Chinese Ankake
	CASE "お子様ランチ"
		LOCALS = Kid's Meal
	CASE "キッシュ"
		LOCALS = Quiche
	CASE "おせち料理"
		LOCALS = New Year's Food
	CASE "七草粥"
		LOCALS = Nanakusa Rice
	CASE "恵方巻"
		LOCALS = Ehomaki
	CASE "年越し蕎麦"
		LOCALS = New Years Soba
	CASE "ローストチキン"
		LOCALS = Roast Chicken
	CASE "テスト料理"
		LOCALS = Test Dish
	CASE "ショートケーキ"
		LOCALS = Shortcake
	CASE "チョコレートケーキ"
		LOCALS = Chocolate Cake
	CASE "ホットケーキ"
		LOCALS = Pancake
	CASE "クレープ"
		LOCALS = Crepe
	CASE "シュークリーム"
		LOCALS = Cream Puff
	CASE "パフェ"
		LOCALS = Parfait
	CASE "カエルプリン"
		LOCALS = Frog Pudding
	CASE "ヨーグルト"
		LOCALS = Yoghurt
	CASE "アイスクリーム"
		LOCALS = Icecream
	CASE "ドーナツ"
		LOCALS = Donut
	CASE "りんご飴"
		LOCALS = Candied Apple
	CASE "まんじゅう"
		LOCALS = Manjuu
	CASE "栗きんとん"
		LOCALS = Kurikinton
	CASE "杏仁豆腐"
		LOCALS = Annin Tofu
	CASE "いちごとうふ"
		LOCALS = Strawberry Tofu
	CASE "月見団子"
		LOCALS = Tsukimi Dango
	CASE "ハロウィンケーキ"
		LOCALS = Halloween Cake
	CASE "クリスマスケーキ"
		LOCALS = Christmas Cake
	CASE "バイブライクローターアイス"
		LOCALS = Vibrator-shaped Rotor Icecream
	CASE "カットスイカ"
		LOCALS = Cut Watermelon
		
	;special recipes
	CASE "紅白まんじゅう"
		LOCALS = Kohaku Manjuu
	CASE "サニーサイドアップ"
		LOCALS = Sunny Side Up
	CASE "静かの海スープ"
		LOCALS = Sea of Tranquility Soup
	CASE "京丸牡丹鍋"
		LOCALS = Kyoumaru Peony Hot Pot
	CASE "水兵カレー"
		LOCALS = Sailor Curry
	CASE "イチゴスペシャル"
		LOCALS = Strawberry Special
	CASE "魔法のキノコソテー"
		LOCALS = Sauteed Magic Mushrooms
	CASE "闇ドーナツ"
		LOCALS = Darkness Donuts
	CASE "かき氷"
		LOCALS = Shaved Ice
	CASE "紅魔ランチ"
		LOCALS = Scarlet Devil Lunch
	CASE "真紅のブラッドスープ"
		LOCALS = Crimson Blood Soup
	CASE "ジンジャーブレッドマン"
		LOCALS = Gingerbread Man
	CASE "春のお花見弁当"
		LOCALS = Spring Flower Viewing Box Lunch
	CASE "春の鎮魂料理"
		LOCALS = Spring Requiem Dish
	CASE "白玉みつまめ"
		LOCALS = Hakugyoku Mitsumame
	CASE "猫まんま"
		LOCALS = Nekomanma
	CASE "お稲荷さん"
		LOCALS = Inarizushi
	CASE "ウミガメのスープ"
		LOCALS = Sea Turtle Soup
	CASE "ローヤルゼリー"
		LOCALS = Royal Jelly
	CASE "ヤツメウナギの蒲焼き"
		LOCALS = Lamprey Eel Kabayaki
	CASE "地獄ラーメン（極辛）"
		LOCALS = Hell Ramen (Extremely Hot!!!)
	CASE "やしょうま"
		LOCALS = Yashouma
	CASE "オンバシラスティック"
		LOCALS = Onbashira Stick
	CASE "のたもち"
		LOCALS = Notamochi
	CASE "天界フルーツパフェ"
		LOCALS = Celestial Fruit Parfait
	CASE "ゾンビ焼き"
		LOCALS = Zombie Barbecue
	CASE "核熱メルトダウンステーキ"
		LOCALS = Atomic Fire Meltdown Steak
	CASE "チーズケーキ"
		LOCALS = Cheesecake
	CASE "お化けこんにゃく"
		LOCALS = Obake Konnyaku Jelly
	CASE "未確認飛行料理"
		LOCALS = Unidentified Flying Dish
	CASE "プリンセスデザート"
		LOCALS = Princess Dessert
	CASE "ばけばケーキ"
		LOCALS = Bakebake Cake
	CASE "ハートフェルトファンシー"
		LOCALS = Heartfelt Fancy
	CASE "クランベリートラップ"
		LOCALS = Cranberry Trap
	CASE "キュウリのキューちゃん"
		LOCALS = Kyuuchan Cucumber
	CASE "狂気の赤い目玉焼き"
		LOCALS = Lunatic Red Fried Egg
	CASE "マジカルカップケーキ"
		LOCALS = Magical Cupcakes
	CASE "精進料理"
		LOCALS = Buddhist Vegetarian Cuisine
	CASE "恋する人形焼き"
		LOCALS = Ningyo-yaki In Love
	CASE "彩色小籠包"
		LOCALS = Colored Soup Dumplings
	CASE "悪魔のおにぎり"
		LOCALS = Devil's Onigiri
	CASE "やきもち"
		LOCALS = Yakimochi
	CASE "焼き鳥"
		LOCALS = Yakitori
	CASE "蓬莱のアイスの玉の枝"
		LOCALS = Jeweled Branch of Hourai Icecream
	CASE "ジビエ料理"
		LOCALS = Wild Game Dish
	CASE "ぼたん鍋"
		LOCALS = Boar Meat Hot Pot
	CASE "もみじ饅頭"
		LOCALS = Momiji Manjuu
	CASE "桜餅"
		LOCALS = Sakuramochi
	CASE "月見うどん"
		LOCALS = Tsukimi Udon
	CASE "ひまわりワッフル"
		LOCALS = Sunflower Waffle
	CASE "たぬきそば"
		LOCALS = Tanuki Soba
	CASE "鈴カステラ"
		LOCALS = Suzu Castella
	CASE "こびとのパン"
		LOCALS = Inchling's Bread
	CASE "超栄養ドリンク"
		LOCALS = Super Nutritional Supplement Drink
	CASE "飛頭饅頭"
		LOCALS = Flying Head Manjuu
	CASE "ゆきだるまアイス"
		LOCALS = Snowman Icecream
	CASE "鈴蘭団子"
		LOCALS = Suzuran Dango
	CASE "人魂わたあめ"
		LOCALS = Will-o'-the-wisp Cotton Candy
	CASE "紅葉の天ぷら"
		LOCALS = Maple Leaf Tempura
	CASE "スイートポテト"
		LOCALS = Sweet Potatoes
	CASE "ひなあられ"
		LOCALS = Hina-arare
	CASE "求聞雑炊"
		LOCALS = Perfect Memento Rice Porridge
	CASE "栄養効率サプリメント"
		LOCALS = Nutritionally Efficient Supplement
	CASE "桶茶碗蒸し"
		LOCALS = Bucket Chawanmushi
	CASE "虫パン"
		LOCALS = Bug Bread
	CASE "入道わたあめ"
		LOCALS = Nyuudou Cotton Candy
	CASE "深海料理"
		LOCALS = Deep Sea Cuisine
	CASE "ハングリータイガーステーキ"
		LOCALS = Hungry Tiger Steak
	CASE "わんこそば"
		LOCALS = Wanko Soba
	CASE "雷おこし"
		LOCALS = Kaminari Okoshi
	CASE "マーメイドパフェ"
		LOCALS = Mermaid Parfait
	CASE "びわゼリー"
		LOCALS = Biwa Jelly
	CASE "八つ橋"
		LOCALS = Yatsuhashi
	CASE "太鼓焼き"
		LOCALS = Taikoyaki
	CASE "逆さバーガー"
		LOCALS = Inverted Burger
	CASE "ウミサチヤマサチ"
		LOCALS = Umisachi Yamasachi
	CASE "にんじんしりしり"
		LOCALS = Ninjin Shirishiri
	CASE "フォンデュ・エソテリア"
		LOCALS = Fondue Esoteria
	CASE "ヴィナ・コーヒー"
		LOCALS = Vina Coffee
	CASE "ストロベリーダンゴ"
		LOCALS = Strawberry Dango
	CASE "鈴瑚印の団子"
		LOCALS = Ringo-style Dango
	CASE "謎の夢魂菓子"
		LOCALS = Mysterious Dream Soul Candy
	CASE "アビスバーガー"
		LOCALS = Abyss Burger
	CASE "三色地獄そぼろ丼"
		LOCALS = Three-colored Soborodon of Hell
	CASE "花蜜ゼリー"
		LOCALS = Nectar Jelly
	CASE "山の郷土料理"
		LOCALS = Local Mountain Cuisine
	CASE "犬まんま"
		LOCALS = Inumanma
	CASE "地蔵焼き"
		LOCALS = Jizo Cookies
	CASE "タナバタスターソーメン"
		LOCALS = Star Festival Somen
	CASE "忘れ茗荷の酢漬け"
		LOCALS = Forgetful Pickled Myoga
	CASE "マターラボッカ"
		LOCALS = Matarabocca
	CASE "イタ飯"
		LOCALS = Italian Food
	CASE "もやし炒め"
		LOCALS = Fried Bean Sprouts
	CASE "バベルタワーパンケーキ"
		LOCALS = Babel Tower Pancake
	CASE "活け造り"
		LOCALS = Ikizukuri
	CASE "ひよ子"
		LOCALS = Hyoko
	CASE "魚翅湯"
		LOCALS = Shark Fin Soup
	CASE "はにわまん"
		LOCALS = Haniwa Bun
	CASE "偶像仕立ての工芸菓子"
		LOCALS = Idol-tailored Crafted Sweets
	CASE "鬼形のホイボーロ"
		LOCALS = Demon-shaped Round Cookies
	CASE "鯢呑亭秘伝の煮付け"
		LOCALS = Geidontei's Secret Soy-boiled Stew
	CASE "剛欲な獣神の夕餉"
		LOCALS = Avaricious Animal God's Dinner
	CASEELSE
		LOCALS = %ARGS%
		SIF DISH_COMMENT == "※募集中です！！※"
			LOCALS = %REPLACE(DISH_NAME, "のスペシャルメニュー", "")%'s Special Dish
ENDSELECT

RETURNF LOCALS

@DISHTYPE_TR(ARGS)
#FUNCTIONS
SIF ARGS == ""
	ARGS '= @"%DISH_NAME%"
SELECTCASE ARGS
	CASE "軽食"
		LOCALS = Snack
	CASE "主食"
		LOCALS = Meal
	CASE "デザート"
		LOCALS = Dessert
	CASE "練習", "教わる"
		LOCALS = Practice
	CASE "教わる（済）"
		LOCALS = Practice (CMPL)
	CASE "なし"
		LOCALS = None
	CASE "媚薬"
		LOCALS = Aphrodisiac
	CASE "利尿剤"
		LOCALS = Diuretic
	CASE "惚れ薬"
		LOCALS = Love Potion
	CASE "睡眠薬"
		LOCALS = Sleeping Pill
	CASE "栄養強化剤"
		LOCALS = Nutrition Enhancer
	CASE "排卵誘発剤" ;addition custom code
		LOCALS = Ovulation Drug
	CASEELSE
		LOCALS = %ARGS%
ENDSELECT
RETURNF LOCALS

;can be almost as long as it needs to, but no longer than two lines (~250 characters?)
@DISHCOMMENT_TR(ARG)
#FUNCTIONS
SELECTCASE ARG
	;Snack
	CASE 101;おにぎり
		LOCALS = Made by rolling rice into a ball and wrapping it in nori seaweed. Easy to make and very portable.
	CASE 102;のり巻き
		LOCALS = Sushi made with vinegared rice wrapped in nori seaweed with sashimi. Also known as Makizushi.
	CASE 103;かっぱ巻き
		LOCALS = Vinegared rice rolled in nori seaweed with cucumbers. Popular among children.
		
	CASE 111;フレンチトースト
		LOCALS = A pan-fried bread dish in which sliced bread is soaked with a sweet seasoning. A breakfast staple.
	CASE 112;スコーン
		LOCALS = Bread baked with added sweeteners. Easy to make and delicious.
	CASE 113;サンドイッチ
		LOCALS = A bread dish with vegetables and eggs. Easy to eat even by hand.
	CASE 114;ハンバーガー
		LOCALS = A combination of meat base, vegetables, and cheese sandwiched vertically on a bun. Addictively delicious.
	CASE 115;ホットドッグ
		LOCALS = Sausage sandwiched in the slit of a partially sliced bun. Served with hot spices.
	CASE 116;ラピュタパン
		LOCALS = Toast with bacon and a fried egg on top, a breakfast that looks as good as it tastes.
	CASE 117;コーンフレーク
		LOCALS = A super simple breakfast of corn flakes mixed with milk.
	CASE 118;カロリーバー
		LOCALS = Nutritionally dense candy bar. Easy to make and easy to eat.
	CASE 119;ポップコーン
		LOCALS = A variety of corn kernel which expands and puffs up when heated. Often eaten when watching movies.
		
	CASE 121;サラダ
		LOCALS = A dish consisting mainly of raw vegetables dressed and served on a plate. Rich in nutrients.
	CASE 122;山菜サラダ
		LOCALS = A salad made with wild herbs. A little earthy.
	CASE 123;おひたし
		LOCALS = A Japanese-style side dish made by boiling vegetables and pouring soy sauce over them.
	CASE 124;漬物
		LOCALS = A dish made by pickling vegetables in salt and other ingredients and letting them marinate. Goes well with white rice.
	CASE 125;ビーフン
		LOCALS = A Chinese dish made by making rice starch into noodles and drying them. Also known as rice noodles.
	CASE 126;タコス
		LOCALS = A Mexican dish consisting of thin tortilla topped with a filling. Lots of spices are used.
	CASE 127;モッツァレラチーズとトマトのサラダ
		LOCALS = A classic Italian appetizer. The "harmony" of cheese and tomatoes is a～maaaaaaaazing!
		
	CASE 131;オムレツ
		LOCALS = A simple dish of scrambled eggs, fried and folded in a pan.
	CASE 132;ゆでたまご
		LOCALS = Eggs boiled in a pot without cracking them. It takes some skill to peel off the shell.
	CASE 133;肉じゃが
		LOCALS = A dish in which meat and potatoes are fried and simmered in a sweet sauce [umani]. An introductory dish for training in homemaking.
	CASE 134;茶碗蒸し
		LOCALS = A Japanese-style dish made by steaming a bowl with a mixture of egg custard and ingredients. Has a distinctive sweet taste.
	CASE 135;ロールキャベツ
		LOCALS = A dish of minced meat, vegetables, and other ingredients wrapped in a cabbage leaf and stewed.
	CASE 136;ポトフ
		LOCALS = A quintessential French family cuisine made by stewing poultry and vegetables for a long time. Very warming.
	CASE 137;キムチ
		LOCALS = A spicy pickled napa cabbage [hakusai] that originated on the Korean Peninsula. Counts as tsukemono [pickled vegetables].
	CASE 138;イナゴの佃煮
		LOCALS = A dish of rice grasshoppers simmered in a sweet and spicy sauce. It looks striking, but tastes similar to shrimp. You will eat them and be happy.
	CASE 139;蜂の子
		LOCALS = A dish of roasted bee larvae. It looks striking, but is rich in protein. You will eat them and be happy.
	CASE 140;干物
		LOCALS = Dry and preserved fish. The rich flavor and unique texture are addictive.
	CASE 141;茹でた枝豆
		LOCALS = As the name suggests, it's boiled edamame [green soybeans]. Definitely one to have with beer.
	CASE 142;からあげ
		LOCALS = A Japanese-style fried chicken, marinated in soy sauce and other ingredients prior, and then lightly coated with flour and deep-fried in oil.
	CASE 143;フライドチキン
		LOCALS = A Western-style fried chicken coated with flour or batter mixed with spices and deep fried.
	CASE 144;フランクフルト
		LOCALS = A huge German sausage skewered whole. Served with hot sauce.
	CASE 145;竜田揚げ
		LOCALS = Deep-fried fish coated with batter, similar to karaage. The name is a combination of the reddish color of the batter and the Tatsuta River, which turns red with autumn leaves.
	CASE 146;カエルのから揚げ
		LOCALS = Karaage made from the whole frog. Actually, it looks vaguely like fried chicken.
		
	CASE 151;たこ焼き
		LOCALS = A modern Japanese dish in which chopped octopus is wrapped in okonomiyaki-style dough with filling and rolled into a ball.
	CASE 152;コロッケ
		LOCALS = Boiled potatoes and vegetables are stuffed into a ball which is then coated and deep-fried. This dish seems to be a favorite on typhoon days for some weird reason.
	CASE 153;肉まん
		LOCALS = Chinese manjuu [steamed buns] made by mixing meat and chopped vegetables, wrapping them in a soft dough, and steaming them.
	CASE 154;餃子
		LOCALS = Chinese dumpling in which meat and chopped vegetables wrapped into a thinly rolled piece of dough, which is then steamed, fried or boiled. Also known as jiaozi or pot sticker.
	CASE 155;シウマイ
		LOCALS = Chinese dim sum snack, in which meat and chopped vegetables are wrapped in a very thin dough and steamed. Also known as steamed meat dumplings.
	CASE 156;フライ
		LOCALS = A dish made by deep-frying fish that has been sliced open and coated with batter.
	CASE 157;塩焼き
		LOCALS = A dish in which raw fish is sprinkled with salt and grilled. Also known as shioyaki.
	CASE 158;照り焼き
		LOCALS = A dish consisting of filleted fish grilled with a glaze of soy sauce, mirin, and sugar.
	CASE 159;煮付け
		LOCALS = A dish made by slowly stewing filleted fish in a spicy sweet sauce. Also known as simmered/braised fish or nitsuke.
	CASE 160;蒲焼き
		LOCALS = A dish consisting of filleted fish dipped in a sweet soy-based sauce before being cooked on a grill. Also known as kabayaki.
	CASE 161;ムニエル
		LOCALS = A Western-style teriyaki dish in which fish fillets are dredged in seasoned flour and then sauteed in butter.
	CASE 162;マリネ
		LOCALS = A dish in which fish is soaked in marinade for a long time to soften it.
	CASE 163;天ぷら
		LOCALS = An Edo-style dish in which fish is deep-fried using a special batter.
	CASE 164;カエルの塩焼き
		LOCALS = A dish consisting of grilled frogs sprinkled with salt. Delicious when filleted.
	CASE 165;カエルのソテー
		LOCALS = A dish of sauteed filleted frog meat.
		
	CASE 171;焼きいも
		LOCALS = Baked or roasted sweet potatoes. Their sweetness and flavor gets even better as they are baked.
	CASE 172;フライドポテト
		LOCALS = A dish made by cutting potatoes into long strips and deep-frying them in oil. The junk-food taste of it is irresistible.
	CASE 173;じゃがバター
		LOCALS = Baked potatoes with butter. Easy to make and delicious. Also known as baked potatoes.
	CASE 174;フィッシュ＆チップス
		LOCALS = A signature British dish consisting of battered and fried fish, and deep-fried chips.
		
	CASE 181;味噌汁
		LOCALS = A soup that is an essential part of the Japanese diet, seasoned with dashi [soup stock/broth] and miso [fermented condiment made from soybeans]. A variety of ingredients can be used.
	CASE 182;おしるこ
		LOCALS = A sweet porridge of azuki beans boiled and crushed, served in a bowl with mochi [rice cakes]. The flavor of the region is reflected in the soup. Also known as [o]shiruko.
	CASE 183;豚汁
		LOCALS = Miso soup with stewed pork and vegetables. Warms up the body to its very core. Also known as tonjiru.
	CASE 184;コーンスープ
		LOCALS = A soup made of corn simmered in a thick broth. Creamy hot and sweet.
	CASE 185;カップ麺
		LOCALS = Instant ramen noodles that can be made in three minutes by adding hot water. No, really, it takes only three minutes to make.
		
	CASE 191;ちくわ
		LOCALS = A tube-shaped fishcake made from fish paste wrapped around a bamboo stick and steamed or broiled. It's characterized by its gaping holes. The word chikuwa [bamboo ring] comes from the shape when it is sliced. 
	CASE 192;納豆
		LOCALS = Food made by fermenting soybeans to make them extra sticky. Highly nutritious and healthy food.
	CASE 193;豆腐
		LOCALS = A food made by solidifying soy milk using a special process. Light and easy to make, it goes well with a variety of dishes.
	CASE 194;梅干し
		LOCALS = Japanese preserved plums pickled in salt. Extremely sour. Also known as umeboshi.
	CASE 195;葛切り
		LOCALS = A dish made from powdered kudzu [arrowroot] starch in the form of noodles. Also known as Japanese clear jelly noodles.
	CASE 196;煎餅
		LOCALS = Food made by baking or grilling kneaded wheat flour and dipping it in soy sauce. Convenient to keep on hand for when you get a little peckish. Also known as senbei.
		
	;Meal
	CASE 201;やまもりごはん
		LOCALS = It's just a pile of cooked white rice. Makes you appreciate the taste of rice.
	CASE 202;卵かけご飯
		LOCALS = Rice mixed with a fresh raw egg. A breakfast staple. Also known as TKG [tamago-kake-gohan].
	CASE 203;お茶漬け
		LOCALS = Rice with green tea poured over it. If you are served this at someone else's house, they are probably asking you to leave.
	CASE 204;たけのこごはん
		LOCALS = Rice cooked with bamboo shoots. Delicious to eat in early spring.
	CASE 205;漬物に大盛り飯
		LOCALS = Literally a set meal with a large bowl of rice served with pickles. They complement each other well.
	CASE 206;赤飯
		LOCALS = Glutinous rice mixed with red azuki beans and steamed to turn red. Consumed on celebratory occasions such as anniversaries and other important events.
	CASE 207;雑炊
		LOCALS = A soup made by boiling cooked rice or rice gruel/porridge. Mild and good for digestion.
	CASE 208;カツ丼
		LOCALS = A bowl of rice topped with breaded pork cutlet. If you eat it before an important match, it will bring good luck.
	CASE 209;牛丼
		LOCALS = A bowl of rice topped with thinly sliced beef.
	CASE 210;親子丼
		LOCALS = A bowl of rice topped with chicken meat covered with beaten egg. It's called "oyako" [parent and child] because it uses chicken and egg.
	CASE 211;天丼
		LOCALS = A bowl of rice topped with two pieces of shrimp tempura. A standard menu item at soba noodle restaurants.
	CASE 212;海鮮丼
		LOCALS = A bowl of rice topped with a variety of seafood sashimi. It looks just as gorgeous as it tastes.
	CASE 213;寿司
		LOCALS = A quintessential Japanese dish consisting of vinegared rice topped with sashimi, this dish is synonymous with luxury.
	CASE 214;うな重
		LOCALS = Rice topped with eel kabayaki [broiled eel]. It's served in a stacked food box to add a high-class touch.
	CASE 215;オムライス
		LOCALS = A Japanese meets Western-style meal of rice with ketchup wrapped in an omelet.
	CASE 216;チャーハン
		LOCALS = A dish in which rice is stir-fried with other ingredients. The trick is to make the rice crispy.
	CASE 217;カレーライス
		LOCALS = A dish consisting of a plate half full of curry and half full of rice. Very spicy.
	CASE 218;ドリア
		LOCALS = Seafood pilaf topped with a cream sauce and baked in the oven.
	CASE 219;フィッシュカレー
		LOCALS = Curry rice served with seafood. The appearance alone is quite spectacular already.
	CASE 220;カエルカレー
		LOCALS = Curry rice served with frogs. It tastes almost like regular curry.
	CASE 221;粉末成形スシ
		LOCALS = A common type of sushi in Neosaitama, made from powdered fish that is formed into a paste and then molded.
		
	CASE 231;そば
		LOCALS = Traditional Japanese-style noodles made from buckwheat seeds. In summer, the noodles are served cold.
	CASE 232;うどん
		LOCALS = Udon is a thick Japanese-style noodle dish often compared to soba. In summer, the noodles are served cold.
	CASE 233;そうめん
		LOCALS = Very thinly sliced cold noodles eaten in summer. Served as is without garnish.
	CASE 234;ラーメン
		LOCALS = Traditional Chinese noodles served in a broth with chashu pork [roasted pork fillet].
	CASE 235;担々麺
		LOCALS = Chinese noodles with added spiciness and soboro meat [seasoned and friend minced meat]. A little different from the traditional one.
	CASE 236;スパゲッティ
		LOCALS = An Italian noodle dish made with special noodles (pasta). There are many different types.
	CASE 237;焼きそば
		LOCALS = Simple noodle dish made by stir-frying Chinese noodles with meat and vegetables. Very salty.
	CASE 238;冷やし中華
		LOCALS = A noodle dish unique to Japan in which boiled Chinese noodles are served chilly cold. A summer tradition.
		
	CASE 241;水炊き
		LOCALS = A hot pot dish using chicken as the main material with plain water to boil the rest. It brings out the flavor of each ingredient. Also known as mizutaki.
	CASE 242;すき焼き
		LOCALS = A hot pot dish using thin slices of beef as the main material stewed in seasoned broth with other ingredients. Also generally referred to as nabe.
	CASE 243;おでん
		LOCALS = A hot pot dish in which various ingredients are stewed in a broth of dried bonito flakes and kelp. A winter tradition.
	CASE 244;チゲ鍋
		LOCALS = A hot pot dish from the Korean Peninsula using kimchi-based broth with various ingredients stewed in it. Very spicy.
	CASE 245;しゃぶしゃぶ
		LOCALS = A hot pot dish of thinly sliced meat and vegetables quickly boiled in water and served with dipping sauces. If you eat it with girls who are currently going commando, then...
	CASE 246;チーズフォンデュ
		LOCALS = A Western-style hot pot dish in which melted cheese is stewed. Skewered bread is dipped in cheese and eaten.
	CASE 247;シチュー
		LOCALS = A Western-style stew. It warms the body.
	CASE 248;ボルシチ
		LOCALS = A bright red Eastern European soup dish made with beets. Not necessarily spicy.
	CASE 249;ブレッドボウルシチュー
		LOCALS = This fancy dish is made by using hard French bread as a bowl and filling it with stew.
	CASE 250;グラタン
		LOCALS = A French dish made by baking a cream sauce in the oven. The golden crust on top is delicious.
		
	CASE 261;ピザ
		LOCALS = A Western-style high-calorie dish made of bread dough topped with various ingredients and baked in the oven.
	CASE 262;お好み焼き
		LOCALS = A simple dish made with flour, cabbage and other ingredients of your choice, cooked on a teppan [flat griddle].
	CASE 263;麻婆茄子
		LOCALS = A Japanese meets Chinese-style dish made by frying and boiling ground meat, chili peppers, and eggplant. Also known as mabo-nasu.
	CASE 264;油淋鶏
		LOCALS = A Chinese-style dish consisting of deep-fried chicken topped with scallions and sauce.
	CASE 265;中華あんかけ
		LOCALS = A Chinese-style dish consisting of Chinese stir-fried ingredients topped with red bean paste (liu).
	CASE 266;野菜炒め
		LOCALS = A simple dish of stir-fried vegetables of various kinds.
	CASE 267;生姜焼き
		LOCALS = A Japanese-style meat dish consisting of fried pork briefly braised in ginger sauce. Also known as shougayaki.
	CASE 268;ステーキ
		LOCALS = A hearty meat dish made of high-quality, thick slab of meat grilled on an iron plate.
	CASE 269;ハンバーグ
		LOCALS = A meat dish in which ground meat is mixed with breadcrumbs, then kneaded and cooked. It's a version of Hamburg steak that resembles cutlets more than anything.
	CASE 270;お子様ランチ
		LOCALS = A Western-style set meal, sweetened for children and served in a cutesy arrangement. Highly rated by [Childish] girls.
	CASE 271;刺身
		LOCALS = A traditional Japanese-style dish consisting of raw fish fillets dipped in wasabi and soy sauce.
	CASE 272;キッシュ
		LOCALS = A French tart made by filling a pie dough crust with ingredients and cheese and baking it in the oven.
	CASE 273;スターゲイジーパイ
		LOCALS = A British pie dish made with fish. It looks like the whole pie is sprouting with fish heads.
		
	CASE 281;義大莉而鳥苗鳥肉 - tetsunabe no jan reference, probably need revising
		LOCALS = Carpaccio made of ostrich meat suited for survival in the 21st century. Pronounced as eadaari almirou.
	CASE 282;ドーピングコンソメスープ - nendoroid yako katsuragi reference
		LOCALS = This is the ultimate dish created by a miracle chef. When you eat it, your body is immediately transformed into something superhuman.
	CASE 283;ギンギー料理 ;Magical Circle Guru Guru reference
		LOCALS = A specialty of the Yeta village, boiled gingy. What's it made of? Gingy. What's gingy? Gingy. In case you're wondering.
		
	CASE 291;おせち料理
		LOCALS = A Japanese-style dish filled with lucky charms eaten at New Year's. In season until the third day of Spring. Also known as osechi.
	CASE 292;七草粥
		LOCALS = Rice gruel made with the seven plants of spring. Traditionally eaten on Jinjitsu-no-Sekku (the 7th day of Spring).
	CASE 293;恵方巻
		LOCALS = Uncut sushi roll eaten during Setsubun (the 3rd day of Winter). A good luck comes when eating it while facing the direction of fortune, and this year's direction is %EHOU_DIRECTION()%.
	CASE 294;年越し蕎麦
		LOCALS = Soba noodles eaten on New Year's Eve (the 31st day of Winter). This custom lets go of hardship of the year because these noodles are easily cut while eating. Also known as toshikoshi soba.
	CASE 295;ローストチキン
		LOCALS = Whole roasted chicken. A festive meal eaten on Christmas.

	CASE 299;テスト料理
		LOCALS = A test dish. Very tasty.
		
	;Dessert
	CASE 301;ショートケーキ
		LOCALS = A sophisticated short-cut cake made of layers of sponge and cream with a strawberry on top.
	CASE 302;チョコレートケーキ
		LOCALS = Chocolate cake made with cocoa powder.
	CASE 303;ホットケーキ
		LOCALS = A sweet baked pastry made by baking batter with baking powder in a pan to make it fluffy. Also known as hotcake.
	CASE 304;パウンドケーキ
		LOCALS = A butter cake made with evenly portioned ingredients. Easy to make and very homely.
	CASE 305;パイ
		LOCALS = Western-style pastry made by wrapping pieces of fruit and other ingredients in a dough made of flour and butter and baking them together. Pumpkin can also be used.
	CASE 306;タルト
		LOCALS = A Western-style pastry made of unclosed pie base topped with cream and fruit.
	CASE 307;マカロン
		LOCALS = This colorful confection consists of cream sandwiched between soft, cookie-like baked goods.
	CASE 308;クレープ
		LOCALS = A popular sweet among young people, made of thinly stretched pancake base stuffed with fruit and chocolate.
	CASE 309;シュークリーム
		LOCALS = A soft, moist and creamy sweet filled with baked puff pastry.
	CASE 310;パフェ
		LOCALS = This stylish sweet is served in a glass filled with ice cream and fruit.
	CASE 311;プリン
		LOCALS = A jiggly Western-style pastry made by heating and hardening custard and coating it with caramel. Custard pudding.
	CASE 312;ゼリー
		LOCALS = Western-style confectionery made by mixing gelatin with fruit juice or chocolate to make it squishy.
	CASE 313;カエルプリン
		LOCALS = Pudding stuffed with frogs, a truly terrifying dessert.
	CASE 314;ヨーグルト
		LOCALS = An easy to eat and healthy snack made from fermented and sweetened milk. It's eaten as a dessert.
	CASE 315;アイスクリーム
		LOCALS = A dessert made by freezing creamy milk and sweetening it. It comes in a variety of flavors. Delicious to eat in summer.
	CASE 316;クッキー
		LOCALS = Small baked goods made of hardened cake dough. Also known as biscuits.
	CASE 317;ドーナツ
		LOCALS = A sweet pastry made of cake dough deep fried in oil. It has a hole in the middle.
	CASE 318;りんご飴
		LOCALS = A candy made from a whole apple covered in sugar candy coating, with a stick inserted as a handle. Eaten at festivals. Also known as ringoame.
	CASE 319;あんみつ
		LOCALS = A refreshing wagashi [Japanese-style confectionery] made of chilled beans, agar jelly, rice flour dumpling, and fruit, served in a bowl and covered with red bean paste.
	CASE 320;カステラ
		LOCALS = A Japanese sponge cake imported from abroad. It involves very little flour and can be difficult to make it soft and moist.
	CASE 321;団子
		LOCALS = A wagashi [Japanese-style confectionery] made of powdered grains that are rolled into a soft ball and cooked. It tastes even better when dipped in sauce or soybean flour.
	CASE 322;羊羹
		LOCALS = A wagashi [Japanese-style confectionery] made by mixing anko (red bean paste) with agar and sugar, and hardening it to a jiggly consistency. Very elegant taste. Also known as youkan.
	CASE 323;大福
		LOCALS = A wagashi [Japanese-style confectionery] made of strawberries wrapped in bean jam and then stuffed in mochi [rice cake].
	CASE 324;まんじゅう
		LOCALS = A wagashi [Japanese-style confectionery] made of anko (red bean paste) stuffed into yeast bun and then steamed. Occasionally scares some people.
	CASE 325;栗きんとん
		LOCALS = A wagashi [Japanese-style confectionery] made of cooked chestnuts covered with sugar and shaped with a chakin [tea napkrin]. Very elegant taste.
	CASE 326;杏仁豆腐
		LOCALS = A Chinese-style dessert made by mixing powdered and jellied bitter apricot kernels with agar and fruit to make it sweeter. Also known as almond jelly.
	CASE 327;フルーツ盛り合わせ
		LOCALS = A bowl of freshly sliced arranged fruit. It requires a good sense of style to serve it well.
	CASE 328;タピオカミルクティー
		LOCALS = A Taiwanese dessert drink that's in fashion periodically, made with milk tea and tapioca pearls. Also known as bubble tea.
	CASE 329;いちごとうふ / Trout Yoghurt mother 2/earthbound reference
		LOCALS = ◆A fashionable treat for snobby, haute cuisine people in some big cities.
	CASE 330;カットスイカ
		LOCALS = Cut up fresh, cold watermelon. A summer tradition.
		
	CASE 341;月見団子
		LOCALS = Dumplings eaten during Tsukimi or Juugoya [the night of the full moon] (the 15th day of Autumn). It's customary to present them piled up in a pyramid shape.
	CASE 342;ハロウィンケーキ
		LOCALS = A brightly decorated cake made from a pumpkin. Enjoy it on Halloween (the 10th day of Autumn).
	CASE 343;クリスマスケーキ
		LOCALS = A festive strawberry cake eaten on Christmas Eve and Christmas (the 24th and 25th days of Winter respectively).
		
	;rotor
	CASE 351;揚げローター
		LOCALS = A dish made by battering and deep-frying rotors in oil. Careful preparation is required.
	CASE 352;Eマッサージャ風ローターの湯引き
		LOCALS = A complicated dish in which raw rotor is quickly boiled in hot water to remove the odor while adding that unique Electric Massager flavor.
	CASE 353;クリキャップ用ローターの握り
		LOCALS = Sushi with a rotor used in a clit cap. A test of skill.
	CASE 354;オナホール仕立てのローター煮込み
		LOCALS = A dish in which rotors are simmered for a long time and served in a shape of an onahole. A winter specialty.
	CASE 355;バイブライクローターアイス
		LOCALS = Ice cream made by molding rotors into the shape of a vibrator and mixing it with sweetener. Good for the summer heat.
	
	;Special
	CASE 401;紅白まんじゅう Reimu
		LOCALS = A red-white festive manjuu [steamed yeast bun] eaten on occasions of celebration. Has the effect of [Blessing].
	CASE 405;サニーサイドアップ Sunny
		LOCALS = A sunny-side up fried egg, cooked on one side. With fancy garnish.
	CASE 406;静かの海スープ Luna
		LOCALS = A vegetable and milk soup inspired by the Sea of Tranquility.
	CASE 407;京丸牡丹鍋 Star
		LOCALS = This mysterious dish is literally a tree peony nabe [hot pot] made from (supposedly) the legendary Kyoumaru tree peony. No boars were involved.
	CASE 408;水兵カレー Chiyuri
		LOCALS = Curry and rice for lunch to feast on every Friday. Seafood flavor.
	CASE 409;イチゴスペシャル Yumemi
		LOCALS = A special pastry made of sponge cake sandwiched between strawberries and fresh cream.
	CASE 411;魔法のキノコソテー Marisa
		LOCALS = Sauteed magic mushrooms. You will never guess what it tastes like until you try it!
	CASE 412;闇ドーナツ Rumia
		LOCALS = A mysterious donut cloaked in darkness. The other side of the hole is pitch black.
	CASE 414;かき氷 Cirno
		LOCALS = A summer tradition. Quick to make. Eating too much too quickly will give you a headache.
	CASE 415;紅魔ランチ Sakuya
		LOCALS = A kid's meal set that Sakuya designed specially for Ojousama.
	CASE 416;真紅のブラッドスープ Remilia
		LOCALS = Soup dyed red to look as if you were sipping lifeblood.
	CASE 417;ジンジャーブレッドマン Alice
		LOCALS = Pop and cute human-shaped biscuits. Looks as though it's about to come to life at any moment.
	CASE 418;春のお花見弁当 Lily W
		LOCALS = A set meal dish with lots of spring vegetables. Full of vivid life force.
	CASE 419;春の鎮魂料理 Lily B
		LOCALS = A dish originated in the Netherworld using spring vegetables to remember the deceased.
	CASE 423;白玉みつまめ Youmu
		LOCALS = Youmu's original mitsumame recipe [mixture of boiled beans, agar cubes, fruit pieces and syrup], in the shape of a half-spirit. It tastes very weak.
	CASE 424;猫まんま Chen
		LOCALS = Dish of leftovers on rice with miso soup or dried bonito flakes. This is a nostalgic dish Chen was fed back when she used to be a stray cat. Nekomanma also means cat food.
	CASE 425;お稲荷さん Ran
		LOCALS = Sushi made by wrapping vinegared rice in fried tofu. Its roll has pointed corners that resemble fox ears. Inarizushi is named after the Shinto god Inari. Foxes, messengers of Inari, are believed to have a fondness for fried tofu.
	CASE 426;ウミガメのスープ Yukari
		LOCALS = A soup made from the sea turtle meat. That's despite the fact that there's no oceans or seas in Gensokyo...
	CASE 427;ローヤルゼリー Wriggle
		LOCALS = Nutritionally concentrated honey jelly. This honey bee secretion is used in the nutrition of larvae and adult queens. Popular as a health food.
	CASE 428;ヤツメウナギの蒲焼き Mystia
		LOCALS = The secret kabayaki [eel dipped and broiled in soy-based sauce] recipe that Mystia serves at her stall. Its [Performance Enhancing] qualities are good for the Vigor.
	CASE 430;地獄ラーメン（極辛） Eiki
		LOCALS = Ramen noodles invented by Yama as a specialty of Road of Liminality. Terribly spicy.
	CASE 431;やしょうま Sanae - unsure what reference this is
		LOCALS = Colorful and cutely shaped flat dumplings eaten at the Nirvana Day. It's said that spring in Shinshu will not come without them.
	CASE 432;オンバシラスティック Kanako
		LOCALS = A calorie stick that resembles an onbashira. Insanely hard and rigid.
	CASE 433;のたもち Suwako
		LOCALS = A local Suwa dish made with rice pounded into mochi [rice cake] and topped with boiled edamame (green soybeans) ground in a mortar, making it look like a paste.
	CASE 434;天界フルーツパフェ Tenshi
		LOCALS = A luxurious parfait made from a heap of hermit peaches. Extremely sweet.
	CASE 436;ゾンビ焼き Orin
		LOCALS = This dish looks like a real burned corpse. The taste isn't all that bad. The taste, that is.
	CASE 437;核熱メルトダウンステーキ Okuu
		LOCALS = A great piece of steak cooked by nuclear fusion. Take care not to burn yourself. Seriously, beware.
	CASE 439;チーズケーキ Nazrin
		LOCALS = A sweet mellow cake made with cheese.
	CASE 440;お化けこんにゃく Kogasa
		LOCALS = A big konnyaku jelly with a texture reminiscent of a giant tongue. A thrilling, creepy taste.
	CASE 441;未確認飛行料理 Nue
		LOCALS = An unidentified dish that dances in the air. Very difficult to actually eat.
	CASE 442;プリンセスデザート Hatate
		LOCALS = A gorgeous and cute dessert. But insanely sweet.
	CASE 447;ばけばケーキ Rika
		LOCALS = A strange cake made with bakebake [spirit or phantom that appear on stages as generic enemies made by Rika] cream. It has a slight sweetness to it.
	CASE 449;ハートフェルトファンシー Satori
		LOCALS = A cake made with fresh cream filling and sponge. Decorated with hearts all over.
	CASE 450;クランベリートラップ Flandre
		LOCALS = At first glance, it looks like it's nothing but a simple berry...
	CASE 451;キュウリのキューちゃん Nitori ;apparently some sort of brand of pickles?
		LOCALS = Cucumber pickled in vinegar, created by a special process. The real thing(?) is pickled in soy sauce.
	CASE 452;狂気の赤い目玉焼き Reisen
		LOCALS = A fried egg that looks like a red eye. It looks off-putting, but is highly nutritious.
	CASE 454;マジカルカップケーキ Patchouli
		LOCALS = Colorfully decorated cupcakes. Each one is packed with magical power.
	CASE 455;精進料理 Byakuren
		LOCALS = Cuisine that is followed by monks and many Buddhism believers. Served in the temple, this austere cuisine is designed to stave off worldly desires. Also known as shoujin-ryouri.
	CASE 457;恋する人形焼き Kokoro
		LOCALS = These ningyo-yaki [doll sponge pancakes] are based on the 48 masks burned by the flames of love featured in one of Kokoro's plays.
	CASE 458;彩色小籠包 Meiling
		LOCALS = Each one of these xiaolongbao [soup dumplings prepared in a xiaolong, a small bamboo steaming basket] is a different color. Perfectly sized for a bite.
	CASE 459;悪魔のおにぎり Koakuma
		LOCALS = This devilish onigiri [rice ball] is mixed with tenkasu [crunchy bits of deep fried flour-batter] and mentsuyu [noodle soup base with sauce], which resembles the devil himself.
	CASE 460;やきもち Parsee
		LOCALS = Ordinary mochi [pounded rice cake] burned by the flames of jealousy. Be careful who you let eat it. The name itself (yakimochi) means jealousy.
	CASE 461;焼き鳥 Mokou
		LOCALS = This poultry meat is grilled on a skewer to perfection making it as vivid as a phoenix. The taste is quite normal.
	CASE 462;蓬莱のアイスの玉の枝 Kaguya
		LOCALS = Colorful ice cream spheres pierced on a branch-like stick. Incredibly sweet.
	CASE 463;ジビエ料理 Kagerou
		LOCALS = A hunter's delicacy made from game meat. Its [Performance Enhancing] qualities are good for the Vigor.
	CASE 464;ぼたん鍋 Yuugi
		LOCALS = A hot pot dish made using the meat of a wild boar, which is remarkably akin to a youkai. The beautifully arranged meat is as beautiful as a tree peony flower [Botan]. Also known as botan-nabe.
	CASE 465;もみじ饅頭 Momiji
		LOCALS = A maple-shaped manjuu [steamed bun] filled with koshian [smooth anko, red bean paste].
	CASE 466;桜餅 Yuyuko
		LOCALS = A wagashi [Japanese-style confectionery] made of of sweet rice cake with a red bean paste center wrapped in a pickled cherry blossom leaf. The color of the rice cake is also pink like the cherry blossom.
	CASE 467;月見うどん Keine
		LOCALS = Moon Viewing Noodles, a kakeudon [udon noodles in broth] topped with a raw or poached egg that represents the harvest moon. Eating it during Juugoya [the night of the full moon] (the 15th day of Autumn) makes for an interesting experience.
	CASE 468;ひまわりワッフル Yuuka
		LOCALS = Cute waffles in the shape of sunflowers. Definitely something to try in the summer.
	CASE 469;たぬきそば Mamizou
		LOCALS = A style of soba noodles that rivals kitsune udon with the addition of tempura batter [tenkasu, crunchy bits of deep fried flour-batter].
	CASE 470;鈴カステラ Kosuzu
		LOCALS = A bite-sized round castella [sponge cake]. It's shaped like a bell with browned hemispheres.
	CASE 471;こびとのパン Shinmyoumaru ff4 reference
		LOCALS = Small, bite-sized magical bread made for inchlings that when eaten can reveal the terrain around them.
	CASE 472;超栄養ドリンク Eirin
		LOCALS = A liquid meal made from a nutritional drink with a special formulation to make it even more effective. Tasteless and odorless.
	CASE 473;飛頭饅頭 Sekibanki
		LOCALS = Chinese-style steamed buns in the shape of a realistic head. Much spicier than a nikuman [steamed manjuu bun with meat filling].
	CASE 474;ゆきだるまアイス Letty
		LOCALS = Ice cream that looks like a snowman stacked in three layers. Something to enjoy while sitting under a kotatsu.
	CASE 475;鈴蘭団子 Medicine
		LOCALS = Sweet dango dumplings cooked and mixed with suzuran's [lily of the valley] poisonous taste. Handle with care.
	CASE 476;人魂わたあめ Komachi
		LOCALS = Something you don't see very often, this is a cotton candy popular in the Netherworld. Resembles hitodama, balls of fire that are said to be souls of the dead that have separated from their bodies. It's quite chilly.
	CASE 477;紅葉の天ぷら Shizuha
		LOCALS = A tempura dish made of deep-fried mountain autumn leaves. It doesn't taste very good.
	CASE 478;スイートポテト Minoriko
		LOCALS = A Japanese meets Western-style snack made from sweet potatoes. Not widely appreciated overseas.
	CASE 479;ひなあられ Hina
		LOCALS = Colorful arare mochi [small roasted mochi pieces from pounded rice] eaten for the Girls' Festival (3rd day of Spring). Occasionally mixed with beans.
	CASE 480;求聞雑炊 Akyuu
		LOCALS = Zousui, a rice porridge passed down in the Hieda family, said to amplify memory. It's also good for health.
	CASE 481;栄養効率サプリメント Renko
		LOCALS = A pill packed with nutrition. It's nourishing, but it doesn't really feel like a meal.
	CASE 483;桶茶碗蒸し Kisume
		LOCALS = A giant steamed egg custard made entirely in a bucket, or rather, an okemushi [oke - bucket, used instead of chawan - rice bowl/teacup].
	CASE 484;虫パン Yamame
		LOCALS = A mushipan [steamed bread] in the shape of an actual insect [mushi]. Real insects are used for the ingredients, too. Potential for happiness overflowing.
	CASE 485;入道わたあめ Ichirin
		LOCALS = Extra-large, fuzzy cotton candy in the shape of a monk's shaved head [nyuudou]. Rich in flavor.
	CASE 486;深海料理 Murasa
		LOCALS = A somewhat outlandish dish made from deep-sea fish.
	CASE 487;ハングリータイガーステーキ Shou
		LOCALS = The result of not being able to endure strict vegetarian diet. This is a meat dish mired in worldly desires.
	CASE 488;わんこそば Kyouko
		LOCALS = This is an unusual type of soba serving that involves repeatedly eating just one bite of hot soba in a bowl. You quickly eat your soba noodles, getting your bowl immediately refilled in repetition. No doggies or pooches are involved [wanko = puppy].
	CASE 491;雷おこし Tojiko
		LOCALS = A wagashi [Japanese-style confectionery] made by hardening processed rice into candy. Good luck is said to come from eating it on a stormy day. The name literally means thunderbolt bringer.
	CASE 493;マーメイドパフェ Wakasagihime
		LOCALS = A blue ocean parfait inspired by the Little Mermaid. Just looking at it makes you feel refreshed.
	CASE 494;びわゼリー Benben
		LOCALS = A jelly containing the whole fruit loquat shaped like a biwa. Rich in concentrated sweetness.
	CASE 495;八つ橋 Yatsuhashi
		LOCALS = A rectangular hard-baked senbei [rice cracker] in the shape of a koto. Quite sweet for a rice cracker.
	CASE 496;太鼓焼き Raiko
		LOCALS = Cylindrical, flat baked buns. It has a Tomoe pattern, making it look even more like a taiko drum. Also known as imagawayaki.
	CASE 497;逆さバーガー Seija
		LOCALS = It looks just like a regular burger only flipped upside down, though...?
	CASE 499;ウミサチヤマサチ Toyohime
		LOCALS = A luxurious cuisine with plenty of seafood and mountain produce. The name has no deep meaning... surely.
	CASE 500;にんじんしりしり Rei'sen
		LOCALS = A dish made by stir-frying sliced carrots and eggs with seasonings. Delicious even when cold.
	CASE 504;フォンデュ・エソテリア Yuki
		LOCALS = A soup fondue with spicy and sour flavors that mimics the atmosphere of a certain local city in the Makai.
	CASE 505;ヴィナ・コーヒー TH98 Mai
		LOCALS = A coffee with whipped cream on top, originating from the Vina region of the Makai. It has nothing to do with Vienna coffee or Vinacafe.
	CASE 507;ストロベリーダンゴ Seiran
		LOCALS = Dumplings filled with strawberries that Seiran is selling. Packed with [Medical Efficacy].
	CASE 508;鈴瑚印の団子 Ringo
		LOCALS = Dumplings made from hermit peaches that Ringo is selling. Packed with power.
	CASE 509;謎の夢魂菓子 Doremy
		LOCALS = A mysterious candy that's just as squishy as a dream soul. The taste is also a mystery.
	CASE 511;アビスバーガー Clownpiece
		LOCALS = A radical hamburger popular in hell. Full of food colorants.
	CASE 513;三色地獄そぼろ丼 Hecatia
		LOCALS = A tricolor donburi [bowl of rice] topped with blood-red chicken soboro [minced meat seasoned and fried], authentic blue greens, and poached egg.
	CASE 518;花蜜ゼリー Larva
		LOCALS = Extracted nectar from flowers turned into jelly. It's brimming with life force.
	CASE 519;山の郷土料理 Nemuno
		LOCALS = Local cuisine made from the bountiful gifts of the mountains. It tastes like home.
	CASE 520;犬まんま Aunn
		LOCALS = A crude dish of leftover ingredients mixed together at random with cooked rice. Inumanma also means dog food.
	CASE 521;地蔵焼き Narumi
		LOCALS = Baked sweets in the shape of Jizo. Perfect for offerings.
	CASE 522;タナバタスターソーメン Mai
		LOCALS = Dazzling somen noodles [fine white noodles] eaten during Tanabata [Star Festival] (the seventh day of Summer). Tastes rather ordinary.
	CASE 523;忘れ茗荷の酢漬け Satono
		LOCALS = Myoga [Japanese ginger] pickled in vinegar using a special process. It's said to impair one's memory...
	CASE 524;マターラボッカ Okina
		LOCALS = An interesting twist on the fancy cured ham dish called saltimbocca.
	CASE 525;イタ飯 Joon
		LOCALS = An Italian dish that was once popular. It's based on pizza and recreates the taste of that time.
	CASE 526;もやし炒め Shion
		LOCALS = A very cheap dish of stir-fried bean sprouts. This dish makes you shudder at the extent of starving hunger.
	CASE 527;バベルタワーパンケーキ Eika
		LOCALS = Pancakes piled high in a heap after getting carried away. Not so easy to eat.
	CASE 528;活け造り Urumi
		LOCALS = Fresh sashimi from live seafood on the plate. It's arranged in its original shape to look lifelike.
	CASE 529;ひよ子 Kutaka
		LOCALS = A manjuu [steamed bun] in the shape of a chick looking up at you. No eggs involved.
	CASE 530;魚翅湯 Yachie
		LOCALS = A delicacy soup with a unique texture made from shark fins. Very luxurious.
	CASE 531;はにわまん Mayumi
		LOCALS = Deep-fried Chinese steamed buns with the face of Haniwa. Its texture is quite crispy.
	CASE 532;偶像仕立ての工芸菓子 Keiki
		LOCALS = A crafted confection that's sculpted so artistically that it's hard to believe it's actual food. Truly a divine work of art.
	CASE 533;鬼形のホイボーロ Saki
		LOCALS = Ghastly shaped grainy baked goods. Don't use it for Danmaku!
	CASE 534;鯢呑亭秘伝の煮付け Miyoi
		LOCALS = This is the most popular menu item using Geidontei's secret sauce.
	CASE 543;剛欲な獣神の夕餉 Yuuma
		LOCALS = A gigantic, hodgepodge wok, customary to the Gouyoku Alliance. It's not something a regular human can handle.
	CASEELSE
		IF DISH_COMMENT == "※募集中です！！※"
			LOCALS = ※Recipe Pending!※
		ELSEIF STRLENS(DISH_COMMENT) ;return untranslated
			RETURNF DISH_COMMENT
		ELSE
			;If there's no comment it just prints the name twice for some reason
			LOCALS = %DISHNAME_TR(DISH_NAME)%
		ENDIF
ENDSELECT
RETURNF LOCALS

@DISHNAME_PLURAL(ARGS)
#FUNCTION
VARSET LOCAL
SIF ARGS == ""
	ARGS '= @"%DISH_NAME%"
SELECTCASE ARGS
	CASE "フィッシュ＆チップス" ;Fish & Chips
		LOCAL = 1
	CASE "クッキー" ;Cookies
		LOCAL = 1
	CASE "野菜炒め" ;Fried Vegetables
		LOCAL = 1
	CASE "おひたし" ;Boiled Greens in Soy Sauce
		LOCAL = 1
	CASE "うどん" ;Udon Noodles
		LOCAL = 1
	CASE "素麺" ;Somen Noodles
		LOCAL = 1
	CASE "蕎麦" ;Soba Noodles
		LOCAL = 1
	CASE "煎餅" ;Rice Crackers
		LOCAL = 1
	CASE "カップ麺" ;Instant Noodles
		LOCAL = 1
	CASE "魔法のキノコソテー" ;Sauteed Magic Mushrooms
		LOCAL = 1
	CASE "闇ドーナツ" ;Darkness Donuts
		LOCAL = 1
	CASE "彩色小籠包" ;Colored Soup Dumplings
		LOCAL = 1
	CASE "スイートポテト" ;Sweet Potatoes
		LOCAL = 1
	CASE "地蔵焼き" ;Jizo Cookies
		LOCAL = 1
	CASE "偶像仕立ての工芸菓子" ;Idol-tailored Crafted Sweets
		LOCAL = 1
	CASE "鬼形のホイボーロ" ;Demon-shaped Round Cookies
		LOCAL = 1
	CASEELSE
		LOCAL = 0
ENDSELECT
RETURNF LOCAL

;Male virginity loss handler

@SET_HISTORY_LOST_DT(ARG,相手,対象,場所,修飾語)
#DIM 相手
#DIMS 対象
#DIMS 場所
#DIMS 修飾語

CFLAG:ARG:童貞喪失記念日 = DAY
TCVAR:ARG:筆下ろし = 1
CFLAG:ARG:童貞喪失相手 = 相手
;by default we assume it's vagina
IF STRLENS(対象) ;for events and such outside of normal sex
	CATCHER_ORIFICE:ARG:0 = (対象 == "アナル" ? DT_ANUS # DT_VAGINA)
ELSE
	;to specify the orifice it was lost to
	IF GROUPMATCH(TFLAG:3, 62, 63, 66, 69, 70, 92, 93, 94) ||  TEQUIP:相手:Ａセックス == ARG
		LOCAL = 1
	ELSE
		LOCAL = 0
	ENDIF
	CATCHER_ORIFICE:ARG:0 = LOCAL ? DT_ANUS # DT_VAGINA
	対象 '= (LOCAL ? "アナル" # "膣")
ENDIF
;failsafe if something retarded happens
SIF !GROUPMATCH(対象, "膣", "アナル")
	THROW "Wrong orifice specified for SET_HISTORY_LOST_DT: " + 対象
	
CSTR:ARG:童貞喪失履歴 = %HISTORY_LOST_TEXT_TR(ARG,相手,対象,場所,修飾語,"童貞")%

@SET_DOUTEILOSS_MASTER(ARGS, ARG = -1)
SIF ARG == -1
	ARG = MASTER
IF IS_DOUTEI(ARG)
	CALL COLORMESSAGE(@"Male Virginity Loss (%CALLNAME:ARG%)", 0xFF64FF, 2)
	CFLAG:ARG:童貞喪失記念日 = DAY
	TALENT:ARG:非童貞 = 1
	TCVAR:ARG:筆下ろし = 1
	CSTR:ARG:童貞喪失履歴 = Day {DAY}, %TOLOWER(PRINT_DATE_F(DAY))%, %ARGS%
ENDIF

@SET_VIRGINLOSS_MASTER(ARGS, ARG = -1)
SIF ARG == -1
	ARG = MASTER
IF IS_VIRGIN(ARG)
	SIF ARG != MASTER
		FLAG:処女喰い ++
	CALL COLORMESSAGE(@"Virginity Loss (%CALLNAME:ARG%)", 0xF7ABA6, 2)
	CFLAG:ARG:処女喪失記念日 = DAY
	TALENT:ARG:処女 = 0
	TCVAR:ARG:破瓜 = 1
	CSTR:ARG:処女喪失履歴 = Day {DAY}, %TOLOWER(PRINT_DATE_F(DAY))%, %ARGS%
ENDIF

@HISTORY_LOST_TEXT_TR(ARG,PARTNER,PENIS,LOCATION,MODIFIER,VIRGINITY)
#FUNCTIONS
#DIM PARTNER
#DIMS PENIS
#DIMS LOCATION
#DIMS MODIFIER
	#DIMS DYNAMIC MOD_PRE
	#DIMS DYNAMIC MOD_DUR, 2
#DIMS VIRGINITY
#DIMS DYNAMIC SITUATION
#DIM DYNAMIC GAVE
#DIMS TAKER
#DIMS OUTPUT_STRING
#DIM DYNAMIC STRANGER
#DIM DYNAMIC MOB
VARSET LOCALS

;structure: DATE (full date) + ARG (pitcher) + MOD_PRE (possible modifiers that should go before the verb part) + GAVE (giving verb part) + VIRGINITY (which) + (to) TAKER (catcher) + MOD_DUR + MOD_DUR:1 (modifiers) + LOCATION + SITUATION

;translate the cases
SELECTCASE VIRGINITY
	CASE "処女"
		VIRGINITY = virginity
	CASE "尻穴処女"
		VIRGINITY = anal virginity
	CASE "童貞"
		VIRGINITY = penile virginity
ENDSELECT
SELECTCASE MODIFIER
	CASE "流されるままに"
		MOD_PRE '= "went along with the flow and "
		;swept away, like, go along with the flow
	CASE "お金を払って"
		MOD_DUR:1 '= " in exchange for money"
ENDSELECT

IF MODIFIER == "" && SHIRAHU(ARG)
	IF TCVAR:ARG:無理矢理 && CFLAG:ARG:負け犬
		MOD_DUR:1 '= @" as a price for losing"
		GAVE = 0
	ELSEIF TCVAR:ARG:無理矢理
		MOD_DUR:1 '= @" against %HIS_HER(ARG)% will"
		GAVE = 0
	ELSEIF TALENT:ARG:無知
		;ignorant
		MOD_DUR:1 '= " while completely clueless about what's going on"
		GAVE = 0
	;ELSEIF TALENT:ARG:恋人
		;moved to the adjective part near TAKER
	ELSEIF ARG != MASTER && ARG != TARGET && CFLAG:MASTER:うふふ != 2
		MOD_DUR:1 '= " despite being dissatisfied with the whole ordeal"
		GAVE = 0
	ELSEIF CFLAG:ARG:うふふ == 2 && ARG != MASTER
		;when pushed down
		MOD_DUR:1 '= @" by %HIS_HER(ARG)% own initiative"
		GAVE = 1
	ENDIF
ENDIF
;this also fixes wrong "stranger 2hu name's organ" message in the loss output
;this part was supposed to be an adjective part to the TAKER, but english I guess?
IF ARG == MASTER
	IF TALENT:PARTNER:思慕
		GAVE = 1
		MOD_DUR '= @" as to ascertain %HIS_HER(ARG)% love"
	ELSEIF TALENT:PARTNER:恋人 || TALENT:PARTNER:恋慕
		GAVE = 1
		MOD_DUR '= " during passionate lovemaking"
		SIF SHIRAHU(PARTNER) && TALENT:PARTNER:恋人
			MOD_DUR += " wrapped in bliss"
	ELSEIF !CFLAG:PARTNER:面識
		;not acquainted 
		STRANGER = 1
	ELSEIF TALENT:PARTNER:行きずり == 1
		;if it's a mob character
		MOB = 1
	ENDIF
ELSE
	IF TALENT:ARG:思慕
		GAVE = 1
		MOD_DUR '= @" as to ascertain %HIS_HER(ARG)% love"
	ELSEIF TALENT:ARG:恋人 || TALENT:ARG:恋慕
		GAVE = 1
		MOD_DUR '= " during passionate lovemaking"
		SIF SHIRAHU(ARG) && TALENT:ARG:恋人
			MOD_DUR += " wrapped in bliss"
	ELSEIF !CFLAG:ARG:面識
		;not acquainted 
		STRANGER = 1
	ELSEIF TALENT:ARG:行きずり == 1
		;if it's a mob character
		MOB = 1
	ENDIF
ENDIF

SIF !SHIRAHU(ARG)
	;if drunk or so
	GAVE = 0
SIF ARG == MASTER
	GAVE = 2
SIF ARG == MASTER && (VIRGINITY == "penile virginity")
	GAVE = CFLAG:PARTNER:うふふ == 2 ? 2 # 3
SIF ARG == MASTER && (TALENT:PARTNER:恋慕 || TALENT:PARTNER:恋人 || MODIFIER == "治療と称して")
	GAVE = 1
SIF MODIFIER == "お金を払って"
	GAVE = (VIRGINITY == "penile virginity" ? 3 # 2)

SELECTCASE PENIS
	CASE "ペニス"
		IF TALENT:PARTNER:2 & 2
			TAKER = %CALLNAME:PARTNER%'s %TINKO_SIMPLE(PARTNER)%
		ELSE
			TAKER = %CALLNAME:PARTNER%'s strapon
		ENDIF
	CASE "指"
		TAKER = %CALLNAME:PARTNER%'s finger
	CASE "膣"
		TAKER = %CALLNAME:PARTNER%'s vagina
	CASE "アナル"
		TAKER = %CALLNAME:PARTNER%'s anus
CASEELSE
	SELECTCASE PENIS
		CASE "バイブ", "アナルバイブ"
            PENIS = vibrator
        CASE "アナルビーズ"
            PENIS = anal beads
	CASEELSE
		PENIS = penis
	ENDSELECT
	TAKER = %CALLNAME:PARTNER%'s %PENIS%
ENDSELECT
SIF (TALENT:ARG:恋人 && PARTNER == MASTER) || (TALENT:PARTNER:恋人 && ARG == MASTER) ;lover, only between master and another character as a failsafe
	TAKER '= HIS_HER(ARG) + " beloved " + TAKER

;--------- Start creating the string
OUTPUT_STRING = Day {DAY}, %TOLOWER(PRINT_DATE_F(DAY))%, 
;--------- Formatting for whether it was taken or given
SELECTCASE GAVE
	CASE 1
		OUTPUT_STRING = %OUTPUT_STRING% %HE_SHE(ARG)% %MOD_PRE%gave %HIS_HER(ARG)% %VIRGINITY% to 
	CASE 2
		OUTPUT_STRING = %OUTPUT_STRING% %HE_SHE(ARG)% %MOD_PRE%let %HIS_HER(ARG)% %VIRGINITY% be stolen by 
	CASE 3
		OUTPUT_STRING = %OUTPUT_STRING% %HE_SHE(ARG)% %MOD_PRE%threw away %HIS_HER(ARG)% %VIRGINITY% to 
CASEELSE
	SIF MODIFIER == "流されるままに"
		MOD_PRE '= HE_SHE(ARG) + " " + MOD_PRE
	OUTPUT_STRING = %OUTPUT_STRING% %MOD_PRE%%HIS_HER(ARG)% %VIRGINITY% was \@ !SHIRAHU(ARG) ? stolen # taken \@ by 
ENDSELECT
;--------- If the taker is a stranger
SIF STRANGER
	OUTPUT_STRING = %OUTPUT_STRING% the stranger
;--------- Taker 
OUTPUT_STRING = %OUTPUT_STRING% %TAKER%
;--------- If it's a random character
SIF MOB
	OUTPUT_STRING = %OUTPUT_STRING% whom %HE_SHE(ARG)% just met
;--------- Modifier like "against her will"
OUTPUT_STRING = %OUTPUT_STRING%%MOD_DUR%%MOD_DUR:1%

;--------- Create location
IF LOCATION == ""
	IF !IN_HOME(CFLAG:ARG:現在位置) && CFLAG:ARG:現在位置 != OMANEKIBEYA()
		LOCATION = %DATENAME_SPOT_TR()%
	ELSE
		LOCATION = %AT_IN_ON(CFLAG:ARG:現在位置)%
	ENDIF
	SIF !(CFLAG:ARG:現在位置 == OMANEKIBEYA()) ;do not print when you're doing it in the private room since it's glitched (position 998)
		LOCATION += " at the " + GET_MAPNAME(GET_MAPID(CFLAG:ARG:現在位置))
ELSE
	SELECTCASE LOCATION
		CASE "自室"
			IF ARG != MASTER
				LOCATION = in %HIS_HER(ARG)% own room
			ELSE
				LOCATION = in %CALLNAME:ARG%'s room
			ENDIF
		CASE "逆援交"
			;currently only sex buddies and mistresses and sluts can apply for that event
			LOCATION = in the love hotel during reverse compensated dating
	ENDSELECT
ENDIF
;--------- Add location
OUTPUT_STRING = %OUTPUT_STRING% %LOCATION%

;--------- Position (maybe later? need to specify that this is during normal sex outside of events)
;OUTPUT_STRING = %OUTPUT_STRING% %getsexpos(ARG == MASTER? PARTNER # ARG)%

;--------- Create situation
IF FLAG:70
	SITUATION '= " while time was stopped"
ELSEIF TCVAR:ARG:泥酔
	SITUATION '= " while drunk"
ELSEIF CFLAG:ARG:睡眠
	SITUATION '= " while sleeping"
ELSEIF ARG != MASTER && ARG != TARGET && CFLAG:MASTER:うふふ != 2
	SITUATION '= @" according to %CALLNAME:MASTER%'s wishes"
ELSE
	SITUATION = 
ENDIF
;--------- Add situation
OUTPUT_STRING = %OUTPUT_STRING%%SITUATION%.
RETURNF OUTPUT_STRING

@getsexpos(ARG)
#FUNCTIONS
SELECTCASE TEQUIP:ARG:体位
	CASE 1 
		RETURNF "in the missionary position"
	CASE 2 
		RETURNF "doggy style"
	CASE 3 
		RETURNF "in the cowgirl position"
	CASE 4 
		RETURNF "in the lotus position"
	CASE 5 
		RETURNF "in the reverse lotus position"
	CASE 6
		RETURNF "like a living onahole"
ENDSELECT

@SET_FIRSTKISS_TR(ARG, TAKER, シチュエーション, 修飾語)
#DIM TAKER
;シチュエーション	 0:通常
;					 1:デート帰り
;					 2:オナバレ
;					 4:ペニスに
;					 8:自発的に
;					16:無自覚
;					32:買春
#DIM 無理矢理シチュ
#DIM シチュエーション
#DIMS 修飾語
#DIM 自分で
#DIMS OUTPUT_STRING
#DIM STRANGER
#DIMS MODIFIER
#DIMS SITUATION
#DIMS LOCATION
#DIM MOB
#DIM DYNAMIC PENIS_KISS

VARSET MOB
VARSET LOCATION
VARSET SITUATION
VARSET MODIFIER
VARSET STRANGER
VARSET LOCALS
自分で = 0
無理矢理シチュ = (TCVAR:ARG:無理矢理 && !(TALENT:ARG:愛欲 || TALENT:ARG:セフレ || TALENT:ARG:恋慕 || TALENT:ARG:思慕))
;無理矢理状態で、キス合意はつかない。無理矢理だから！！！唇を許すわけ無いでしょ！！　ただし、陥落素質があればギリギリセーフ。


;キス経験済み
IF TALENT:ARG:キス未経験 == 0
	RETURN
;無自覚キス経験済み
ELSEIF TALENT:ARG:キス未経験 < 0
	;無自覚キス同士では重複しない
	SIF シチュエーション & 16
		RETURN
ENDIF

;FLAG:ＦＫ判定によっては帰る
SIF !(FLAG:ＦＫ判定 & 1) && シチュエーション & 16
	RETURN
SIF !(FLAG:ＦＫ判定 & 2) && シチュエーション & 4
	RETURN

IF ARG == TAKER
	IF ARG == MASTER
		TAKER = TARGET
	ELSE
		TAKER = MASTER
	ENDIF
ENDIF
;キス未経験喪失

SETCOLOR 247,171,166
PRINTFORM First Kiss
SIF シチュエーション & 16 || CSTR:ARG:ファーストキス喪失履歴 != ""
	PRINT ？
PRINTFORMW (%CALLNAME:ARG%)
RESETCOLOR
CFLAG:ARG:ファーストキス喪失記念日 = DAY
TALENT:ARG:キス未経験 = 0
CFLAG:ARG:ファーストキス喪失相手 = TAKER
IF TALENT:ARG:思慕
	自分で = 1
	MODIFIER '= " in a moment of desire"
ELSEIF ARG == MASTER && TALENT:(TAKER):恋人
	自分で = 1
	;something unique
	MODIFIER '= " after becoming lovers"
ELSEIF TALENT:ARG:恋人 || TALENT:ARG:恋慕
	自分で = 1
	MODIFIER '= " in a moment of love"
ELSEIF 無理矢理シチュ
	MODIFIER '= " forcibly"
ELSEIF !CFLAG:ARG:面識 && !TALENT:ARG:行きずり
	;not acquainted 
	STRANGER = 1
ELSEIF TALENT:ARG:行きずり
	;if it's a mob character
	MOB = 1
ENDIF
IF シチュエーション & 4
	LOCALS:1 = 's penis
	CFLAG:ARG:ファーストキス喪失対象 = 1
	PENIS_KISS = 1
ENDIF
SIF シチュエーション & 8
	自分で = 1
IF シチュエーション & 16
	IF FLAG:70
		SITUATION '= " while time was stopped"
	ELSEIF CFLAG:ARG:睡眠
		SITUATION '= " while asleep"
	ELSE
		SITUATION '= " without any idea how it ever happened"
	ENDIF
	CFLAG:ARG:ファーストキス喪失対象 = 2
	TALENT:ARG:キス未経験 = -1
ENDIF
;SIF TALENT:ARG:無知 && シチュエーション & 4
;	LOCALS:2 = %LOCALS:2%その意味もわからぬまま

SELECTCASE シチュエーション
	CASE 1
		CSTR:ARG:ファーストキス位置 = デートからの帰り道
		SIF ARG != MASTER
			自分で = 1
		LOCATION = デートからの帰り道
	CASE 2
		IF ARG != MASTER
			CSTR:ARG:ファーストキス位置 = 自室
		ELSE
			CSTR:ARG:ファーストキス位置 = %CALLNAME:ARG%宅
		ENDIF
		LOCATION = 自室
	CASEELSE
		IF CHK_DATENOW(CFLAG:ARG:デート中) && CFLAG:ARG:現在位置 != OMANEKIBEYA()
			CSTR:ARG:ファーストキス位置 = %DATENAME_SPOT()%
		ELSEIF CHK_DATENOW(CFLAG:MASTER:デート中) && CFLAG:MASTER:現在位置 != OMANEKIBEYA()
			CSTR:ARG:ファーストキス位置 = %DATENAME_PLACE()%の%DATENAME_SPOT()%
		ELSE
			CSTR:ARG:ファーストキス位置 = %AT_IN_ON(CFLAG:ARG:現在位置)%
		ENDIF
		SIF ARG == MASTER
			自分で = 1
ENDSELECT
;CSTR:ARG:ファーストキス喪失履歴 = %PRINT_DATE_F(DAY)%, %LOCALS:0%%CALLNAME:TAKER%に%CSTR:ARG:ファーストキス位置%で%修飾語%first kiss\@ 自分で? 捧げた# 奪われた\@
;note: above are the remnants of the original code

;--------- Start creating the string
OUTPUT_STRING = Day {DAY}, %TOLOWER(PRINT_DATE_F(DAY))%, 
;--------- Formatting for whether it was taken or given
IF 修飾語 == "飴と一緒に"
	OUTPUT_STRING = %OUTPUT_STRING% %HE_SHE(ARG)% exchanged %HIS_HER(ARG)% first kiss with 
	修飾語 '= @" together with the candy in %HIS_HER(TAKER)% mouth"
ELSEIF 自分で == 1
	OUTPUT_STRING = %OUTPUT_STRING% %HE_SHE(ARG)% gave %HIS_HER(ARG)% first kiss to 
ELSE
	OUTPUT_STRING = %OUTPUT_STRING% %HIS_HER(ARG)% first kiss was taken by 
ENDIF
;--------- Translate commonly used strings
SELECTCASE 修飾語
	CASE "流されるままに"
		;修飾語 = after getting swept up in the momentum
		;standardized
		修飾語 '= @" as %HE_SHE(ARG)% went along with the flow"
	CASE "無音の時の中"
		;this makes sense in the dialogue where Luna uses her ability to create silence, so you can for example take her first kiss
		修飾語 '= " to break the silence"
ENDSELECT
;--------- If the taker is a stranger
SIF STRANGER && ARG != MASTER
	OUTPUT_STRING = %OUTPUT_STRING% the stranger
;--------- Taker 
OUTPUT_STRING = %OUTPUT_STRING% %CALLNAME:TAKER%
;--------- If it's a random character
SIF MOB
	OUTPUT_STRING = %OUTPUT_STRING% who %HE_SHE(ARG)% just met
;--------- If it was with a penis
SIF PENIS_KISS
	OUTPUT_STRING = %OUTPUT_STRING%'s penis
;--------- Modifier like "against her will"
OUTPUT_STRING = %OUTPUT_STRING%%MODIFIER%
;--------- Additional strings at the end before the location
OUTPUT_STRING = %OUTPUT_STRING%%修飾語%

;--------- Create location
IF LOCATION == ""
	IF !IN_HOME(CFLAG:ARG:現在位置) && CFLAG:ARG:現在位置 != OMANEKIBEYA()
		LOCATION = %DATENAME_SPOT_TR()%
	ELSE
		LOCATION = %AT_IN_ON(CFLAG:ARG:現在位置)%
	ENDIF
	IF !(CFLAG:ARG:現在位置 == OMANEKIBEYA()) ;do not print when you're doing it in the private room since it's glitched (position 998)
		SIF STRLENS(LOCATION)
			LOCATION += " "
		LOCATION += "at the " + GET_MAPNAME(GET_MAPID(CFLAG:ARG:現在位置))
	ENDIF
ELSE
	SELECTCASE LOCATION
		CASE "自室"
			IF ARG != MASTER
				LOCATION = in %HIS_HER(ARG)% own room
			ELSE
				LOCATION = in %CALLNAME:ARG%'s room
			ENDIF
		CASE "デートからの帰り道"
			LOCATION = on the way back from %HIS_HER(ARG)% date
	ENDSELECT
ENDIF
;--------- Add location
OUTPUT_STRING = %OUTPUT_STRING% %LOCATION%

;--------- Create situation
IF FLAG:70
	SITUATION '= " while time was stopped"
ELSEIF TCVAR:ARG:泥酔
	SITUATION '= " while drunk"
ELSEIF CFLAG:ARG:睡眠
	SITUATION '= " while sleeping"
ELSE
	SITUATION = 
	SIF シチュエーション & 16
		SITUATION '= " without any idea how it ever happened"
ENDIF
;--------- Add situation
OUTPUT_STRING = %OUTPUT_STRING%%SITUATION%.
IF CSTR:ARG:ファーストキス喪失履歴 == ""
	CSTR:ARG:ファーストキス喪失履歴 '= @"%OUTPUT_STRING%"
ELSE
	;add previous history (from original function)
	CSTR:ARG:ファーストキス喪失履歴 '= @"%OUTPUT_STRING%￥ＢＲ%CSTR:ARG:ファーストキス喪失履歴%"
ENDIF



;既成事実もつけておく
SIF ARG != MASTER && !(シチュエーション & 16) && !無理矢理シチュ
	SETBIT CFLAG:ARG:既成事実, 0
;愛情経験もここで入れることにする
SIF ARG != MASTER && !(シチュエーション & 16) && !無理矢理シチュ
	EXP:ARG:愛情経験 += 5


@DATENAME_SPOT_TR()
#FUNCTIONS
SIF CHK_DATENOW(CFLAG:MASTER:デート中) == 0
	RETURNF ""
SIF TFLAG:デート道中
	RETURNF "on the road"
RETURNF AT_IN_ON(CFLAG:MASTER:現在位置)

;Takes a location number, returns a description
@AT_IN_ON(ARG)
#FUNCTIONS
SELECTCASE ARG
	CASE 1
		LOCALS = by the torii
	CASE 2
		LOCALS = on the shrine grounds
	CASE 3
		LOCALS = at the offertory box
	CASE 4
		LOCALS = in the main shrine
	CASE 5
		LOCALS = by the chozuya
	CASE 6
		LOCALS = in the storeroom
	CASE 7
		LOCALS = in the doma
	CASE 8
		LOCALS = in the kitchen
	CASE 9
		LOCALS = in the living room
	CASE 10
		LOCALS = on the veranda
	CASE 11
		LOCALS = in the garden
	CASE 12
		LOCALS = in the dressing room
	CASE 13
		LOCALS = in the bathroom
	CASE 14
		LOCALS = in the lavatory
	CASE 15
		LOCALS = in the Reimu's boudoir
	CASE 16
		LOCALS = in the worn-out hut
	CASE 17
		LOCALS = in the small closet
	CASE 18
		LOCALS = in the closet
	CASE 19
		LOCALS = in the large closet
	CASE 20
		LOCALS = behind the main shrine
	CASE 21
		LOCALS = by the Moriya branch
	CASE 22
		LOCALS = at the Hakurei shrine approach
	CASE 23
		LOCALS = in the dressing room
	CASE 24
		LOCALS = at the hot spring
	CASE 25
		LOCALS = at the shrine grove
	CASE 26
		LOCALS = in the Fairies house entrance
	CASE 27
		LOCALS = in the Fairies house hall
	CASE 28
		LOCALS = on the Fairies house stairs
	CASE 29
		LOCALS = in the Fairies house kitchen
	CASE 30
		LOCALS = at the Fairies house bath
	CASE 31
		LOCALS = in the Fairies house upstairs hallway
	CASE 32
		LOCALS = in Sunny's boudoir
	CASE 33
		LOCALS = in Luna's boudoir
	CASE 34
		LOCALS = in Star's boudoir
	CASE 35
		LOCALS = in the Fairies house basement
	CASE 36
		LOCALS = at the Fantasy Ruins approach
	CASE 37
		LOCALS = in the Fantasy Ruins 1F passage
	CASE 38
		LOCALS = in the Fantasy Ruins washroom
	CASE 39
		LOCALS = in the Fantasy Ruins bathroom
	CASE 40
		LOCALS = at the Fantasy Ruins toilet
	CASE 41
		LOCALS = in the Fantasy Ruins dining hall
	CASE 42
		LOCALS = in the Fantasy Ruins kitchen
	CASE 43
		LOCALS = in Yumemi's boudoir
	CASE 44
		LOCALS = in Chiyuri's boudoir
	CASE 45
		LOCALS = on the Fantasy Ruins stairs
	CASE 46
		LOCALS = in the Fantasy Ruins 2F passage
	CASE 47
		LOCALS = on the Fantasy Ruins Bridge
	CASE 48
		LOCALS = in the Fantasy Ruins first data room
	CASE 49
		LOCALS = in the Fantasy Ruins lab
	CASE 50
		LOCALS = in the Fantasy Ruins second data room
	CASE 51
		LOCALS = in the Fantasy Ruins warehouse
	CASE 52
		LOCALS = in the detached house
	CASE 53
		LOCALS = in %STR:53%
	CASE 54
		LOCALS = in the Inchling's insect cage
	CASE 55
		LOCALS = in the Japanese-style room
	CASE 6001
		LOCALS = under the cherry blossom archway
	CASE 6002
		LOCALS = on the shrine grounds
	CASE 6003
		LOCALS = in the shrine main building
	CASE 6004
		LOCALS = on the shrine veranda
	CASE 6005
		LOCALS = in the fairy tree
	CASE 6006
		LOCALS = in the fantasy ruins
	CASE 6011
		LOCALS = on the jizo street
	CASE 6012
		LOCALS = under the Weeping Willow
	CASE 6013
		LOCALS = on the Myouren temple grounds
	CASE 6014
		LOCALS = in the Myouren main temple
	CASE 6015
		LOCALS = in the Myouren cemetery
	CASE 6016 ;神霊廟広場
		LOCALS = in the Shintoku plaza
	CASE 6017 ;神霊廟道場
		LOCALS = in the Shintoku Dojo
	CASE 6021
		LOCALS = in the Human Village square
	CASE 6022
		LOCALS = in the Human Village shopping district
	CASE 6023
		LOCALS = outside the Human Village liquor shop
	CASE 6024
		LOCALS = in the Temple School
	CASE 6025
		LOCALS = at the Human Village public bath
	CASE 6026
		LOCALS = in the Human Village love hotel
	CASE 6027
		LOCALS = in the Human Village residential area
	CASE 6031
		LOCALS = at the Misty Lake
	CASE 6032
		LOCALS = near the Ice Igloos
	CASE 6033
		LOCALS = in the Abandoned Mansion
	CASE 6034
		LOCALS = at the Scarlet Devil Mansion main gate
	CASE 6035
		LOCALS = in the Scarlet Devil Mansion hall
	CASE 6036
		LOCALS = in the Scarlet Devil Mansion dining room
	CASE 6037
		LOCALS = in the Great Library
	CASE 6038
		LOCALS = in the Scarlet Devil Mansion basement
	CASE 6041
		LOCALS = at the entrance to the Bamboo Forest
	CASE 6042
		LOCALS = on the Path Of The Lost
	CASE 6043
		LOCALS = at the edge of the Bamboo Forest
	CASE 6044
		LOCALS = in the Rabbit Cave
	CASE 6045
		LOCALS = at Eientei
	CASE 6046
		LOCALS = on the Nameless Hill
	CASE 6047
		LOCALS = in the Garden of the Sun
	CASE 6048
		LOCALS = in the Eientei Inner Sanctum
	CASE 6049
		LOCALS = in Mugenkan
	CASE 6051
		LOCALS = at the entrance of the Magic Forest 
	CASE 6052
		LOCALS = in Kourindou
	CASE 6053
		LOCALS = by the Big Old Tree
	CASE 6054
		LOCALS = in the Kirisame Magic Shop
	CASE 6055
		LOCALS = in the Dollhouse
	CASE 6056
		LOCALS = on the Road of Reconsideration
	CASE 6057
		LOCALS = in Muenzuka
	CASE 6061
		LOCALS = on the Road of Liminality
	CASE 6062
		LOCALS = by the Sanzu River
	CASE 6063
		LOCALS = in Mayohiga
	CASE 6064
		LOCALS = in Higan
	CASE 6065
		LOCALS = in the Hakugyokurou garden
	CASE 6066
		LOCALS = in Hakugyokurou
	CASE 6067
		LOCALS = in Hell
	CASE 6068
		LOCALS = in the Animal Realm
	CASE 6069
		LOCALS = in the Primate Spirit Garden
	CASE 6071
		LOCALS = on the edge of the Great Forest
	CASE 6072
		LOCALS = in the Genbu Ravine
	CASE 6073
		LOCALS = near the Giant Toad's Pond
	CASE 6074
		LOCALS = in Seija's Secret Base
	CASE 6075
		LOCALS = in Hermit's residence
	CASE 6076
		LOCALS = in the Underground Geyser Center
	CASE 6077 ;森の深奥
		LOCALS = in the deep forest
	CASE 6081
		LOCALS = near the Waterfall of Nine Heavens
	CASE 6082
		LOCALS = on the Hill of Scenery View
	CASE 6083
		LOCALS = by the Mountain Lake
	CASE 6084
		LOCALS = on the Moriya shrine grounds
	CASE 6085
		LOCALS = in the Moriya main shrine
	CASE 6086 ;虹龍洞
		LOCALS = in the Rainbow Dragon Cave
	CASE 6089
		LOCALS = in Heaven
	CASE 6091
		LOCALS = at the Fantastic Blowhole
	CASE 6092
		LOCALS = on the Deep Road To Hell
	CASE 6093
		LOCALS = on the Streets of Former Hell
	CASE 6094
		LOCALS = at Former Hell's hot spring
	CASE 6095
		LOCALS = at Former Hell's love hotel
	CASE 6096
		LOCALS = in the Palace of The Earth Spirits
	CASE 6097
		LOCALS = in the Remains of Blazing Hell
	CASE 6101
		LOCALS = on the Kaian Passage
	CASE 6105
		LOCALS = in the Lunar Capital
	CASE 6106
		LOCALS = in the Watatsuki Pavilion
	CASE 6107
		LOCALS = in the Moon Rabbit District
	CASE 6108
		LOCALS = in the Peach Garden
	CASE 6109
		LOCALS = by the Sea of Tranquility
	CASE 8056 ;あうんの棲家
		LOCALS = in Aunn's Boudoir
	CASE 8101
		LOCALS = by the temple gate
	CASE 8102
		LOCALS = on the temple grounds
	CASE 8103
		LOCALS = in the main temple building
	CASE 8104
		LOCALS = in the auditorium
	CASE 8105
		LOCALS = in the sutra library
	CASE 8106
		LOCALS = in the backyard
	CASE 8107
		LOCALS = in the doma
	CASE 8108
		LOCALS = in the living room
	CASE 8109 ;女苑私室
		LOCALS = in Joon's boudoir
	CASE 8110
		LOCALS = on the veranda
	CASE 8111
		LOCALS = in the kitchen
	CASE 8112
		LOCALS = at the bath
	CASE 8113
		LOCALS = in Nazrin's boudoir
	CASE 8114
		LOCALS = in Murasa's boudoir
	CASE 8115
		LOCALS = in Shou's boudoir
	CASE 8116
		LOCALS = in Ichirin's boudoir
	CASE 8117
		LOCALS = in Nue's boudoir
	CASE 8118
		LOCALS = in Byakuren's boudoir
	CASE 8119
		LOCALS = in the detached house
	CASE 8120
		LOCALS = in the storeroom
	CASE 8121
		LOCALS = at the cemetery
	CASE 8122
		LOCALS = at the temple bell
	CASE 8123
		LOCALS = by the Mausoleum large gate
	CASE 8124
		LOCALS = at the Mausoleum square
	CASE 8125
		LOCALS = in Tojiko's Chamber
	CASE 8126
		LOCALS = in the dojo
	CASE 8127
		LOCALS = in Futo's boudoir
	CASE 8128
		LOCALS = in Miko's boudoir
	CASE 8129
		LOCALS = in the parlour
	CASE 8130
		LOCALS = in the corridor
	CASE 8131
		LOCALS = in the zen garden
	CASE 8132
		LOCALS = in the drug storage room
	CASE 8133
		LOCALS = at the bath
	CASE 8134 ;蔵
		LOCALS = in the warehouse
	CASE 8135 ;廊下
		LOCALS = in the corridor
	CASE 8136 ;響子私室
		LOCALS = in Kyouko's boudoir
	CASE 8137 ;マミゾウの棲家
		LOCALS = in Mamizou's abode
	CASE 8138 ;鐘楼
		LOCALS = at the bell tower
	CASE 8139 ;邪仙楼
		LOCALS = at the Wicked Hermit's rise
	CASE 8140 ;お地蔵通り
		LOCALS = on the Jizo street
	CASE 8201
		LOCALS = by the Village gate
	CASE 8202
		LOCALS = at the central square
	CASE 8203
		LOCALS = at the southern street
	CASE 8204
		LOCALS = at the eastern street
	CASE 8205
		LOCALS = at the northern street
	CASE 8206
		LOCALS = at the western street
	CASE 8207
		LOCALS = by the dragon statue
	CASE 8211
		LOCALS = in the liquor store
	CASE 8212
		LOCALS = in the cafe
	CASE 8213
		LOCALS = at Suzunaan
	CASE 8214
		LOCALS = in front of the residential area
	CASE 8215
		LOCALS = in the flower shop
	CASE 8216
		LOCALS = in the grocery store
	CASE 8217
		LOCALS = in the candy store
	CASE 8218
		LOCALS = in the small restaurant
	CASE 8219
		LOCALS = in the assembly hall
	CASE 8220
		LOCALS = in the watchtower
	CASE 8221
		LOCALS = in Akyuu's Residence
	CASE 8222
		LOCALS = in the Temple School
	CASE 8223
		LOCALS = at the public bath
	CASE 8224
		LOCALS = in Keine's House
	CASE 8225
		LOCALS = in the love hotel
	CASE 8226
		LOCALS = in Kosuzu's boudoir
	CASE 8230
		LOCALS = in %CALLNAME:MASTER%'s room
	CASE 8231
		LOCALS = in Sekibanki's room
	CASE 8232
		LOCALS = in Renko's room
	CASE 8233
		LOCALS = in Maribel's room
	CASE 8234
		LOCALS = in Yuki's room
	CASE 8235
		LOCALS = in Mai's room
	CASE 8236
		LOCALS = at the public toilet
	CASE 8237
		LOCALS = at the public well
	CASE 8301
		LOCALS = by the main gate
	CASE 8302
		LOCALS = in the garden
	CASE 8303
		LOCALS = in the guard hut
	CASE 8304
		LOCALS = in the empty hut
	CASE 8305
		LOCALS = in the barn
	CASE 8306
		LOCALS = in the backyard
	CASE 8307
		LOCALS = on the eastern terrace
	CASE 8308
		LOCALS = on the western terrace
	CASE 8309
		LOCALS = in the hall
	CASE 8310
		LOCALS = in the library
	CASE 8311
		LOCALS = in Patchouli's boudoir
	CASE 8312
		LOCALS = in Koakuma's boudoir
	CASE 8313
		LOCALS = in the kitchen
	CASE 8314
		LOCALS = in the dining room
	CASE 8315
		LOCALS = in the parlour
	CASE 8316
		LOCALS = at the 1F Toilet
	CASE 8317
		LOCALS = on the big staircase
	CASE 8318
		LOCALS = on the basement stairs
	CASE 8319
		LOCALS = in the 2F hallway
	CASE 8320
		LOCALS = in Sakuya's boudoir
	CASE 8321
		LOCALS = in the vacant room
	CASE 8322
		LOCALS = at the 2F toilet
	CASE 8323
		LOCALS = in the fairy maid dormitory
	CASE 8324
		LOCALS = on the large balcony
	CASE 8325
		LOCALS = on the 3F stairs
	CASE 8326
		LOCALS = in Remilia's boudoir
	CASE 8327
		LOCALS = on the small balcony
	CASE 8328
		LOCALS = in the underground corridor
	CASE 8329
		LOCALS = in the warehouse
	CASE 8330
		LOCALS = in the servant room
	CASE 8331
		LOCALS = in the basement
	CASE 8332
		LOCALS = in the dressing room
	CASE 8333
		LOCALS = at the public bath
	CASE 8334
		LOCALS = at the Abandoned Mansion entrance
	CASE 8335
		LOCALS = in the Abandoned Mansion hall
	CASE 8336
		LOCALS = on the Abandoned Mansion stairs
	CASE 8337
		LOCALS = in the Abandoned Mansion kitchen
	CASE 8338
		LOCALS = at the Abandoned Mansion bath
	CASE 8339
		LOCALS = in the Abandoned Mansion 2F hallway
	CASE 8340
		LOCALS = in Lunasa's boudoir
	CASE 8341
		LOCALS = in Merlin's boudoir
	CASE 8342
		LOCALS = in Lyrica's boudoir
	CASE 8343
		LOCALS = by the lakeside
	CASE 8344
		LOCALS = in Letty's igloo
	CASE 8345
		LOCALS = in Cirno's igloo
	CASE 8346
		LOCALS = in Daiyousei's house
	CASE 8347
		LOCALS = by the Misty Lake
	CASE 8348
		LOCALS = at the Misty Lake bottom
	CASE 8401
		LOCALS = at the Eientei entrance
	CASE 8402
		LOCALS = in the foyer
	CASE 8403
		LOCALS = in the waiting room
	CASE 8404
		LOCALS = in the examination room
	CASE 8405
		LOCALS = in the apothecary
	CASE 8406
		LOCALS = at the toilet for visitors
	CASE 8407
		LOCALS = in the corridor
	CASE 8408
		LOCALS = in the middle corridor
	CASE 8409
		LOCALS = on the veranda
	CASE 8410
		LOCALS = in Tewi's boudoir
	CASE 8411
		LOCALS = in Reisen's boudoir
	CASE 8412
		LOCALS = in the vacant room
	CASE 8413
		LOCALS = in Eirin's boudoir
	CASE 8414
		LOCALS = in Kaguya's boudoir
	CASE 8415
		LOCALS = in the hall
	CASE 8416
		LOCALS = in the living room
	CASE 8417
		LOCALS = in the kitchen
	CASE 8418
		LOCALS = in the stables
	CASE 8419
		LOCALS = in the dressing room
	CASE 8420
		LOCALS = at the bath
	CASE 8421
		LOCALS = in the garden
	CASE 8422
		LOCALS = in the backyard
	CASE 8423
		LOCALS = in the closet
	CASE 8424
		LOCALS = in the storeroom
	CASE 8425
		LOCALS = on the 2F stairs
	CASE 8426
		LOCALS = in the 2F hallway
	CASE 8427
		LOCALS = in the warehouse
	CASE 8428
		LOCALS = in the 2F spare room
	CASE 8429
		LOCALS = on the basement stairs
	CASE 8430
		LOCALS = in the basement
	CASE 8431
		LOCALS = in the rabbit cave
	CASE 8432
		LOCALS = in the Kagerou's house
	CASE 8433
		LOCALS = by the edge of the Bamboo Forest
	CASE 8434
		LOCALS = on the Path Of The Lost
	CASE 8435
		LOCALS = by the well
	CASE 8436
		LOCALS = on the Mound Of The Nameless
	CASE 8437
		LOCALS = in Medicine's house
	CASE 8438
		LOCALS = in the Garden Of The Sun
	CASE 8440
		LOCALS = in the run-down house
	CASE 8441
		LOCALS = at the hot spring
	CASE 8442
		LOCALS = in the vacant hut
	CASE 8443
		LOCALS = in Mystia's house
	CASE 8444
		LOCALS = at Mystia's stall
	CASE 8445
		LOCALS = in Mokou's house
	CASE 8446
		LOCALS = at the small shrine
	CASE 8447
		LOCALS = at the entrance to the Bamboo Forest
	CASE 8450
		LOCALS = at the Mugenkan entrance
	CASE 8451
		LOCALS = in Kurumi's boudoir
	CASE 8452
		LOCALS = in Elly's boudoir
	CASE 8453
		LOCALS = in the Mugenkan kitchen
	CASE 8454
		LOCALS = at the Mugenkan bath
	CASE 8455
		LOCALS = at the Mugenkan toilet
	CASE 8456
		LOCALS = in the Mugenkan warehouse
	CASE 8457
		LOCALS = in Mugetsu's boudoir
	CASE 8458
		LOCALS = in the Mugenkan corridor
	CASE 8459
		LOCALS = in Gengetsu's boudoir
	CASE 8460
		LOCALS = in the Mugenkan vacant room
	CASE 8461
		LOCALS = in the Mugenkan living room
	CASE 8462
		LOCALS = on the Mugenkan terrace
	CASE 8463
		LOCALS = in Yuuka's boudoir
	CASE 8464
		LOCALS = on the Mugenkan balcony
	CASE 8465
		LOCALS = in the Mugenkan hall
	CASE 8466
		LOCALS = in the Mugenkan garden
	CASE 8467
		LOCALS = Outside Of Bamboo Forest
	CASE 8501
		LOCALS = at the entrance to the Forest Of Magic
	CASE 8502
		LOCALS = at Kourindou
	CASE 8503
		LOCALS = at the crossroads
	CASE 8506
		LOCALS = at Muenzuka
	CASE 8507
		LOCALS = at the mushroom colony
	CASE 8508
		LOCALS = at the magical square
	CASE 8509
		LOCALS = on the Road of Reconsideration
	CASE 8510
		LOCALS = in the Kirisame magic shop
	CASE 8511
		LOCALS = in the Kirisame living room
	CASE 8512
		LOCALS = in the Marisa's bedroom
	CASE 8513
		LOCALS = in the Kirisame research room
	CASE 8514
		LOCALS = at Kirisame bath
	CASE 8515
		LOCALS = in the Kirisame warehouse
	CASE 8520
		LOCALS = at the entrance to the Dollhouse
	CASE 8521
		LOCALS = in Alice's room
	CASE 8522
		LOCALS = in Shinki's room
	CASE 8523
		LOCALS = in Yumeko's room
	CASE 8524
		LOCALS = in the Dollhouse laboratory
	CASE 8525
		LOCALS = in the Dollhouse living room
	CASE 8526
		LOCALS = at the Dollhouse bath
	CASE 8528
		LOCALS = in the Dollhouse warehouse
	CASE 8529
		LOCALS = on the Dollhouse balcony
	CASE 8530
		LOCALS = on the Dollhouse 2nd floor
	CASE 8531
		LOCALS = in the Dollhouse vacant room
	CASE 8534
		LOCALS = in Fluffy Ellen's Magic Shop
	CASE 8535
		LOCALS = in Ellen's boudoir
	CASE 8536
		LOCALS = in Ellen's warehouse
	CASE 8537
		LOCALS = at Ellen's bath
	CASE 8540
		LOCALS = by the old tree
	CASE 8541
		LOCALS = in Tokiko's living Place
	CASE 8542
		LOCALS = in Wriggle's living Place
	CASE 8543
		LOCALS = in Rumia's living Place
	CASE 8544
		LOCALS = in Narumi's Hut
	CASE 8601 ;中有の道
		LOCALS = on the Road of Liminality
	CASE 8602 ;賽の河原
		LOCALS = in Children's Limbo
	CASE 8603 ;積石塚
		LOCALS = on the Stone Mound
	CASE 8604 ;彼岸
		LOCALS = in Nirvana
	CASE 8608 ;潤美の家
		LOCALS = in Urumi's boudoir
	CASE 8609 ;瓔花の家
		LOCALS = in Eika's boudoir
	CASE 8610 ;是非曲直庁ホール
		LOCALS = in the Ministry of Right and Wrong Hall
	CASE 8612 ;法廷
		LOCALS = in the courtroom
	CASE 8613 ;是非曲直庁廊下
		LOCALS = in the Ministry of Right and Wrong Corridor
	CASE 8614 ;是非曲直庁ラウンジ
		LOCALS = in the Ministry of Right and Wrong Lounge
	CASE 8615 ;映姫の部屋
		LOCALS = in Shikieiki's boudoir
	CASE 8616 ;小町の部屋
		LOCALS = in Komachi's boudoir
	CASE 8617 ;風呂
		LOCALS = in the bath
	CASE 8618 ;空き部屋
		LOCALS = in %CALLNAME:MASTER%'s room
	CASE 8620 ;冥界の門
		LOCALS = at the gate to the Netherworld
	CASE 8621 ;庭
		LOCALS = in the garden
	CASE 8622 ;廊下
		LOCALS = in the corridor
	CASE 8623 ;幽々子私室
		LOCALS = in Yuyuko's boudoir
	CASE 8624 ;妖夢私室
		LOCALS = in Youmu's boudoir
	CASE 8625 ;あなた私室
		LOCALS = in %CALLNAME:MASTER%'s room
	CASE 8626 ;台所
		LOCALS = in the kitchen
	CASE 8627 ;風呂
		LOCALS = in the bath
	CASE 8628 ;居間
		LOCALS = in the living room
	CASE 8629 ;西行妖
		LOCALS = by the Saigyou Ayakashi
	CASE 8630 ;八雲邸玄関
		LOCALS = in the Yakumo Residence entrance
	CASE 8631 ;八雲邸廊下
		LOCALS = in the Yakumo Residence corridor
	CASE 8632 ;八雲邸庭
		LOCALS = in the Yakumo Residence kitchen garden
	CASE 8633 ;紫私室
		LOCALS = in Yukari's Boudoir
	CASE 8634 ;空部屋
		LOCALS = in %CALLNAME:MASTER%'s room
	CASE 8635 ;橙私室
		LOCALS = in Chen's Boudoir
	CASE 8636 ;八雲邸風呂
		LOCALS = in the Yakumo Residence bath
	CASE 8637 ;八雲邸台所
		LOCALS = in the Yakumo Residence kitchen
	CASE 8638 ;藍私室
		LOCALS = in Ran's Boudoir
	CASE 8639 ;八雲邸居間
		LOCALS = in the Yakumo Residence living room
	CASE 8640 ;異界の関所
		LOCALS = at the Border of the Otherworld
	CASE 8641 ;畜生メトロポリス
		LOCALS = in the Beast Metropolis
	CASE 8642 ;霊長園
		LOCALS = in the Primate Spirit Garden
	CASE 8643 ;霊長園の風呂
		LOCALS = in the Primate Spirit Garden Bath
	CASE 8644 ;袿姫の部屋
		LOCALS = in Keiki's boudoir
	CASE 8645 ;磨弓の部屋
		LOCALS = in Mayumi boudoir
	CASE 8646 ;八千慧宅の風呂
		LOCALS = in Yachie's bath
	CASE 8647 ;八千慧宅のリビング
		LOCALS = in Yachie's living room
	CASE 8648 ;八千慧宅の寝室
		LOCALS = in Yachie's boudoir
	CASE 8650 ;早鬼宅のリビング
		LOCALS = in the Kurokoma living room
	CASE 8651 ;早鬼宅の寝室
		LOCALS = in Kurokoma's Boudoir
	CASE 8652 ;早鬼宅の風呂
		LOCALS = in the Kurokoma bath
	CASE 8653 ;尤魔宅のリビング
		LOCALS = in Yuuma's living room
	CASE 8654 ;尤魔宅の寝室
		LOCALS = in Yuuma's boudoir
	CASE 8655 ;尤魔宅の風呂
		LOCALS = in Yuuma's bath
	CASE 8701
		LOCALS = by the entrance to the Great Forest
	CASE 8702
		LOCALS = on the path to the ravine
	CASE 8703
		LOCALS = at the Genbu ravine
	CASE 8704
		LOCALS = in the Kappa's hideout
	CASE 8705
		LOCALS = by the mountain side
	CASE 8706
		LOCALS = in the Misfortune Goddess' house
	CASE 8707
		LOCALS = at the mountain trail crossroads
	CASE 8708
		LOCALS = by the Giant Toad's pond
	CASE 8709
		LOCALS = in the Lily Sisters' house
	CASE 8710
		LOCALS = at the Village of Cats
	CASE 8711
		LOCALS = at the Resting Place
	CASE 8712
		LOCALS = at the Underground Geyser Center
	CASE 8715
		LOCALS = on the Aki Sisters' field
	CASE 8716
		LOCALS = at the Aki Sisters' Doma
	CASE 8717
		LOCALS = in the Aki Sisters' bedroom
	CASE 8718
		LOCALS = in the Aki Sisters' living room
	CASE 8719
		LOCALS = in the Aki Sisters' tatami room
	CASE 8720
		LOCALS = in the Hermit's Residence kitchen
	CASE 8721
		LOCALS = at the Hermit's Residence bath
	CASE 8722
		LOCALS = in the Hermit's Residence dojo
	CASE 8723
		LOCALS = in the Hermit's Residence 2F parlour
	CASE 8724
		LOCALS = in the Hermit's Residence reading room
	CASE 8725
		LOCALS = in the Hermit's Residence Sea Eagle's room
	CASE 8726
		LOCALS = in the Hermit's Residence living room
	CASE 8727
		LOCALS = in Kasen's boudoir
	CASE 8728
		LOCALS = in the Hermit's Residence vacant room
	CASE 8729
		LOCALS = at the Hermit's Residence entrance
	CASE 8730
		LOCALS = in the Hermit's Residence garden
	CASE 8731
		LOCALS = at the Broom Tree
	CASE 8732
		LOCALS = on the road to the mountain summit
	CASE 8733
		LOCALS = in Seija's Hideout
	CASE 8734
		LOCALS = in the shed
	CASE 8735
		LOCALS = at the bathing place
	CASE 8736
		LOCALS = in the yamanba's house
	CASE 8737 ;招き猫の家
		LOCALS = in the Manekineko's house
	CASE 8738 ;森の深奥
		LOCALS = in the deep forest
	CASE 8739 ;秘天崖
		LOCALS = at the Secret Green Cliff
	CASE 8740 ;山童のアジト
		LOCALS = in the Yamawaro's hideout
	CASE 8801
		LOCALS = at the summit entrance
	CASE 8802
		LOCALS = on the bridge
	CASE 8803
		LOCALS = at the cableway station
	CASE 8804
		LOCALS = by the Moriya Shrine torii
	CASE 8805
		LOCALS = on the summit
	CASE 8806
		LOCALS = behind the waterfall
	CASE 8807
		LOCALS = at Momiji residence
	CASE 8808
		LOCALS = at Aya residence
	CASE 8809
		LOCALS = at Hatate residence
	CASE 8810
		LOCALS = in the mountain hut
	CASE 8811
		LOCALS = on the shrine grounds
	CASE 8812
		LOCALS = in the main shrine
	CASE 8813
		LOCALS = in the shrine office
	CASE 8814
		LOCALS = by the lakeside
	CASE 8815
		LOCALS = in the garden
	CASE 8816
		LOCALS = on the veranda
	CASE 8817
		LOCALS = in Kanako's boudoir
	CASE 8818
		LOCALS = in Suwako's boudoir
	CASE 8819
		LOCALS = in the living room
	CASE 8820
		LOCALS = in Sanae's boudoir
	CASE 8821
		LOCALS = in the doma
	CASE 8822
		LOCALS = in the kitchen
	CASE 8823
		LOCALS = in %CALLNAME:MASTER%'s room
	CASE 8824
		LOCALS = at the toilet
	CASE 8825
		LOCALS = at the bath
	CASE 8826
		LOCALS = in the corridor
	CASE 8830
		LOCALS = in the sea of abstruse clouds
	CASE 8831
		LOCALS = in front of the Hinanawi Residence
	CASE 8832
		LOCALS = on the Bhavaagra Streets
	CASE 8833
		LOCALS = at Orchard
	CASE 8834
		LOCALS = in the doma
	CASE 8835
		LOCALS = in the parlour
	CASE 8836
		LOCALS = in the Hinanawi kitchen
	CASE 8837
		LOCALS = at the bath
	CASE 8838
		LOCALS = in the living room
	CASE 8839
		LOCALS = in the japanese-style room
	CASE 8840
		LOCALS = in Tenshi's boudoir
	CASE 8841
		LOCALS = in Iku's boudoir
	CASE 8842
		LOCALS = in the storeroom
	CASE 8851 ;久侘歌の小屋
		LOCALS = in Kutaka's hut
	CASE 8852 ;駒草の小屋
		LOCALS = in Sannyo's hut
	CASE 8853 ;魅須丸の小屋
		LOCALS = in Misumaru's hut
	CASE 8854 ;龍宅
		LOCALS = in Megumu's house
	CASE 8855 ;虹龍洞
		LOCALS = in the Rainbow Dragon Cave
	CASE 8856 ;百々世の住処
		LOCALS = in Momoyo's dwelling
	CASE 8901
		LOCALS = at the Palace Of The Earth Spirits approach
	CASE 8902
		LOCALS = at the Palace Of The Earth Spirits entrance
	CASE 8903
		LOCALS = in the reception room
	CASE 8904
		LOCALS = in the banquet hall
	CASE 8905
		LOCALS = in the 1F hallway
	CASE 8906
		LOCALS = at 1F toilet
	CASE 8909
		LOCALS = in the kitchen
	CASE 8910
		LOCALS = in the pantry
	CASE 8911
		LOCALS = in Okuu's boudoir
	CASE 8912
		LOCALS = in Orin's boudoir
	CASE 8913
		LOCALS = in the Dining room
	CASE 8914
		LOCALS = in the 2F Hallway
	CASE 8915
		LOCALS = on the balcony
	CASE 8916
		LOCALS = in the storage room
	CASE 8917
		LOCALS = at the 2F Toilet
	CASE 8918
		LOCALS = in Koishi's boudoir
	CASE 8919
		LOCALS = in Satori's boudoir
	CASE 8920
		LOCALS = in the study
	CASE 8921
		LOCALS = at the bath
	CASE 8922
		LOCALS = in the dressing room
	CASE 8923
		LOCALS = in the backyard
	CASE 8925
		LOCALS = in the rose garden
	CASE 8926
		LOCALS = in the courtyard
	CASE 8927
		LOCALS = at the Remains Of Blazing Hell entrance
	CASE 8928
		LOCALS = by Remains Of Blazing Hell
	CASE 8929 ;地獄の人工太陽
		LOCALS = by hell's artificial sun
	CASE 8930 ;旧血の池地獄
		LOCALS = in former Hell of Blood Pools
	CASE 8931
		LOCALS = at the main street
	CASE 8932
		LOCALS = in the back alley
	CASE 8933
		LOCALS = in the tavern
	CASE 8934
		LOCALS = at the hot spring
	CASE 8935
		LOCALS = at the inn
	CASE 8936
		LOCALS = in Yuugi's house
	CASE 8937
		LOCALS = in the Vacant house
	CASE 8938
		LOCALS = at the Oni hang-Out
	CASE 8939
		LOCALS = at the off-street
	CASE 8940
		LOCALS = in Parsee's House
	CASE 8941
		LOCALS = in Yamame's House
	CASE 8942
		LOCALS = in Kisume's House
	CASE 8943
		LOCALS = in the hovel
	CASE 8944
		LOCALS = on the street
	CASE 8945
		LOCALS = by the riverside
	CASE 8946
		LOCALS = on the bridge
	CASE 8948
		LOCALS = at the bottom of the blowhole
	CASE 8949
		LOCALS = by the surface
	CASE 9001 ;槐安通路
		LOCALS = in the Kaian Passageway
	CASE 9002 ;月の都
		LOCALS = in the Lunar Capital
	CASE 9003 ;玉兎街
		LOCALS = in the Moon Rabbit Quarter
	CASE 9004 ;広場
		LOCALS = in the Plaza
	CASE 9005 ;サグメ宅 居間
		LOCALS = in Sagume's Living Room
	CASE 9006 ;サグメ宅 寝室
		LOCALS = in Sagume's Boudoir
	CASE 9007 ;空き家
		LOCALS = in the Vacant House
	CASE 9008 ;鈴瑚宅
		LOCALS = in Ringo's Residence
	CASE 9009 ;清蘭宅
		LOCALS = in Seiran's Residence
	CASE 9010 ;食事処
		LOCALS = at the Eating Place
	CASE 9011 ;甘味処
		LOCALS = at the Japanese Cafe
	CASE 9012 ;酒屋
		LOCALS = at the Liquor Store
	CASE 9013 ;八百屋
		LOCALS = at the Grocer
	CASE 9014 ;桃林
		LOCALS = in the Peach Grove
	CASE 9015 ;砂浜
		LOCALS = at the Sandy Beach
	CASE 9016 ;入り江
		LOCALS = at the Inlet
	CASE 9020 ;綿月亭 門
		LOCALS = at the Watatsuki Pavillion Gate
	CASE 9021 ;綿月亭 玄関
		LOCALS = at the Watatsuki Pavillion Foyer
	CASE 9022 ;一階回廊
		LOCALS = in the First Floor Corridor
	CASE 9023 ;門番詰め所
		LOCALS = in the Gatekeeper Station
	CASE 9024 ;玉兎食堂
		LOCALS = in the Rabbit Cafeteria
	CASE 9025 ;玉兎詰め所
		LOCALS = in the Rabbit Office
	CASE 9026 ;食堂
		LOCALS = in the Dining Room
	CASE 9027 ;厨房
		LOCALS = in the Kitchen
	CASE 9028 ;食料庫
		LOCALS = in the Food Storage
	CASE 9029 ;綿月亭 脱衣所
		LOCALS = in the Watatsuki Pavillion Changing Room
	CASE 9030 ;綿月亭 風呂
		LOCALS = in the Watatsuki Pavillion Bath
	CASE 9031 ;宝物庫
		LOCALS = in the Treasure Storage
	CASE 9032 ;レイセン私室
		LOCALS = in Rei'sen's Boudoir
	CASE 9033 ;綿月亭 空き部屋
		LOCALS = in the Watatsuki Pavillion Empty Room
	CASE 9035 ;中庭
		LOCALS = in the Courtyard
	CASE 9036 ;四阿
		LOCALS = in the Azumaya
	CASE 9040 ;二階回廊
		LOCALS = in the Second Floor Corridor
	CASE 9041 ;豊姫私室
		LOCALS = in Toyohime's Boudoir
	CASE 9042 ;依姫私室
		LOCALS = in Yorihime's Boudoir
	CASE 9043 ;書斎
		LOCALS = in the Library
	CASE 9044 ;応接間
		LOCALS = in the Parlour
	CASE 9050 ;ドレミー宅 居間
		LOCALS = in Doremy Residence Living Room
	CASE 9051 ;ドレミー宅 寝室
		LOCALS = in Doremy's Boudoir
	CASE 9052 ;ドレミー宅 倉庫
		LOCALS = in Doremy Residence Storage
	CASE 9053 ;ドレミー宅 洗面所
		LOCALS = in Doremy Residence Washroom
	CASE 9054 ;ドレミー宅 風呂
		LOCALS = in Doremy Residence Bath
	CASE 9055 ;ドレミー宅 トイレ
		LOCALS = in Doremy Residence Toilet
	CASE 9060 ;純狐邸 玄関
		LOCALS = in Junko Residence Entrance
	CASE 9061 ;居間
		LOCALS = in the Living Room
	CASE 9062 ;台所
		LOCALS = in the Kitchen
	CASE 9063 ;純狐邸 空き部屋
		LOCALS = in the Junko Residence Vacant Room
	CASE 9064 ;クラウンピース私室
		LOCALS = in Clownpiece's Boudoir
	CASE 9065 ;物置
		LOCALS = in the Storeroom
	CASE 9066 ;純狐邸 脱衣所
		LOCALS = in Junko Residence Dressing Room
	CASE 9067 ;純狐邸 風呂
		LOCALS = in Junko Residence Bath
	CASE 9068 ;純狐邸 中庭
		LOCALS = in Junko Residence Courtyard
	CASE 9070 ;屋上
		LOCALS = on the Rooftop
	CASE 9071 ;純狐私室
		LOCALS = in Junko's Boudoir
	CASE 9072 ;ヘカーティア私室
		LOCALS = in Hecatia's Boudoir
	CASE 9073 ;夢の向こう
		LOCALS = on the Other Side of the Dream
	CASEELSE
		LOCALS '= @"in %NAME_FROM_PLACE(ARG)%"
ENDSELECT
RETURNF LOCALS

@ESTRUS_CATEGORY_STRING_TR(ARGS)
#FUNCTIONS
SELECTCASE ARGS
	CASE "安全日"
		LOCALS = Safe Day
	CASE "危険日前日"
		LOCALS = Before Dangerous Day
	CASE "危険日"
		LOCALS = Dangerous Day
	CASE "排卵"
		LOCALS = Ovulation
	CASE "排卵誘発剤効果発揮中"
		LOCALS = Ovulation Drug
	CASE "非危険日"
		LOCALS = Non-Dangerous Day
	CASEELSE
		LOCALS = %ARGS%
ENDSELECT
RETURNF LOCALS

;作物
@CROP_NAME_TR(ARGS)
#FUNCTIONS
SELECTCASE ARGS
	CASE "お米"
		LOCALS = rice
	CASE "レタス"
		LOCALS = lettuce
	CASE "栗"
		LOCALS = chestnuts
	CASE "オクラ"
		LOCALS = okra
	CASE "イチゴ"
		LOCALS = strawberries
	CASE "スイカ"
		LOCALS = watermelons
	CASE "キノコ"
		LOCALS = mushrooms
	CASE "テンサイ"
		LOCALS = sugar beets
	CASE "小麦"
		LOCALS = wheat
	CASE "大豆"
		LOCALS = soy
	CASE "生糸"
		LOCALS = raw silk
	CASE "ゴマ"
		LOCALS = sesame
	CASE "メロン"
		LOCALS = melon
	CASE "ヒシ"
		LOCALS = water caltrops
	CASE "桃"
		LOCALS = peaches
	CASE "キウイ"
		LOCALS = kiwi
	CASE "白ウド"
		LOCALS = white ginseng
	CASE "ナス"
		LOCALS = eggplants
	CASE "バラの花"
		LOCALS = roses
	CASE "キュウリ"
		LOCALS = cucumber
	CASE "ニンジン"
		LOCALS = carrots
	CASE "モヤシ"
		LOCALS = bean sprouts
	CASE "サンショウ"
		LOCALS = pepper
	CASE "ソバ"
		LOCALS = buckwheat
	CASE "ザクロ"
		LOCALS = pomegranate
	CASE "花の苗"
		LOCALS = flower seedlings
	CASE "フキ"
		LOCALS = butterbur
	CASE "薬草"
		LOCALS = medicinal plants
	CASE "椿油"
		LOCALS = camellia oil
	CASE "ヤマブドウ"
		LOCALS = crimson glory vine
	CASE "お芋"
		LOCALS = potatoes
	CASE "ゼンマイ"
		LOCALS = royal fern
	CASE "大根"
		LOCALS = daikon
	CASEELSE
		LOCALS = %ARGS%
ENDSELECT
RETURNF LOCALS

@FARMING_DESCRIPTION_TR(ARGS)
#FUNCTIONS
SELECTCASE ARGS
	CASE "米農家"
		LOCALS = Rice farmer
	CASE "大豆農家"
		LOCALS = Soy farmer
	CASE "レタス農家"
		LOCALS = Lettuce farmer
	CASE "栗農家"
		LOCALS = Chestnut farmer
	CASE "オクラ農家"
		LOCALS = Okra farmer
	CASE "イチゴ農家"
		LOCALS = Strawberry farmer
	CASE "スイカ農家"
		LOCALS = Watermelon farmer
	CASE "キノコ農家"
		LOCALS = Mushroom farmer
	CASE "甜菜農家"
		LOCALS = Suger beet farmer
	CASE "小麦農家"
		LOCALS = Wheat farmer
	CASE "養蚕農家"
		LOCALS = Silk farmer
	CASE "胡麻農家"
		LOCALS = Sesame farmer
	CASE "メロン農家"
		LOCALS = Melon farmer
	CASE "ヒシ農家"
		LOCALS = Water caltrop farmer
	CASE "桃農家"
		LOCALS = Peach farmer
	CASE "キウイ農家"
		LOCALS = Kiwi farmer
	CASE "ウド農家"
		LOCALS = Ginseng farmer
	CASE "ナス農家"
		LOCALS = Eggplants farmer
	CASE "バラ農家"
		LOCALS = Rose farmer
	CASE "キュウリ農家"
		LOCALS = Cucumber farmer
	CASE "ニンジン農家"
		LOCALS = Carrot farmer
	CASE "モヤシ農家"
		LOCALS = Bean sprout farmer
	CASE "山椒農家"
		LOCALS = Pepper farmer
	CASE "ソバ農家"
		LOCALS = Buckwheat farmer
	CASE "柘榴農家"
		LOCALS = Pomegranate farmer
	CASE "花卉農家"
		LOCALS = Flower farmer
	CASE "蕗農家"
		LOCALS = Butterbur farmer
	CASE "薬草農家"
		LOCALS = Medicinal plants farmer
	CASE "椿農家"
		LOCALS = Camellia oil farmer
	CASE "山葡萄農家"
		LOCALS = Crimson glory vine farmer
	CASE "芋農家"
		LOCALS = Potato farmer
	CASE "山菜農家"
		LOCALS = Royal fern farmer
	CASE "大根農家"
		LOCALS = Daikon farmer
	CASEELSE
		LOCALS = %ARGS%
ENDSELECT
RETURNF LOCALS

;For 畑の種類
@FARM_FIELD_TR(ARGS)
#FUNCTIONS
SELECTCASE ARGS
	CASE "水田"
		LOCALS = rice paddy
	CASE "大豆畑"
		LOCALS = soybean field
	CASE "レタス畑"
		LOCALS = lettuce field
	CASE "栗林"
		LOCALS = chestnut orchard
	CASE "オクラ畑"
		LOCALS = okra field
	CASE "イチゴ畑"
		LOCALS = strawberry patch
	CASE "スイカ畑"
		LOCALS = watermelon field
	CASE "キノコ農園"
		LOCALS = mushroom plantation
	CASE "甜菜畑"
		LOCALS = suger beet field
	CASE "小麦畑"
		LOCALS = wheat field
	CASE "養蚕小屋"
		LOCALS = silkworm shed
	CASE "胡麻畑"
		LOCALS = sesame field
	CASE "温室"
		LOCALS = greenhouse
	CASE "ため池"
		LOCALS = reservoir
	CASE "桃農園"
		LOCALS = peach orchard
	CASE "キウイ農園"
		LOCALS = kiwi orchard
	CASE "ウド畑"
		LOCALS = ginseng field
	CASE "ナス畑"
		LOCALS = eggplant field
	CASE "バラ園"
		LOCALS = rose garden
	CASE "キュウリ畑"
		LOCALS = cucumber field
	CASE "ニンジン畑"
		LOCALS = carrot field
	CASE "モヤシ部屋"
		LOCALS = bean sprout shed
	CASE "山椒畑"
		LOCALS = pepper field
	CASE "ソバ畑"
		LOCALS = buckwheat field
	CASE "柘榴畑"
		LOCALS = pomgranate field
	CASE "お花畑"
		LOCALS = flower field
	CASE "蕗畑"
		LOCALS = butterbur field
	CASE "薬草畑"
		LOCALS = herbal field
	CASE "椿農園"
		LOCALS = camellia farm
	CASE "山葡萄畑"
		LOCALS = crimson glory vine field
	CASE "お芋畑"
		LOCALS = potato field
	CASE "ゼンマイ畑"
		LOCALS = royal fern field
	CASE "大根畑"
		LOCALS = daikon field
	CASEELSE
		LOCALS = %ARGS%
ENDSELECT
RETURNF LOCALS

@FARM_LOCATION_TR(ARGS)
#FUNCTIONS
SELECTCASE ARGS
	CASE "博麗神社"
		LOCALS = Hakurei Shrine
	CASE "夢幻遺跡"
		LOCALS = Fantasy Ruins
	CASE "魔法の森"
		LOCALS = Forest Of Magic
	CASE "霧の湖"
		LOCALS = Misty Lake
	CASE "紅魔館"
		LOCALS = Scarlet Devil Mansion
	CASE "人里"
		LOCALS = Human Village
	CASE "妖怪の山・山麓"
		LOCALS = Youkai Mountain - Foot
	CASE "守谷神社"
		LOCALS = Moriya Shrine
	CASE "天界"
		LOCALS = Heaven
	CASE "地底"
		LOCALS = Underworld
	CASE "命蓮寺"
		LOCALS = Myouren Temple
	CASE "迷いの竹林"
		LOCALS = Bamboo Forest of the Lost
	CASE "妖怪の山・山頂"
		LOCALS = Youkai Mountain - Summit
	CASE "冥界"
		LOCALS = Netherworld
	CASEELSE
		LOCALS = %ARGS%
ENDSELECT
RETURNF LOCALS

;returns an "n" if the string begins with a vowel
@AN(ARGS)
#FUNCTIONS
SUBSTRING ARGS, 0, 1 
SIF GROUPMATCH(RESULTS, "a", "e", "i", "o", "u", "A", "E", "I", "O", "U")
	RETURNF "n"

;To be used with item names originally
@A_AN(ARGS)
#FUNCTIONS
SUBSTRING ARGS, 0, 1
SIF RESULTS == "【"
	RETURNF ""
SIF GROUPMATCH(RESULTS, "a", "e", "i", "o", "u", "A", "E", "I", "O", "U")
	RETURNF "an "
RETURNF "a "

;A replacement for CALLNAME, has flags letting you do certain things
@ANAME(ARG, ONGOING = 0)
#FUNCTIONS
#DIM ONGOING
SIF ONGOING
	RETURNF HIM_HER(ARG)
RETURNF CALLNAME:ARG


;In order to avoid having to write stuff like \@(local:1) == 2?%" "%and the others#\@
@COND_STR(ARGS, CONDITION)
#FUNCTIONS
#DIM CONDITION
IF CONDITION
	RETURNF @"%ARGS%"
ENDIF


@CONJUGATOR(ARGS, ARG:0)
#FUNCTIONS
IF SPLIT_CHECK(ARGS:0, "ing")
	LOCALS:0 '= VERBT_CONTINUOUS(SPLIT_SINGLE(ARGS:0), ARG:0)
ELSEIF SPLIT_CHECK(ARGS:0, "s")
	LOCALS:0 '= VERBT_SIMPLE(SPLIT_SINGLE(ARGS:0), ARG:0)
ELSEIF SPLIT_CHECK(ARGS:0, "ed")
	LOCALS:0 '= VERBT_PAST(SPLIT_SINGLE(ARGS:0))
ELSE
	LOCALS:0 '= SPLIT_SINGLE(ARGS:0)
ENDIF
RETURNF LOCALS

;--------------------------------------------------------
;changes verbs to present continuous tense (ing), not exactly correct on the CVC rule for multi-syllable words
;note this function acts on the first word of the string
;--------------------------------------------------------
@VERBT_CONTINUOUS(ARGS:0, ARG:0 = -1)
#FUNCTIONS
SIF ARG:0 == -1
	ARG:0 = THIRD_PERSON
SIF !ARG:0
	RETURNF ARGS:0
;try to affect only first word if sentence is passed
LOCALS = 
IF STRCOUNT(ARGS:0, " ") > 0
	LOCALS:0 '= SPLIT_SINGLE(ARGS:0, 0, " ")
	LOCALS:1 '= REPLACE(ARGS, SPLIT_SINGLE(ARGS:0, 0, " "), "")
	ARGS:0 '= LOCALS:0
ENDIF

IF WORD_ENDS_IN(ARGS:0, "[^aieou][aeiou][^aeiouwxy]") && (!WORD_ENDS_IN(ARGS:0, "er", "en", "o.", "[^p]el") || STRCOUNT(TOLOWER(ARGS:0), "throb|^gel$")) ;complicated to explain... CVC rule for doubling last letter + some exception
	ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]*[^aieou][aeiou]([^aeiouwxy]))(?=\s|$)", "$1$2ing")%
ELSEIF WORD_ENDS_IN(ARGS:0, "ie") ;if word ends in "ie", drop and add "ying"
	ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+)ie(?=\s|$)", "$1ying")%
ELSEIF WORD_ENDS_IN(ARGS:0, "[^aeiou]e") ;if word ends in silent "e", drop and add "ing"
	ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+[^aeiou])e(?=\s|$)", "$1ing")%
ELSEIF WORD_ENDS_IN(ARGS:0, "sue") ;try resolving the problem with words like sue, issue, pursue, etc
	ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+)e(?=\s|$)", "$1ing")%
ELSE ;add "ing"
	ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+)(?=\s|$)", "$1ing")%
ENDIF
SIF STRLENS(LOCALS)
	ARGS:0 = %ARGS:0%%LOCALS:1%

RETURNF ARGS:0

;--------------------------------------------------------
;Check if first word in string ARGS:0 ends in any specified substring ARGS:1 through ARGS:9
;--------------------------------------------------------
@WORD_ENDS_IN(ARGS:0, ARGS:1 = "NULL", ARGS:2 = "NULL", ARGS:3 = "NULL", ARGS:4 = "NULL", ARGS:5 = "NULL", ARGS:6 = "NULL", ARGS:7 = "NULL", ARGS:8 = "NULL", ARGS:9 = "NULL")
#FUNCTION
RETURNF STRCOUNT(ARGS:0, "^[^\s]*(" + ARGS:1 + "|" + ARGS:2 + "|" + ARGS:3 + "|" + ARGS:4 + "|" + ARGS:5 + "|" + ARGS:6 + "|" + ARGS:7 + "|" + ARGS:8 + "|" + ARGS:9 + ")(?=\s|$)")

;--------------------------------------------------------
;Check if a string ARGS:0 ends in any specified substring ARGS:1 through ARGS:9
;--------------------------------------------------------
@STRING_ENDS_IN(ARGS:0, ARGS:1 = "NULL", ARGS:2 = "NULL", ARGS:3 = "NULL", ARGS:4 = "NULL", ARGS:5 = "NULL", ARGS:6 = "NULL", ARGS:7 = "NULL", ARGS:8 = "NULL", ARGS:9 = "NULL")
#FUNCTION
RETURNF STRCOUNT(ARGS:0, "(" + ARGS:1 + "|" + ARGS:2 + "|" + ARGS:3 + "|" + ARGS:4 + "|" + ARGS:5 + "|" + ARGS:6 + "|" + ARGS:7 + "|" + ARGS:8 + "|" + ARGS:9 + ")$")

;--------------------------------------------------------
;Check if first word in string ARGS:0 starts in any specified substring ARGS:1 through ARGS:9
;--------------------------------------------------------
@WORD_STARTS_IN(ARGS:0, ARGS:1 = "NULL", ARGS:2 = "NULL", ARGS:3 = "NULL", ARGS:4 = "NULL", ARGS:5 = "NULL", ARGS:6 = "NULL", ARGS:7 = "NULL", ARGS:8 = "NULL", ARGS:9 = "NULL")
#FUNCTION

RETURNF STRCOUNT(ARGS:0, "^(" + ARGS:1 + "|" + ARGS:2 + "|" + ARGS:3 + "|" + ARGS:4 + "|" + ARGS:5 + "|" + ARGS:6 + "|" + ARGS:7 + "|" + ARGS:8 + "|" + ARGS:9 + ")")

;--------------------------------------------------------
;Check if a string ARGS:0 starts in any specified substring ARGS:1 through ARGS:9
;--------------------------------------------------------
@STRING_STARTS_IN(ARGS:0, ARGS:1 = "NULL", ARGS:2 = "NULL", ARGS:3 = "NULL", ARGS:4 = "NULL", ARGS:5 = "NULL", ARGS:6 = "NULL", ARGS:7 = "NULL", ARGS:8 = "NULL", ARGS:9 = "NULL")
#FUNCTION

RETURNF STRCOUNT(ARGS:0, "^(" + ARGS:1 + "|" + ARGS:2 + "|" + ARGS:3 + "|" + ARGS:4 + "|" + ARGS:5 + "|" + ARGS:6 + "|" + ARGS:7 + "|" + ARGS:8 + "|" + ARGS:9 + ")")

;--------------------------------------------------------
;changes verbs to 3rd person simple present tense (s)
;note this function acts on the first word of the string
;--------------------------------------------------------
@VERBT_SIMPLE(ARGS:0, ARG:0 = -1)
#FUNCTIONS
SIF ARG:0 == -1
	ARG:0 = THIRD_PERSON
SIF !ARG:0 
	RETURNF ARGS:0
IF WORD_ENDS_IN(ARGS:0, "[^aeiou]y") ;if last letter is "y" not preceded by a vowel, drop it and add "ies"
	ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+[^aeiou])y(?=\s|$)", "$1ies")%
ELSEIF WORD_ENDS_IN(ARGS:0, "x", "s", "ch", "sh", "o") ;if word ends in "x", "s", "ss" "sh", "o" for does or "ch" add "es"
	ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+)(?=\s|$)", "$1es")%
ELSE ;add "s"
	ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+)(?=\s|$)", "$1s")%
ENDIF

RETURNF ARGS:0

;--------------------------------------------------------
;changes verbs to past tense (ed)
;note this function acts on the first word of the string
;--------------------------------------------------------
@VERBT_PAST(ARGS:0)
#FUNCTIONS

;try to affect only first word if sentence is passed
LOCALS = 
IF STRCOUNT(ARGS:0, " ") > 0
	LOCALS:0 '= SPLIT_SINGLE(ARGS:0, 0, " ")
	LOCALS:1 '= REPLACE(ARGS, SPLIT_SINGLE(ARGS:0, 0, " "), "")
	ARGS:0 '= LOCALS:0
ENDIF

IF IRREGULAR_PAST_VERBS(ARGS:0) != "" ;if word is an irregular verb, replace it
	ARGS:0 = %REPLACE(ARGS:0, ARGS:0, IRREGULAR_PAST_VERBS(ARGS:0))%
ELSEIF WORD_ENDS_IN(ARGS:0, "[^aieou][aeiou][^aeiouwxy]") && (!WORD_ENDS_IN(ARGS:0, "er", "en", "o.", "[^p]el") || STRCOUNT(TOLOWER(ARGS:0), "throb|^gel$")) ;complicated to explain... CVC rule for doubling last letter (not 100% correct)
	ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]*[^aieou][aeiou]([^aeiouwxy]))(?=\s|$)", "$1$2ed")%
ELSEIF WORD_ENDS_IN(ARGS:0, "[^aieou]y") ;if word ends in a consonant and "y", change it to "i" and add "ed"
	ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+[^aeiou])y(?=\s|$)", "$1ied")%
ELSEIF WORD_ENDS_IN(ARGS:0, "[aieou]", "ue", "oe", "ie") ;if word ends in vowel, add "d", not entirely correct, might need some tweaking
	ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+)(?=\s|$)", "$1d")%
ELSE ;add "ed"
	ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+)(?=\s|$)", "$1ed")%
ENDIF

SIF STRLENS(LOCALS)
	ARGS:0 = %ARGS:0%%LOCALS:1%

RETURNF ARGS:0

;--------------------------------------------------------
;returns a specified part of a split string
;--------------------------------------------------------
@SPLIT_SINGLE(ARGS:0, ARG:0 = 0, ARGS:1 = ":")
#FUNCTIONS
#DIMS DYNAMIC strSplit, 30

LOCAL = RESULT

SPLIT ARGS:0, ARGS:1, strSplit

RESULT = LOCAL

RETURNF strSplit:(ARG:0)

;--------------------------------------------------------
;modified the function in STR_BODY to be less restrictive (string:string:string, matching string, matching string, etc)
;works similarly to GROUPMATCH, but with : split strings
;--------------------------------------------------------
@SPLIT_CHECK(ARGS:0, ARGS:1 = "NULL", ARGS:2 = "NULL", ARGS:3 = "NULL", ARGS:4 = "NULL", ARGS:5 = "NULL", ARGS:6 = "NULL", ARGS:7 = "NULL", ARGS:8 = "NULL", ARGS:9 = "NULL")
#FUNCTION

RETURNF STRCOUNT(ARGS:0, "(^|:)(" + ARGS:1 + "|" + ARGS:2 + "|" + ARGS:3 + "|" + ARGS:4 + "|" + ARGS:5 + "|" + ARGS:6 + "|" + ARGS:7 + "|" + ARGS:8 + "|" + ARGS:9 + ")($|:)")

;--------------------------------------------------------
;Pluralizer for NOUNS (pronouns can now be handled in their normal HIS_HER() type functions, see _FUNCTION.ERB for details)
;should cover most irregular nouns that might be used
;removes "a " and "An " from the beginning of nouns
;pluralizes them if ARG:0 > 1
;I'm not going to bother with words ending in O, because most of those are spanish and italian and don't require a rule... unless we're going to start talking about potatoes a lot.
;--------------------------------------------------------
@PLNOUN(ARGS:0, ARG:0, ARG:1)
#FUNCTIONS

;try to affect only last word if sentence is passed
LOCALS =
IF STRLENS(SPLIT_SINGLE(ARGS:0, STRCOUNT(ARGS:0, " "), " "))
	FOR LOCAL, 0, STRCOUNT(ARGS:0, " ")
		LOCALS = %LOCALS + \@ STRLENS(LOCALS) ? %" "%#\@%%SPLIT_SINGLE(ARGS:0, LOCAL, " ")%
	NEXT
	ARGS:0 = %SPLIT_SINGLE(ARGS:0, STRCOUNT(ARGS:0, " "), " ")%
ENDIF

IF ARG:0 > 1
	ARG:1 = IS_CAPITALIZED(ARGS:0)
	ARGS:0 = %TOLOWER(ARGS:0)%
	;remove "a " and "an " at the beginning
	ARGS:0 = %REPLACE(ARGS:0, "^(?:a|an)\s", "")%
	SELECTCASE ARGS:0
	CASE "child"
		ARGS:0 = children
	CASE "foot"
		ARGS:0 = feet
	CASE "it"
		ARGS:0 = them
	CASE "man"
		ARGS:0 = men
	CASE "ovum"
		ARGS:0= ova
	CASE "person"
		ARGS:0 = people
	CASE "that"
		ARGS:0 = those
	CASE "this"
		ARGS:0 = these
	CASE "tooth"
		ARGS:0 = teeth
	CASE "woman"
		ARGS:0 = women
	CASE "themself"
		ARGS:0 = themselves
	CASE "tomato"
		ARGS:0 = tomatoes
	CASEELSE
		IF !WORD_ENDS_IN(ARGS:0, "kai", "ngu", "ami", "ama", "ppa", "jaku") ;many of these Japanese words don't have plural forms
			IF WORD_ENDS_IN(ARGS:0, "[^aeiou]y") ;if last letter is "y" not preceded by a vowel, drop it and add "ies"
				ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+[^aeiou])y(?=\s|$)", "$1ies")%
			ELSEIF WORD_ENDS_IN(ARGS:0, "[^f]f", "fe") ;if last letter is single "f" or "fe", replace with "ves"
				ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+)(?:fe|f)(?=\s|$)", "$1ves")%
			ELSEIF WORD_ENDS_IN(ARGS:0, "x", "s", "ch", "sh") ;if word ends in "x", "s", "ss" "sh", or "ch" add "es"
				ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+)(?=\s|$)", "$1es")%
			ELSE
				ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+)(?=\s|$)", "$1s")%
			ENDIF
		ENDIF
	ENDSELECT
	SIF ARG:1
		ARGS:0 = %CAPITALIZE(ARGS:0)%
ENDIF

SIF STRLENS(LOCALS)
	ARGS:0 = %LOCALS% %ARGS:0%

RETURNF ARGS:0

;--------------------------------------------------------
;Pluralizer for VERBS (present tense)
;If ARG:0 > 1 pluralizes first word(verb) in ARGS:0, otherwise returns
;This function (and others) modified to only change first word, strings such as "lift up" -> "lifts up" or "carry over" -> "carries over" are acceptable
;--------------------------------------------------------
@PLVERB(ARGS:0, ARG:0)
#FUNCTIONS
	
IF ARG:0 > 1
	SELECTCASE ARGS:0 ;"be" is very irregular
	CASE "is", "are", "be"
		ARGS:0 = are
	CASE "Is", "Are", "Be"
		ARGS:0 = Are
	CASE "was", "were"
		ARGS:0 = were
	CASE "Was", "Were"
		ARGS:0 = Were
	CASE "has", "have"
		ARGS:0 = have
	CASE "Has", "Have"
		ARGS:0 = Have
	CASEELSE
		IF WORD_ENDS_IN(ARGS:0, "(?:ss|x|sh|ch|o)es") ;drop "es", ★Added o for does
			ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+(?:ss|x|sh|ch|o))es(?=\s|$)", "$1")%
		ELSEIF WORD_ENDS_IN(ARGS:0, "ies") ;replace "ies" with "y"
			ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+)ies(?=\s|$)", "$1y")%
		ELSE ;drop "s"
			ARGS:0 = %REPLACE(ARGS:0, "(^[^\s]+)s(?=\s|$)", "$1")%
		ENDIF
	ENDSELECT
ENDIF

RETURNF ARGS:0

@CAPITALIZE(ARGS:0)
#FUNCTIONS
RETURNF TOUPPER(SUBSTRING(ARGS:0, 0, 1)) + SUBSTRING(ARGS:0, 1, -1)

;when you need to only uncap the first letter of the sentence and leave the rest
@UNCAPITALIZE(ARGS:0)
#FUNCTIONS
RETURNF TOLOWER(SUBSTRING(ARGS:0, 0, 1)) + SUBSTRING(ARGS:0, 1, -1)

@RAND_CAP(ARGS)
#FUNCTIONS
LOCALS =
LOCAL:0 = RAND:2

FOR LOCAL:1, 0, STRLENS(ARGS)
	IF RAND:3 < LOCAL:0
		LOCALS += @"%TOUPPER(SUBSTRING(ARGS, LOCAL:1, 1))%"
		LOCAL:0 -= 1
	ELSE
		LOCALS += @"%TOLOWER(SUBSTRING(ARGS, LOCAL:1, 1))%"
		LOCAL:0 += 1
	ENDIF
NEXT
RETURNF LOCALS

@CAP_WORD(ARGS)
#FUNCTIONS
LOCALS '= ARGS

LOCALS:1 =
FOR LOCAL, 0, STRCOUNT(LOCALS, " ") + 1
	LOCALS:1 = %CAPITALIZE(LOCALS:1) + \@ STRLENS(LOCALS:1) ? %" "%#\@%%CAPITALIZE(SPLIT_SINGLE(LOCALS, LOCAL, " "))%
NEXT
LOCALS '= LOCALS:1
LOCALS:1 =
FOR LOCAL, 0, STRCOUNT(LOCALS, "-") + 1
	LOCALS:1 = %CAPITALIZE(LOCALS:1) + \@ STRLENS(LOCALS:1) ? %"-"%#\@%%CAPITALIZE(SPLIT_SINGLE(LOCALS, LOCAL, "-"))%
NEXT
LOCALS '= LOCALS:1

RETURNF LOCALS

;-------------------------------------------------
;handle capitalization
;-------------------------------------------------
@CAP_PROCESS(ARGS, ARG)
#FUNCTIONS
SELECTCASE ARG
	CASE 1
		RETURNF TOLOWER(ARGS)
	CASE 2
		RETURNF TOUPPER(ARGS)
	CASE 3
		RETURNF CAPITALIZE(ARGS)
	;random capitalization, courtesy of grammar anon
	CASE 4
		RETURNF RAND_CAP(ARGS)
	;capitalize every word with some limitations
	CASE 5
		RETURNF CAP_WORD(ARGS)
CASEELSE
	RETURNF ARGS
ENDSELECT

;-------------------------------------------------
;return capitalized if received string is capitalized
;-------------------------------------------------
@RETURN_CAP(ARGS, LOCALS)
#FUNCTIONS
RETURNF IS_CAPITALIZED(ARGS:0) ? CAPITALIZE(LOCALS) # LOCALS

@IS_CAPITALIZED(ARGS:0)
#FUNCTION
IF STRCOUNT(ARGS:0,"^[A-Z]")
	RETURNF 1
ELSE
	RETURNF 0
ENDIF


;--------------------------------------------------------
;simply continue last letter of the word
;use ARG to set the size, 0 - random, -1 - disable slur, -2 - slur the vowels, -3 slur last vowel
;--------------------------------------------------------
@SLUR(ARGS, ARG)
#FUNCTIONS
#DIM nRand
ARGS:0 '= SPLIT_G(ARGS:0, ":")
nRand = RAND(2, 6)

SIF ARG == -1 ;multiply none
	RETURNF ARGS
SIF ARG == -2 ;multiply every vowel
	RETURNF replace(ARGS,"(?i)([aeiouy])?", "$1"*nRand)
SIF ARG == -3 ;multiply only last vowel with negative lookahead
	RETURNF replace(ARGS,"(?i)([aeiouy])(?!.*[aeiouy])", "$1"*nRand)
SIF ARG == -4 ;multiply only first vowel
	RETURNF replace(ARGS,"^(.*?)([aeiouy])", "$1" + "$2"*nRand)
;multiply any last character
RETURNF ARGS + SUBSTRING(ARGS, STRLENS(ARGS)-1, -1) * ( ARG > 0 ? ARG # nRand )

;--------------------------------------------------------
;simple stutter
;three types of stutter (actually more) - S-senpai; S...uh/um/erm...senpai; S(, /...)Senpai, we'll check the capitalization for the last type
;--------------------------------------------------------
@STUTTER(ARGS, ARGS:1 = "nospecial")
#FUNCTIONS
;additional adjustment for fucky things
;LOCAL determines at which letter the stuttering starts
IF STRING_STARTS_IN(ARGS, "I'm")
	IF STRLENS(ARGS) > 3
		LOCALS = I%SPLIT_G(", :...:-")%I'm%SUBSTRING(ARGS, 3, -1)%
	ELSE
		LOCALS = I%SPLIT_G(", :...:-")%I am
	ENDIF
	RETURNF LOCALS
ELSEIF STRING_STARTS_IN(ARGS, "I ") && STRLENS(ARGS) > 1
	RETURNF @"I%SPLIT_G(", :...:-")%I%SUBSTRING(ARGS, 1, -1)%"
ELSEIF STRING_STARTS_IN(ARGS, "I") && STRLENS(ARGS) == 1
	RETURNF @"I%SPLIT_G(", :...:-")%I"
ELSE
	LOCAL = RAND:2 + 1
ENDIF
		
LOCALS = %SUBSTRING(ARGS, 0, STRLENS(ARGS) >= 5 ? LOCAL # 1)%
VARSET LOCAL
IF !SPLIT_CHECK(ARGS:1, "nospecial") && (SPLIT_CHECK(ARGS:1, "special") || RAND:3)
	IF SPLIT_CHECK(ARGS:1, "shy") || (!RAND:3 && STRLENS(ARGS) >= 5 && !SPLIT_CHECK(ARGS:1, "noshy"))
		LOCALS = %LOCALS%...%SPLIT_G("uh:um:erm:er")%...
		LOCAL:1 ++
	ELSE
		LOCALS = %LOCALS%-
	ENDIF
	IF SPLIT_CHECK(ARGS:1, "ss") || (RAND:3 && !LOCAL:1 && !SPLIT_CHECK(ARGS:1, "noss")) ;super stutter
		LOCAL:2 = RAND:2 + 1
		SIF LOCAL:2 < LOCAL
			LOCAL:2 = LOCAL
		LOCALS = %LOCALS%%@"%SUBSTRING(ARGS, 0, STRLENS(ARGS) >= 5 ? LOCAL:2 # 1)%-"*(RAND:2+1)%
	ENDIF
		
	LOCALS = %LOCALS%%ARGS%
ELSE
	LOCALS = %LOCALS%%SPLIT_G(", :...")%%ARGS%
ENDIF
;RETURNF SUBSTRING(ARGS, 0, STRLENS(ARGS) >= 5 ? RAND:2 + 1 # 1) + ( RAND:3 ? (!RAND:3 && STRLENS(ARGS) >= 5 ? @"...%SPLIT_G("uh:um:erm:er")%..." # "-") + (RAND:3 ? (SUBSTRING(ARGS, 0, STRLENS(ARGS) >= 5 ? RAND:2 + 1 # 1) + "-")*(RAND:2+1) # "") + TOLOWER(ARGS) # SPLIT_G(", :...") + ( IS_CAPITALIZED(ARGS) ? CAPITALIZE(ARGS) # ARGS ) )

RETURNF LOCALS

;--------------------------------------------------------
;divide the word with a symbol
;ARGS:1 for the divider, - is by default
;if ARGS:1 is more than one symbol in length, the length of division will increase
;--------------------------------------------------------
@DIVIDER(ARGS, ARGS:1)
#FUNCTIONS
SIF ARGS:1 == ""
	ARGS:1 = -

FOR LOCAL, 0, STRLENS(ARGS)
	SIF STRLENS(ARGS) <= (1 + (STRLENS(ARGS:1) - 1)) + LOCAL * (2 * STRLENS(ARGS:1))
		BREAK
	ARGS = %SUBSTRING(ARGS, 0, (1 + (STRLENS(ARGS:1) - 1)) + LOCAL * (2 * STRLENS(ARGS:1)) )%%ARGS:1%%SUBSTRING(ARGS, (1 + (STRLENS(ARGS:1) - 1)) + LOCAL * (2 * STRLENS(ARGS:1)), -1)%
NEXT

RETURNF ARGS

;-------------------------------------------------
;Make a start of a section (non-button)
;-------------------------------------------------
@PRINTLINE, ARGS, ARGS:1 = "-"
PRINTFORML □ %ARGS:0% □%ARGS:1*(126-STRLENS(ARGS))%


@PALAM_NUM(ARG, ARG:1)
#FUNCTIONS
;999999を超えたらkMGTP
;Emueraではペタ程度（64ビット）まで扱えるとのこと
VARSET LOCALS
FOR LOCAL, 0, 5
	SIF ARG < 1000000
		BREAK
	SELECTCASE LOCAL
	CASE 0
		LOCALS = k
	CASE 1
		LOCALS = M
	CASE 2
		LOCALS = G
	CASE 3
		LOCALS = T
	CASE 4
		LOCALS = P
	ENDSELECT
	ARG /= 1000
NEXT
;数値の桁数に応じて間隔を調整
IF STRLENS(LOCALS)
	LOCALS = {ARG, ARG:1 ? 0 # 5}%LOCALS%
ELSE
	LOCALS = {ARG, ARG:1 ? 0 # 6}
ENDIF

RETURNF LOCALS


;-------------------------------------------------
;Counting numbers and positions
;this is pretty much copypaste from LT, thanks inno
;Only works for values -99,999 to 99,999
;args:
;num for simple int to string (3 - three, 14 - fourteen, 99 - ninety nine, etc)
;pos for positions (1 - first, 13 - thirteenth, 42 - forty second, etc)
;ARG:1 is the additional capitalization flag, 1 - capitalize only first word, 2 - capitalize every word
;-------------------------------------------------
@NUM_COUNT(ARG, ARGS = "num", ARG:1)
#FUNCTIONS

LOCALS =

IF ARG < 0
	LOCALS '= "minus "
ENDIF
ARG = ABS(ARG)
SIF ARG >= 100000
	RETURNF LOCALS + "a lot"

IF ARG >= 1000
	IF ARG/1000 < 20
		LOCALS += nCountUnderTwenty:(ARG/1000) + " thousand"
	ELSE
		LOCALS += nCountTens:(ARG/10000) + ( (ARG/1000)%10 != 0 ? "-" + nCountUnderTwenty:((ARG/1000)%10) # "") + " thousand"
	ENDIF
ENDIF

IF ARG >= 100 
	;IF ARG >= 1000 && ARG % 1000 != 0
	;	LOCALS += ", "
	;ENDIF
	IF ARG >= 1000 && ARG % 1000 != 0
		IF ARG*10%10000 % 1000 == 0
			LOCALS += " and "
		ELSEIF ARG*10%10000 > 1000
			LOCALS += ", "
		ENDIF
	ENDIF

	ARG = ARG % 1000
	IF ( !STRLENS(LOCALS) || ARG >= 100) 
		LOCALS += nCountUnderTwenty:(ARG/100) + " hundred"
	ENDIF
	IF ARG % 100 != 0
		LOCALS += " and "
		ARG = ARG % 100
	ENDIF
ENDIF

IF (ARG % 100) < 20
	IF (ARG%100 == 0)
		IF !STRLENS(LOCALS)
			RETURNF "zero"
		ENDIF
	ELSE
		LOCALS += (ARGS == "num" ? nCountUnderTwenty:(ARG%100) # nCountPosUnderTwenty:(ARG%100) )
	ENDIF
ELSE
	LOCALS += nCountTens:((ARG%100)/10) + ( (ARG%10!=0) ? "-"+(ARGS == "num" ? nCountUnderTwenty:(ARG%10) # nCountPosUnderTwenty:(ARG%10) )# "")
ENDIF

SELECTCASE ARG:1
	CASE 1
		LOCALS '= CAPITALIZE(LOCALS)
	CASE 2
		LOCALS:1 =
		FOR LOCAL, 0, STRCOUNT(LOCALS, " ") + 1
			LOCALS:1 = %CAPITALIZE(LOCALS:1) + \@ STRLENS(LOCALS:1) ? %" "%#\@%%CAPITALIZE(SPLIT_SINGLE(LOCALS, LOCAL, " "))%
		NEXT
		LOCALS '= LOCALS:1
		LOCALS:1 =
		FOR LOCAL, 0, STRCOUNT(LOCALS, "-") + 1
			LOCALS:1 = %CAPITALIZE(LOCALS:1) + \@ STRLENS(LOCALS:1) ? %"-"%#\@%%CAPITALIZE(SPLIT_SINGLE(LOCALS, LOCAL, "-"))%
		NEXT
		;lower.replace(/\b(\w)/g, c => c.toUpperCase());
		LOCALS '= LOCALS:1
ENDSELECT
		
RETURNF LOCALS

;--------------------------------------------------------
;pluralize the word if ARG is more than 1
;--------------------------------------------------------
@PLURALIZER(ARGS, ARG)
#FUNCTIONS
SIF ARG > 1 || ARG == 0
	ARGS = %PLNOUN(ARGS, 2)%
RETURNF ARGS

;same, but for outputting the value and the word at the same time
@PRINT_PLUR(ARGS, ARG)
#FUNCTIONS
RETURNF TOSTR(ARG) + " " + PLURALIZER(ARGS, ARG)

;--------------------------------------------------------
;a simple check for an article
;--------------------------------------------------------
@ARTICLE(ARGS:0)
#FUNCTIONS
;exceptions, add on demand
SIF STRCOUNT(ARGS:0,"(?i)^uni|^usa|^one")
	RETURNF "a " + ARGS:0

IF STRCOUNT(ARGS:0,"(?i)^[aeiouy]")
	ARGS:0 = %"an " + ARGS:0%
ELSE
	ARGS:0 = %"a " + ARGS:0%
ENDIF
RETURNF ARGS:0

;--------------------------------------------------------
;debug function that tries to make your current target most likely to push you down
;--------------------------------------------------------
@FUCKME()
#FUNCTION
CALLF PUSHME()
CALLF WETME(TARGET)
CALLF WETME(MASTER)
;CALLF IKISOU()

@PUSHME(ARG = -1)
#FUNCTION
SIF ARG == -1
	ARG = TARGET
BASE:ARG:ムード = MAXBASE:ARG:ムード
BASE:ARG:理性 = 0
CFLAG:ARG:合意判定 = 1000
CFLAG:ARG:溜まってる度 = 1000
TCVAR:ARG:欲求不満度管理 = 0
CFLAG:ARG:ブチギレ = 0
TALENT:ARG:機嫌 = 0
PALAM:ARG:欲情 += 9999
TCVAR:ARG:媚薬 = 1
DEBUGPRINTFORML Ara-ara, fresh dicks!

@IKISOU(ARG = -1)
#FUNCTION
SIF ARG == -1
	ARG = MASTER
BASE:ARG:射精 = MAXBASE:ARG:射精
TCVAR:ARG:イきそう = 1
DEBUGPRINTFORML Kimochiiiiiiiiiiiiii

@MILKME(ARG = -1)
#FUNCTION
SIF ARG == -1
	ARG = MASTER
TALENT:ARG:母乳体質 = !TALENT:ARG:母乳体質
MAXBASE:ARG:母乳 = 10000
BASE:ARG:母乳 = 0
DEBUGPRINTFORML MILKY MILKY WARM AND TASTY! MOMMY! MILKY! PLEASE BE HASTY!

@HERMME(ARG = -1)
#FUNCTION
SIF ARG == -1
	ARG = MASTER
TALENT:ARG:性別 = 3
MAXBASE:ARG:射精 = 10000
MAXBASE:ARG:精力 = 1000
MAXBASE:ARG:勃起 = 1500
SIF BASE:ARG:精力 > 1000
	BASE:ARG:精力 = 1000
DEBUGPRINTFORML Haha feminine penis goes spurt spurt

@VIRGINME(ARG = -1)
#FUNCTION
SIF ARG == -1
	ARG = MASTER
TALENT:ARG:処女 = !TALENT:ARG:処女

@DOUTEIME(ARG = -1)
#FUNCTION
SIF ARG == -1
	ARG = MASTER
TALENT:ARG:非童貞 = !TALENT:ARG:非童貞

@WETME(ARG = -1)
#FUNCTION
SIF ARG == -1
	ARG = TARGET
PALAM:ARG:欲情 = PALAMLV:5
PALAM:ARG:潤滑 = PALAMLV:5

@HESOYAM(ARG = -1)
#FUNCTION
IF ARG == -1
	FOR LOCAL, 0, CHARANUM
		BASE:LOCAL:体力 = MAXBASE:LOCAL:体力
		BASE:LOCAL:気力 = MAXBASE:LOCAL:気力
		BASE:LOCAL:精力 = MAXBASE:LOCAL:精力
	NEXT
ELSE
	BASE:ARG:体力 = MAXBASE:ARG:体力
	BASE:ARG:気力 = MAXBASE:ARG:気力
	BASE:ARG:精力 = MAXBASE:ARG:精力
ENDIF

@CALMME(ARG = -1)
#FUNCTION
SIF ARG == -1
	ARG = TARGET
MARK:ARG:反発刻印 = 0
MARK:ARG:反発取得履歴 = 0
CFLAG:ARG:ブチギレ = 0
BASE:ARG:怒り = 0
TALENT:ARG:機嫌 = 0
CFLAG:ARG:不機嫌 = 0

@FALLFORME(ARG = -1)
#FUNCTION
SIF ARG == -1
	ARG = TARGET
ABL:ARG:親密 = 10
ABL:ARG:従順 = 10
ABL:ARG:欲望 = 10
CFLAG:ARG:好感度 = 100000
CFLAG:ARG:信頼度 = 100000
EXP:ARG:愛情経験 = 1000
TALENT:ARG:恋慕 = 1
CALLF CALMME(ARG)

@TP(ARG)
#FUNCTION
CFLAG:ARG:現在位置 = CFLAG:MASTER:現在位置
TIME:5 = 0

@WEAKME(ARG = -1)
#FUNCTION
SIF ARG == -1
	ARG = MASTER
BASE:ARG:体力 = 600
BASE:ARG:気力 = 100
BASE:ARG:精力 = 100
BASE:ARG:TSP = 100

@SETBOB(ARG = -999, ARG:1 = -1)
#FUNCTIONS
SIF ARG:1 == -1
	ARG:1 = TARGET
SIF ARG == -999
	RETURNF @"Current bob for %CALLNAME:(ARG:1)%: TALENT:バストサイズ - {TALENT:(ARG:1):バストサイズ} (%GET_TALENTNAME_TR(105, TALENT:(ARG:1):バストサイズ, ARG:1)%)"
TALENT:(ARG:1):バストサイズ = ARG
RETURNF @"TALENT:バストサイズ: Bob set for %CALLNAME:(ARG:1)% to {TALENT:(ARG:1):バストサイズ} (%GET_TALENTNAME_TR(105, TALENT:(ARG:1):バストサイズ, ARG:1)%)"

@TWENTY_FOUR_TIME(ARG)
#FUNCTIONS
#DIMS HOURS
#DIMS MINUTES
HOURS '= @"{ARG / 60}"
SIF ARG / 60 < 10
	HOURS '= @"0%HOURS%"
MINUTES '= @"{ARG % 60}"
IF ARG % 60 == 0
	MINUTES = 00
ELSEIF ARG % 60 < 10
	MINUTES '= @"0%MINUTES%"
ENDIF
RETURNF @"%HOURS%:%MINUTES%"

@PRINT_ITEM_DESC(ARG)
SIF !STRLENS(MAIL_ORDER_DESCRIPTION(ARG))
	RETURN
PRINTL
DRAWLINE
PRINTFORML %ITEMNAME_TR(ARG)% - 
PRINTFORML %MAIL_ORDER_DESCRIPTION(ARG)%
DRAWLINE

@MAIL_ORDER_DESCRIPTION(ARG)
#FUNCTIONS
SELECTCASE ARG
	CASE 0
		RETURNF BREAKENG("A compact egg shaped vibrator perfect for livening up any hot and steamy situation.")
	CASE 1
		RETURNF BREAKENG("Powerful vibrating massager absolutely guaranteed to get even the iciest lady screaming for more.")
	CASE 2
		RETURNF BREAKENG("It's a Clit Cap."	)
	CASE 3
		RETURNF BREAKENG("A deluxe molded onahole for those times whether you're alone or about to receive a helping hand from a willing partner.")
	CASE 4
		RETURNF BREAKENG("For when a hot meaty rod isn't close by or you're tired of being jackhammered, try the vibrator with its sleek long rod and excellent vibrating function to push you deeper into unknown pleasures.")
	CASE 5
		RETURNF BREAKENG("She'll disapprove entry of her forbidden hole until she starts begging for more as the anal vibrator works its magic.")
	CASE 6
		RETURNF BREAKENG("Tired of being blackmailed into wearing this stupid thing up your ass all day? Want to get revenge? Well, now you can!")
	CASE 10
		RETURNF BREAKENG("It's a nipple cap.")
	CASE 11
		RETURNF BREAKENG("For when two hands aren't enough, this industrial graded milker with certified food grade tubings will handle all the milking job whether it's a mare or a leaking lady.")
	CASE 12
		RETURNF BREAKENG("God made man, this latex infused strapon made woman equal." )
	CASE 15
		RETURNF BREAKENG("Nothing quites bring out the sensation of danger from having your sights robbed from you, or from the sensuality of not knowing what comes next during those special 'intimate' moments.")
	CASE 16
		RETURNF BREAKENG("A length of fiber Rope, for when you need to climb a hill, tie the ship down, or bring a tough cowgirl down to submission.")
	CASE 20
		RETURNF BREAKENG("Fun for the whole family! Even parents can join in with the kids in this set of playmat so popular we had to re-issue it again!"  )
	CASE 23
		RETURNF BREAKENG("A must-have in any respectable kitchen to cover up those grease marks. Now made out of a brand new fabric to resist any and all stains. It's even machine washable!")
	CASE 27
		RETURNF BREAKENG("A list of all the methods in order to catch any prey with a 4 legs. Includes a special pamphlet on how to capture prey on 2 legs as well. Allows you to use [Restrain Mode] and have your way with girls with attitude!")
	CASE 30
		RETURNF BREAKENG("Want a piano but it's too expensive? Looking for something more modern? Look no further! Buy the latest electronic keyboard from R◯land!")
	CASE 31
		RETURNF BREAKENG("You must be MAD aspiring to reach the likes of Chopin, Mozart, or other great pianist throughout times, but that is exactly what our piano made from carved ivory tusk, finely sourced mahogany wood and worked by the finest craftsman will allow you to do.")
	CASE 32
		RETURNF BREAKENG("Don't let out that fiery guitar spirit dwelling within you be snuff out and forgotten. Nurture it and let it burn bright with these exclusive guitars. Order now and get a free customed theme skins for your new guitar.")
	CASE 33
		RETURNF BREAKENG("Deceptively simple, impressively hard to master. Such is the trumpet that had seen itself through wars across to guide dead men charging towards the enemy.")
	CASE 34
		RETURNF	BREAKENG("Eclipsed by the cruder guitar, the violin is a gentleman's tool of choice. Through dedication and time transforms the raspings of the strings into a fine melody that had been recorded in all ages of the civilized world.")
	CASE 35
		RETURNF BREAKENG("Keeps your food and drink whether at warm or cold till you're ready to indulge on it.")
	CASE 36
		RETURNF BREAKENG("A quaint little folding umbrella with a robust spring mechanism that ensures that when rain comes, you made the smart choice in investing with our sure-open patented umbrellas.")
	CASE 37
		RETURNF BREAKENG("Slay even the most vicious of lake gods with our ever popular steel reinforced fishing rod that bear even the heaviest of fish. No more snagged lines nor snapped frames to ever haunt your fishing game anymore.")
	CASE 38
		RETURNF BREAKENG("Beat the heat or just splash about with our inflatable pool weaved with puncture proof kevlar skin layer. Bring out the fun anywhere no matter the season!")
	CASE 39
		RETURNF BREAKENG("It's a mixer.")
	CASE 40
		RETURNF BREAKENG("Organic non-toxic and non-corrosive lotion to smooth up the process giving more focus on the actual playtime. Now without the coconut smell.")
	CASE 41		
		RETURNF BREAKENG("From the jungles of the far east shrouded in ancient secrecy comes this bottled miracle. With the biting extract of a tiger's fang and the sweet nectar of ambrosia, this esoteric solution will arouse the carnal beast lurking beneath the sensibility of all mortal beings.")
	CASE 42		
		RETURNF BREAKENG("Having trouble getting little johnny to squeeze out those peepee even though you gotta go now?! Well the solution for your issue is right here! Medically approved, loved by millions, and enjoyed for its other side effects, the inexpensive diuretic medication guaranteed [or your money back] to solve all your water closet issues.")
	CASE 45
		RETURNF BREAKENG("Super thin condom to give that extra oomph while having some intimate time together.")
	CASE 47
		RETURNF BREAKENG("Polished premium white rice. Perfect for making a quick light snack or for your daily meal.")
	CASE 48
		RETURNF BREAKENG("A variety of cereal for cooking purposes.")
	CASE 49
		RETURNF BREAKENG("Birth control pills to be taken before sexual intercourse.")
	CASE 50
		RETURNF BREAKENG("Husky old rice. Their value lies in the prices but they still retain nutrient for your daily requirement.")
	CASE 51
		RETURNF BREAKENG("Unrefined sake for the unrefined tastebud. While cheap they're barely enough to get that signature buzz from better quality sake.")
	CASE 52
		RETURNF BREAKENG("Your average sake that comes in a glass bottle. Great for parties and be sure to make a merry mood a merriment.")
	CASE 53
		RETURNF BREAKENG("Not for the average drinker. This sake had been refined and aged till it has larger concentration of alcohol. Perfect for those who can no longer relax from the regular sake.")
	CASE 56
		RETURNF BREAKENG("Sweetened Sake for those who prefer their sake sweetened.")
	CASE 61	
		RETURNF BREAKENG("With this PATENTED EZY-KNOW-ALL system you too can be a chemist! Know just the right proportion of chemicals to dump into your drink for that relaxing au latte with painkillers that's all the rage!")
	CASE 62		
		RETURNF BREAKENG("A set of leathery old tome that that will immediately latches onto the the nearest person and bestow upon them ancient forbidden knowledge from beyond this world. *Warning: Tome are bound in lamb skin.")
	CASE 63
		RETURNF BREAKENG("Worried about not being in good in bed? Now you can just pay your way through virgin-hood as our highly trained  [And tested] trainer will guide you through the whole she-bang. Requires appointment. ")
	CASE 64	
		RETURNF BREAKENG("Too good in bed? Want to feel what it's like being a virgin boy all over again? Say no more, for a nominal fee we'll send highly trained thugs to hit you in just the right spot to make forget all there is about sex.")
	CASE 65
		RETURNF BREAKENG("Pissed someone off? Think there is no longer any hope for you to chase after the lady of your dreams now that she won't even talk to you? Why we ALSO have a solution to that. Our temporal dimension specialist will replace her with an exact copy of your current infatuation sans some of the hate. Repeated application required for especially terrible deeds.")
	CASE 66
		RETURNF BREAKENG("Live in a literal pigsty or you just can't stand the smell of rotten fish while you go down on your favorite fishing hole? Look no further because we got your back. A DIY spray kit directly up to the nasal cavity will numb the nose and lets you forget there was ever any smell to begin with.")
	CASE 67
		RETURNF BREAKENG("Having all your senses numbed to the point of no return? We had already returned the joy of smelling to many others and soon even YOU with this simple sleeping pill. Upon ingestion and subsequent sleep our team of surgeon trained in the art of burglary will replace your old nose with a new one!")
	CASE 71
		RETURNF BREAKENG("Be not the only man in the house with our F.U.T.A Medicine. Grow a perfectly average yet adequate penis and show who's the real boss around these parts.")
	CASE 72
		RETURNF BREAKENG("Wish you weren't packing a pecker? Is a single dick too many dicks to you? Well for those ladies that pack something special out there your woes are no longer. Our single use kit will remove all traces of any penis without leaving a trace nor mark so you can be the woman you always wanted to be.")
	CASE 74
		RETURNF BREAKENG("Hardboiled Candy with red artificial coloring additive sweetened with sucrose. Upon ingestion the user will regain their hymen layer without additional side effect.")
	CASE 77
		RETURNF BREAKENG("Instruction: To be consumed with a glass of water. Effect: Induces the growth and mutation of the ear resulting in the characterisation of that like an animal ears of varied animal family. Side Effect: May induce at times sudden arousal cycle in conjunction with the species's usual mating time.")
	CASE 78
		RETURNF BREAKENG("Atrophies the secondary ear of animal-like trait.")
	CASE 94
		RETURNF BREAKENG("A ready present wrapped in a red box and decorated with a red bow string. Spread the festive season this Christmas.")
	CASE 95
		RETURNF BREAKENG("An excellent gift to present to someone in the event that you had slighted them in some way.")
	CASE 101
		RETURNF BREAKENG("Adapted and distilled from martial arts style across the world, this guidebook had been foolproofed and following its easy instruction will allow you to increase your combative capability.")
	CASE 102
		RETURNF BREAKENG("Comes in either beginner, intermediate or advanced series, these sets of cookbook will allow you to create marvels of culinary out of the most basic ingredients to impress or eat.")
	CASE 103
		RETURNF BREAKENG("A plain new dictionary, perfect for those moments of studying.")
	CASE 104
		RETURNF BREAKENG("A new novel from a random grab of multiple author, all who are highly praised for their prose.")
	CASE 105
		RETURNF BREAKENG("A picture story show for aiding in reading in general by providing visual cues.")
	CASE 120
		RETURNF BREAKENG("An ultra rare chocolate that is made from coco beans roasted by the perfect power of lighting then collected into this one single premium bar.")
	CASE 121
		RETURNF BREAKENG("A chocolatey snack great for on the go.")
	CASE 122
		RETURNF BREAKENG("Premium quality chocolate made from the finest chocolate beans and high grade milk that is a cut above the rest.")
	CASE 123
		RETURNF BREAKENG("Show your affection to your beloved by presenting this delicately made chocolate to them. Express delivery for those once in a lifetime moment.")
	CASE 130
		RETURNF BREAKENG("A lucky rabbit sign that gives its wearer luck.")
	CASE 131 
		RETURNF BREAKENG("A miraculous Moriya Shrine raffle ticket.")
	CASE 150
		RETURNF BREAKENG("A set of gardening equipment to kickstart your gardening career.")
	CASE 151
		RETURNF BREAKENG("It's a packet cabbage seeds.")
	CASE 152
		RETURNF BREAKENG("It's a packet strawberry seeds.")
	CASE 153
		RETURNF BREAKENG("It's a packet of turnip seeds.")
	CASE 162
		RETURNF BREAKENG("It's a packet of cucumber seeds.")
	CASE 163
		RETURNF BREAKENG("It's a packet of Tomato seeds.")
	CASE 164
		RETURNF BREAKENG("It's a packet of Watermelon seeds.")
	CASE 175
		RETURNF BREAKENG("It's a packet of eggplant seeds.")
	CASE 176
		RETURNF BREAKENG("It's a packet of Sweet Potato seeds.")
	CASE 177
		RETURNF BREAKENG("It's a packet of grape seeds.")
	CASE 187
		RETURNF BREAKENG("It's a packet of Lily seeds.")
	CASE 188
		RETURNF BREAKENG("It's a packet of Carrot seeds.")
	CASE 189
		RETURNF BREAKENG("It's a packet of Green Onions seeds.")
	CASE 190
		RETURNF BREAKENG("A packet of Rotor seeds, when electricity is applied it will vibrate like what a normal rotor would.")
	CASE 212
		RETURNF BREAKENG("Specially packaged rice cake for easy consumption. Has slightly sweet flavor to go with its stickiness.")
	CASE 213
		RETURNF BREAKENG("Ice-cold Ice Cream to cool your body down during a particularly hot day or to enjoy as is as a snack.")
	CASE 214
		RETURNF BREAKENG("A bundle of homework. Doing this entire bundle will be sure to give a boost to your intelligence.")
	CASE 215
		RETURNF BREAKENG("Black Tea in a can with pull tab heater so you can enjoy a refreshing coffee no matter the time or place.")
	CASE 250
		RETURNF BREAKENG("A potion brewed by witches to make the make the drinker fall in love with the nearest person they see.")
	CASE 251
		RETURNF BREAKENG("A refreshing sports drink with electrolyte to restore the body's energy.")
	CASE 351
		RETURNF BREAKENG("A perfectly healthy and round cabbage.")
	CASE 352
		RETURNF BREAKENG("Somewhat tart strawberry perfect for making tart.")
	CASE 353
		RETURNF BREAKENG("Long white turnip.")
	CASE 362
		RETURNF BREAKENG("Green cucumber, absolutely shining.")
	CASE 363
		RETURNF BREAKENG("Bright red Tomato, plump yet delicious.")
	CASE 375
		RETURNF BREAKENG("Purple Eggplant.")
	CASE 376
		RETURNF BREAKENG("Unlike normal potato, this one is SWEET.")
	CASE 377
		RETURNF BREAKENG("A bunch of grape. They aren't seedless however.")
	CASE 389
		RETURNF BREAKENG("Tear inducing green onions.")
	CASE 399
		RETURNF BREAKENG("A gift from a certain Lady.")
	CASE 400
		RETURNF BREAKENG("Opens a direct portal between your pocket and your dresser for immediate and safe stashing of underwear.")
	CASE 401
		RETURNF BREAKENG("Prevent interruption during those intimate moments of having someone walk in by using this instant barrier.")
	CASE 500
		RETURNF BREAKENG("A healthy green juice to restore your energy.")
	CASE 501
		RETURNF BREAKENG("An energy drink for a quick pick-me-up while on the go.")
	CASE 502
		RETURNF BREAKENG("Restores your vigour with Vigora drink.")
	CASE 503
		RETURNF BREAKENG("A step above the rest in the saturated energy drink market, the highly acclaimed Gin Gin Ｚ refreshes the drinker like no other drink.")
	CASE 507
		RETURNF BREAKENG("A potion to ease the body and restore energy.")
	CASE 508
		RETURNF BREAKENG("A potent potion that works by directly giving mana into the body of the drinker.")
	CASE 510
		RETURNF BREAKENG("A turmeric drink, said to enhance the body's vitality.")
	CASE 520
		RETURNF BREAKENG("Bandage wounds, turning oppais into pettanko, covering up scars, there is nothing the humble bandage can't do.")
	CASE 530		
		RETURNF	BREAKENG("The Stone of Mirada. A rare item that is said that someone who wields it using an unknown power will cause a person's love to deepen till they only surrender themselves to the wielder of The Stone of Midara... NOW WITH 1-DAY SHIPPING.")
	CASE 600
		RETURNF BREAKENG("An ordinary mushroom, delicious when grilled.")
	CASE 601
		RETURNF BREAKENG("A POISONOUS mushroom with a distinct flavor favored by death seeking gourmand.")
	CASE 605
		RETURNF BREAKENG("A mushroom that exudes magical energy.")
	CASE 606
		RETURNF BREAKENG("A singular claw from a dragon.")
	CASE 607
		RETURNF BREAKENG("Medicinal herbs to help with any sickness.")
	CASE 610	
		RETURNF BREAKENG("A chopped block of wood.")
	CASE 700 
		RETURNF BREAKENG("When fried or cooked through other methods, it taste like chicken.")
	CASE 701
		RETURNF BREAKENG("A delicious meat however due to its low status it is not as well known as the chicken.")
	CASE 702
		RETURNF BREAKENG("Simply a domesticated boar.")
	CASE 703
		RETURNF BREAKENG("The original pig that still remembers its roots.")
	CASE 704
		RETURNF BREAKENG("A person who seeks beef, may find it within the beef.")
	CASE 705
		RETURNF BREAKENG("A meat from an unknown animal.")
	CASE 706
		RETURNF BREAKENG("Frog meat, ala French.")
	CASE 707
		RETURNF BREAKENG("Fish meat, fresh or cured but great for everything except porridge.")
	CASE 800
		RETURNF BREAKENG("The perfect garment that embodies everything that is about servant-hood. A mark of slavery yet also a mark of freeman serving of their own freewill under a master. Always obedient yet expected to rebel when it comes to harm of their master. Quiet and unassuming, beneath the face of a million yet a single mass of shared destiny. This is the maid uniform.")
	CASE 802
		RETURNF BREAKENG("A nurse uniform to get you back into full health.")
	CASE 802
		RETURNF BREAKENG("A santa uniform. Wearing it alone is enough of a gift.")
ENDSELECT

@COUNT_CORRECT(ARG = 0, ARG:1 = 0, ARG:2 = 0, ARG:3 = 0, ARG:4 = 0, ARG:5 = 0, ARG:6 = 0)
#FUNCTION
LOCAL = 0
FOR LOCAL:1, 0, 7
	SIF ARG:(LOCAL:1)
		LOCAL ++
NEXT
RETURNF LOCAL

;Makes it easier to make run-on sentences
@ENGLISH_GRAMMAR_BUILDING(WHO, MODE = 0, ARGS, ARG, ARGS:1, ARG:1, ARGS:2 = "", ARG:2, ARGS:3 = "", ARG:3,ARGS:4 ="", ARG:4,ARGS:5 ="", ARG:5,ARGS:6 ="", ARG:6)
#DIM WHO
#DIM MODE
#DIMS CONNECTOR


SIF ARG
	PRINTFORM %ARGS%
SIF ARG && COUNT_CORRECT(ARG:1, ARG:2, ARG:3, ARG:4, ARG:5, ARG:6) == 1
	PRINTFORM  and 
SIF ARG && COUNT_CORRECT(ARG:1, ARG:2, ARG:3, ARG:4, ARG:5, ARG:6) > 1
	PRINTFORM , 

SIF ARG:1
	PRINTFORM %ARGS:1%
IF ARG:1 && COUNT_CORRECT(ARG) == 1 && COUNT_CORRECT(ARG:2, ARG:3, ARG:4, ARG:5, ARG:6) == 1
	PRINTFORM , and 
ELSEIF ARG:1 && COUNT_CORRECT(ARG:2, ARG:3, ARG:4, ARG:5, ARG:6) == 1
	PRINTFORM  and 
ELSEIF ARG:1 && COUNT_CORRECT(ARG:2, ARG:3, ARG:4, ARG:5, ARG:6) > 1
	PRINTFORM , 
ENDIF

SIF ARG:2
	PRINTFORM %ARGS:2%
IF ARG:2 && COUNT_CORRECT(ARG, ARG:1) && COUNT_CORRECT(ARG:3, ARG:4, ARG:5, ARG:6) == 1
	PRINTFORM , and 
ELSEIF ARG:2 && COUNT_CORRECT(ARG:3, ARG:4, ARG:5, ARG:6) == 1
	PRINTFORM  and 
ELSEIF ARG:2 && COUNT_CORRECT(ARG:3, ARG:4, ARG:5, ARG:6) > 1
	PRINTFORM , 
ENDIF

SIF ARG:3
	PRINTFORM %ARGS:3%
IF ARG:3 && COUNT_CORRECT(ARG, ARG:1, ARG:2) && COUNT_CORRECT(ARG:4, ARG:5, ARG:6) == 1
	PRINTFORM , and 
ELSEIF ARG:3 && COUNT_CORRECT(ARG:4, ARG:5, ARG:6) == 1
	PRINTFORM  and 
ELSEIF ARG:3 && COUNT_CORRECT(ARG:4, ARG:5, ARG:6) > 1
	PRINTFORM , 
ENDIF

SIF ARG:4
	PRINTFORM %ARGS:4%
IF ARG:4 && COUNT_CORRECT(ARG, ARG:1, ARG:2, ARG:3) && COUNT_CORRECT(ARG:5, ARG:6) == 1
	PRINTFORM , and 
ELSEIF ARG:4 && COUNT_CORRECT(ARG:5, ARG:6) == 1
	PRINTFORM  and 
ELSEIF ARG:4 && COUNT_CORRECT(ARG:5, ARG:6) > 1
	PRINTFORM , 
ENDIF

SIF ARG:5
	PRINTFORM %ARGS:5%
IF ARG:5 && COUNT_CORRECT(ARG, ARG:1, ARG:2, ARG:3) && COUNT_CORRECT( ARG:6) == 1
	PRINTFORM , and 
ELSEIF ARG:5 && COUNT_CORRECT( ARG:6) == 1
	PRINTFORM  and 
ENDIF

SIF ARG:6
	PRINTFORM %ARGS:6%

;----------------------------------------------------------------------
;Create a list in a string, e.g: "X, Y and Z"
;Pass a string with the list here and it will do it for you
;Stuff in string should be listed with comma like %", "%
;Modded to it uses full-width commas, i.e. "、"
;----------------------------------------------------------------------
@LIST_IN_STRING(ARGS, strSplit = "、")
#FUNCTIONS
#DIMS strSplit
;add spaces
ARGS '= REPLACE(ARGS, strSplit, strSplit + " ")
;clear off the last part
ARGS '= REPLACE(ARGS, strSplit + " $", "")
;use negative lookahead to replace comma before the last item with "AND"
ARGS '= REPLACE(ARGS, "(" + strSplit + ")(?!.*" + strSplit + ")", " and")
;finally place commas in case splitter wasn't a comma
ARGS '= REPLACE(ARGS, strSplit, ",")

RETURNF ARGS

;-------------------------------------------------
;関数名:GET_DAY
;概　要:曜日を表す文字列を取得する関数
;引　数:引数がない場合DAY
;戻り値:曜日を表す文字列(日/月/火/水/木/金/土)
;備　考:文中関数
;-------------------------------------------------
@GET_DAY_TR(ARG)
#FUNCTIONS
#DIMS CONST YOUBI = "Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"
SIF !ARG
	ARG = DAY
RETURNF YOUBI:(ARG % 7)

;Children are not people
@HE_SHE_CHILD(ARG,ARG:1, CHILDNUM)
#FUNCTIONS
#DIM CHILDNUM
#DIMS OUTPUT
OUTPUT '= @"%CHILD_SEX:ARG:CHILDNUM == 1?"She"#"He"%"
SIF !ARG:1
	OUTPUT = %TOLOWER(OUTPUT)%
RETURNF OUTPUT

@HIM_HER_CHILD(ARG,ARG:1,CHILDNUM)
#FUNCTIONS
#DIM CHILDNUM
#DIMS OUTPUT
OUTPUT '= @"%CHILD_SEX:ARG:CHILDNUM == 1?"Her"#"Him"%"
SIF !ARG:1
	OUTPUT = %TOLOWER(OUTPUT)%
RETURNF OUTPUT

@HIS_HER_CHILD(ARG,ARG:1,CHILDNUM)
#FUNCTIONS
#DIM CHILDNUM
#DIMS OUTPUT
OUTPUT '= @"%CHILD_SEX:ARG:CHILDNUM == 1?"Her"#"His"%"
SIF !ARG:1
	OUTPUT = %TOLOWER(OUTPUT)%
RETURNF OUTPUT

@HIS_HERS_CHILD(ARG,ARG:1,CHILDNUM)
#FUNCTIONS
#DIM CHILDNUM
#DIMS OUTPUT
OUTPUT '= @"%CHILD_SEX:ARG:CHILDNUM == 1?"Hers"#"His"%"
SIF !ARG:1
	OUTPUT = %TOLOWER(OUTPUT)%
RETURNF OUTPUT

@HIMSELF_HERSELF_CHILD(ARG,ARG:1,CHILDNUM)
#FUNCTIONS
#DIM CHILDNUM
#DIMS OUTPUT
OUTPUT '= @"%CHILD_SEX:ARG:CHILDNUM == 1?"Her"#"His"%"
SIF !ARG:1
	OUTPUT = %TOLOWER(OUTPUT)%
RETURNF OUTPUT

@PAPA_MAMA(ARG,ARG:1)
#FUNCTIONS
#DIMS OUTPUT
OUTPUT '= @"%TALENT:ARG:性別 == 2?"Papa"#"Mama"%"
SIF !ARG:1
	OUTPUT = %TOLOWER(OUTPUT)%
RETURNF OUTPUT

@GET_WEATHER_TR
#FUNCTIONS
#DIMS 表示_異常気象,15
IF FLAG:異常気象
	SPLIT " /CSense/VSense/ASense/BSense/MSense/Skirts/Panties/Pink Wind/Typhoon/Blizzard", "/", 表示_異常気象
	RETURNF 表示_異常気象:(FLAG:異常気象)
ENDIF
SIF !STRLENS(LOCALS)
	SPLIT "Sunny/Fair/Overcast/Cloudy/Rain/Downpour/Drizzle/Foggy/Snowy/Snowstorm/Light Snowfall/Snow Grains/Sleet/Hail", "/", LOCALS
RETURNF LOCALS:(TIME:5)

@WEATHER_TR(ARGS)
#FUNCTIONS
VARSET LOCALS
SELECTCASE ARGS
	CASE "Ｃ敏感"
		LOCALS = CSense
	CASE "Ｖ敏感"
		LOCALS = VSense
	CASE "Ａ敏感"
		LOCALS = ASense
	CASE "Ｂ敏感"
		LOCALS = BSense
	CASE "Ｍ敏感"
		LOCALS = MSense
	CASE "スカート"
		LOCALS = Skirts
	CASE "パンツ"
		LOCALS = Panties
	CASE "桃色の風"
		LOCALS = Pink Wind
	CASE "台風"
		LOCALS = Typhoon
	CASE "猛吹雪"
		LOCALS = Blizzard

	CASE "晴れ"
		LOCALS = Sunny
	CASE "快晴"
		LOCALS = Fair
	CASE "薄曇"
		LOCALS = Overcast
	CASE "曇り"
		LOCALS = Cloudy
	CASE "雨"
		LOCALS = Rain
	CASE "大雨"
		LOCALS = Downpour
	CASE "霧雨"
		LOCALS = Drizzle
	CASE "霧"
		LOCALS = Foggy
	CASE "雪"
		LOCALS = Snowy
	CASE "吹雪"
		LOCALS = Snowstorm
	CASE "細雪"
		LOCALS = Light Snowfall
	CASE "霧雪"
		LOCALS = Snow Grains
	CASE "あられ"
		LOCALS = Hail
	CASE "みぞれ"
		LOCALS = Sleet
ENDSELECT
RETURNF LOCALS

@CHILD_WEATHER(ARGS)
#FUNCTIONS
SELECTCASE ARGS
	CASE "桃色の風"
		LOCALS = day when a pink wind blew through Gensokyo
	CASE "台風"
		LOCALS = day when a typhoon raged through Gensokyo
	CASE "猛吹雪"
		LOCALS = day when a blizzard raged in Gensokyo
	CASE "晴れ"
		LOCALS = sunny day
	CASE "快晴"
		LOCALS = day with clear weather
	CASE "薄曇"
		LOCALS = day with some overcast
	CASE "曇り"
		LOCALS = cloudy day
	CASE "雨"
		LOCALS = rainy day
	CASE "大雨"
		LOCALS = day when it rained cats and dogs
	CASE "霧雨"
		LOCALS = drizzly day
	CASE "霧"
		LOCALS = foggy day
	CASE "雪"
		LOCALS = snowy day
	CASE "吹雪"
		LOCALS = day when a snowstorm raged in Gensokyo
	CASE "細雪"
		LOCALS = day when it barely snowed
	CASE "霧雪"
		LOCALS = day with snow grains
	CASE "あられ"
		LOCALS = day it hailed
	CASE "みぞれ"
		LOCALS = day with sleet
	CASE "たしか晴れ"
		LOCALS = what must have been a sunny day
ENDSELECT
RETURNF LOCALS

;*************************************************
;Convenient checking functions
;*************************************************

;-------------------------------------------------
;ARG:0番のキャラにＶがあるかどうかを返す関数
;reminder: getbit TALENT:ARG:性別, 0 <- has vagina (futa, female), 1 <- has penis (male, futa)
;again shithead (me): 性別 = 1 - female, 性別 = 2 - male, 性別 = 3 - futa
;-------------------------------------------------
@HAS_VAGINA(ARG:0)
#FUNCTION
RETURNF GETBIT(TALENT:ARG:性別, 0)

@IS_VIRGIN(ARG:0)
#FUNCTION
RETURNF TALENT:(ARG:0):処女

;-------------------------------------------------
;ARG:0番のキャラがベースとして男扱いなら1を返す関数
;-------------------------------------------------
@IS_MALE(ARG:0)
#FUNCTION
RETURNF TALENT:ARG:性別 == 2

@IS_DOUTEI(ARG:0)
#FUNCTION
RETURNF !TALENT:ARG:非童貞 && HAS_PENIS(ARG)

;-------------------------------------------------
;ARG:0番のキャラがベースとして女扱いなら1を返す関数
;-------------------------------------------------
@IS_FEMALE(ARG:0)
#FUNCTION
RETURNF !IS_MALE(ARG:0)

@IS_HERM(ARG:0)
#FUNCTION
RETURNF TALENT:ARG:性別 == 3

;-------------------------------------------------
;ARG:0番のキャラとARG:1番のキャラが同性かどうかを返す関数
;-------------------------------------------------
@IS_SAMESEX(ARG:0, ARG:1)
#FUNCTION
RETURNF IS_MALE(ARG:0) == IS_MALE(ARG:1)

;-------------------------------------------------
;キャラARG:0のバストサイズを数値に変換する
;-2:絶壁～2:爆乳
;-------------------------------------------------
@GET_BUSTSIZE(ARG:0)
#FUNCTION
SIF IS_MALE(ARG:0)
	RETURNF -2

RETURNF TALENT:ARG:バストサイズ

;FileName_COMMON.ERB ------------------------------- Rev1.01
;TARGET性格強度判定
;CALL		USER
;ARG		ターゲットNO
;RETURN		性格強度（＋強気, －弱気）
;COMMENT	+3以上で強気、-1以下で弱気くらいかな
;-----------------------------------------------------------
@CHARA_DISPOS(T_NO)
#FUNCTION
#DIM T_NO
LOCAL = 0
FOR LOCAL:1,10,30
	SIF TALENT:T_NO:(LOCAL:1) == 0
		CONTINUE
	SELECTCASE LOCAL:1
		;Skip
		CASE 20,25
			;Do Nothing
		;Boolean_Talent_True
		CASE 26
			LOCAL += TALENT:T_NO:(LOCAL:1)
		;Boolean_Talent_False
		CASE 21,22
			LOCAL -= TALENT:T_NO:(LOCAL:1)
		;Else_Talent
		CASEELSE
			LOCAL += TALENT:T_NO:(LOCAL:1)
	ENDSELECT
NEXT
RETURNF LOCAL

;-------------------------------------------------
;check if character ARG:0 has childish properties
;by default check both mind and body, where mind is just an infantile and body is just a midget (perfectly legal officer I swear on me mum)
;-------------------------------------------------
@IS_CHILD(ARG:0, ARGS:0)
#FUNCTION
SELECTCASE ARGS
	CASE "age"
		RETURNF TALENT:(ARG:0):年齢 < 0
	CASE "mind"
		RETURNF TALENT:(ARG:0):幼稚
	CASE "body"
		RETURNF GROUPMATCH(TALENT:(ARG:0):体型, -1, -2)
CASEELSE
	RETURNF (TALENT:(ARG:0):年齢 < 0 || TALENT:(ARG:0):幼稚) && GROUPMATCH(TALENT:(ARG:0):体型, -1, -2)
ENDSELECT

;A more complete semen description
;Does not work when the player is completely alone, has to have two characters as input
;ARG - whose semen it is
;ARG:1 - who the "target" is
@SAMEN_DESCRIPTION_FULL(ARG,ARG:1)
#FUNCTIONS
VARSET LOCALS

@IS_ARE_PANTIES(ARGS)
#FUNCTIONS
IF PLURAL_PANTIES(ARGS)
	RETURNF "are"
ELSE
	RETURNF "is"
ENDIF

@IT_THEM_PANTIES(ARGS)
#FUNCTIONS
IF PLURAL_PANTIES(ARGS)
	RETURNF "them"
ELSE
	RETURNF "it"
ENDIF

@IT_THEY_PANTIES(ARGS)
#FUNCTIONS
IF PLURAL_PANTIES(ARGS)
	RETURNF "they"
ELSE
	RETURNF "it"
ENDIF

@PLURAL_PANTIES(ARGS)
#FUNCTION
RETURNF STRCOUNT(ARGS, "bloomers|boxers|trunks|panties|scanties|drawers|spats")

@ALCOHOL_FACE_TR(ARG)
#FUNCTIONS
SIF BASE:ARG:酒気 <= 2
	RETURNF "  Sober "
SELECTCASE BASE:ARG:酒気
	CASE IS > (MAXBASE:ARG:酒気 / 10) * 8
		RETURNF " Wasted "
;	CASE IS > (MAXBASE:ARG:酒気 / 10) * 7
;		RETURNF "へべれけ"
	CASE IS > (MAXBASE:ARG:酒気 / 10) * 5
		RETURNF "  Drunk "
	CASE IS <= (MAXBASE:ARG:酒気 / 10) * 5
		RETURNF "  Tipsy "
ENDSELECT

@MESSAGE_脱衣下下着_TR
;get panty name
LOCALS =
IF EQUIP:TARGET:下半身下着２ && GET_INT(TARGET, "下半身下着_ずらし可能", EQUIP:TARGET:下半身下着２, "透ける(前)")
	LOCALS = %PANTSNAME(EQUIP:TARGET:下半身下着２, TARGET)%
ELSEIF EQUIP:TARGET:下半身下着１ && GET_INT(TARGET, "下半身下着_ずらし不可", EQUIP:TARGET:下半身下着１, "透ける(前)")
	LOCALS = %SHOW_下半身下着(TARGET, 3)%
ENDIF

IF PALAM:TARGET:潤滑 >= PALAMLV:4
	PRINTFORM %CALLNAME:TARGET%'s pussy is dripping wet
	IF STRLENS(LOCALS) && RAND:2
		PRINTFORM , and %HIS_HER(TARGET)% %LOCALS% %IS_ARE_PANTIES(LOCALS)% completely drenched, being noticeably heavy with all the %FSYN("juice:plu")%...
	ELSE
		PRINTFORM , creating a trail traveling down %HIS_HER(TARGET)% inner thigh...
	ENDIF
ELSEIF PALAM:TARGET:潤滑 >= PALAMLV:3
	IF STRLENS(LOCALS) && RAND:2
		PRINTFORM When %CALLNAME:TARGET%\@ FLAG:70 ?'s %LOCALS% %IS_ARE_PANTIES(LOCALS)% pulled down # %" "%pulls down %HIS_HER(TARGET)% %LOCALS% \@, a string of sticky liquid stretches between %IT_THEM_PANTIES(LOCALS)% and %HIS_HER(TARGET)% pussy...
	ELSE
		PRINTFORM %CALLNAME:TARGET%'s crotch is completely drenched...
	ENDIF
ELSEIF PALAM:TARGET:潤滑 >= PALAMLV:2
	PRINTFORM %CALLNAME:TARGET%'s crotch is slick with wetness...
ELSE
	PRINTFORM %CALLNAME:TARGET%'s %SLIT(TARGET)% is %SPLIT_G(@"revealed:completely %SPLIT_G("bare:exposed")%")%...
ENDIF
CALL PRINT_BREAK,,"wait"

SELECTCASE CFLAG:TARGET:妊娠経過日数
	CASE IS >= 60
		IF TALENT:TARGET:体型 == -2
			PRINTFORMW %CALLNAME:TARGET%'s gravid belly is stretched taut and looks unbalanced on %HIS_HER(TARGET)% immature body.
		ELSE
			PRINTFORMW %CALLNAME:TARGET%'s gravid belly is stretched taut.
		ENDIF
	CASE IS >= 40
		PRINTFORMW %CALLNAME:TARGET%'s body has filled out a bit and %HIS_HER(TARGET)% swollen belly makes %HIS_HER(TARGET)% pregnancy obvious.
	CASE IS >= 30
		PRINTFORMW %CALLNAME:TARGET% looks more pregnant each day, now that %HIS_HER(TARGET)% belly has finally begun to swell.
	CASE IS >= 20
		PRINTFORMW %CALLNAME:TARGET%'s belly has only a small bump, but the thought of the child growing inside %HIM_HER(TARGET)% fills %PARSE("you")% with pride.
ENDSELECT

@RACE_TR(ARGS)
#FUNCTIONS
SELECTCASE ARGS
	CASE "町娘"
		LOCALS = village girl
	CASE "人妻"
		LOCALS = married woman
	CASE "妖精"
		LOCALS = fairy
	CASE "イナバ"
		LOCALS = Inaba
	CASE "河童"
		LOCALS = Kappa
	CASE "白狼天狗"
		LOCALS = White Wolf Tengu
	CASE "メイド妖精"
		LOCALS = Fairy Maid
	CASE "ゾンビフェアリー"
		LOCALS = Zombie Fairy
	CASE "鬼"
		LOCALS = Oni
	CASE "化け狸"
		LOCALS = Bakedanuki
	CASE "化け狐"
		LOCALS = Bakegitsune
	CASE "化け猫"
		LOCALS = Bakeneko
	CASE "玉兎"
		LOCALS = Moon Rabbit
	CASE "茨たぬき"
		LOCALS = Ibara Tanuki
	CASEELSE
		LOCALS = %ARGS%
ENDSELECT
RETURNF LOCALS

@MOB_STATE_TR(ARGS)
#FUNCTIONS
SELECTCASE ARGS
	CASE "無様にも返り討ちにされ、膣内射精された"
		LOCALS = Used to be wild, but had her vagina creampied.
	CASE "無様にも返り討ちにされ、ハメ倒されて膣内射精された"
		LOCALS = Used to be wild, but got fucked to submission, and creampied in her vagina.
	CASE "無様にも返り討ちにされ、ハメ倒されてイかされ膣内射精された"
		LOCALS = Used to be wild, but got fucked to submission, forced to orgasm over and over, and creampied in her vagina.
	CASE "無様にも返り討ちにされ、ハメ倒されてイキ狂わされ膣内射精された"
		LOCALS = Used to be wild, but got fucked to submission while orgasming herself silly, and to top it off, creampied in her vagina.
	CASE "無様にも返り討ちにされ、散々ハメ倒されて膣内射精された"
		LOCALS = Used to be wild, but got fucked like no tomorrow, and creampied in her vagina.
	CASE "無様にも返り討ちにされ、散々ハメ倒されてイかされ膣内射精された"
		LOCALS = Used to be wild, but got fucked senseless, forced to orgasm over and over, and creampied in her vagina.
	CASE "無様にも返り討ちにされ、散々ハメ倒されてイキ狂わされ膣内射精された"
		LOCALS = Used to be wild, but got fucked the living daylights out of while orgasming herself silly, and to top it off, creampied in her vagina.
	CASE "無様にも返り討ちにされ、たっぷりと精液を注ぎ込まれた"
		LOCALS = Used to be wild, but had her vagina thoroughly inseminated.
	CASE "無様にも返り討ちにされ、処女を奪われた"
		LOCALS = Used to be wild, but had her virginity taken from her.
	CASE "無様にも返り討ちにされ、処女を奪われた挙句、膣内射精された"
		LOCALS = Used to be wild, but had her virginity taken from her, and to top it off, creampied in her vagina.
	CASE "無様にも返り討ちにされ、処女を奪われた挙句、ハメ倒されて膣内射精された"
		LOCALS = Used to be wild, but had her virginity taken from her, got fucked to submission, and to top it off, creampied in her vagina.
	CASE "無様にも返り討ちにされ、処女を奪われた挙句、ハメ倒されてイかされ膣内射精された"
		LOCALS = Used to be wild, but had her virginity taken from her, got fucked to submission, forced to orgasm over and over, and to top it off, creampied in her vagina.
	CASE "無様にも返り討ちにされ、処女を奪われた挙句、ハメ倒されてイキ狂わされ膣内射精された"
		LOCALS = Used to be wild, but had her virginity taken from her, got fucked to submission while orgasming herself silly, and to top it off, creampied in her vagina.
	CASE "無様にも返り討ちにされ、処女を奪われた挙句、散々ハメ倒されて膣内射精された"
		LOCALS = Used to be wild, but had her virginity taken from her, got fucked like no tomorrow, and to top it off, creampied in her vagina.
	CASE "無様にも返り討ちにされ、処女を奪われた挙句、散々ハメ倒されてイかされ膣内射精された"
		LOCALS = Used to be wild, but had her virginity taken from her, got fucked senseless, forced to orgasm over and over, and to top it off, creampied in her vagina.
	CASE "無様にも返り討ちにされ、処女を奪われた挙句、散々ハメ倒されてイキ狂わされ膣内射精された"
		LOCALS = Used to be wild, but had her virginity taken from her, got fucked the living daylights out of while orgasming herself silly, and to top it off, creampied in her vagina.
	CASE "無様にも返り討ちにされ、処女を奪われた挙句、たっぷりと精液を注ぎ込まれた"
		LOCALS = Used to be wild, but had her virginity taken from her, and had her vagina thoroughly inseminated.
	CASE "無様にも返り討ちにされ、アナル処女を奪われた"
		LOCALS = Used to be wild, but had her anal virginity taken from her.
	;these are unused pretty sure, talks about vagina creampie too
	CASE "無様にも返り討ちにされ、アナル処女を奪われた挙句、膣内射精された"
		LOCALS = Used to be wild, but had her anal virginity taken from her and been creampied.
	CASE "無様にも返り討ちにされ、アナル処女を奪われた挙句、ハメ倒されて膣内射精された"
		LOCALS = Used to be wild, but had her anal virginity taken from her and been creampied lovingly.
	CASE "無様にも返り討ちにされ、アナル処女を奪われた挙句、ハメ倒されてイかされ膣内射精された"
		LOCALS = Used to be wild, but had her anal virginity taken from her and been creampied against her will.
	CASE "無様にも返り討ちにされ、アナル処女を奪われた挙句、ハメ倒されてイキ狂わされ膣内射精された"
		LOCALS = Used to be wild, but had her anal virginity taken from her and been creampied against her will until she went crazy.
	CASE "無様にも返り討ちにされ、アナル処女を奪われた挙句、散々ハメ倒されて膣内射精された"
		LOCALS = Used to be wild, but had her anal virginity taken from her and been thoroughly creampied lovingly.
	CASE "無様にも返り討ちにされ、アナル処女を奪われた挙句、散々ハメ倒されてイかされ膣内射精された"
		LOCALS = Used to be wild, but had her anal virginity taken from her and been thoroughly creampied against her will.
	CASE "無様にも返り討ちにされ、アナル処女を奪われた挙句、散々ハメ倒されてイキ狂わされ膣内射精された"
		LOCALS = Used to be wild, but had her anal virginity taken from her and been thoroughly creampied against her will until she went crazy.
	;------------
	CASE "無様にも返り討ちにされ、アナル処女を奪われた挙句、たっぷりと精液を注ぎ込まれた"
		LOCALS = Used to be wild, but had her anal virginity taken from her, and had her anus thoroughly inseminated.
	CASE "無様にも返り討ちにされ今はもう大人しい"
		LOCALS = Used to be wild, but had the tables turned on her in a spectacularly brutal way, and now she's all tamed.
	CASEELSE
		LOCALS = %ARGS%
ENDSELECT
RETURNF LOCALS

@OPTIONS_TR(ARGS)
#FUNCTIONS
SELECTCASE ARGS
CASE "妊娠の有無 ※基本OFF"
	LOCALS = Enable Pregnancy
CASE "子供の性別"
	LOCALS = Children's gender
CASE "子供の描写"
	LOCALS = Portrayal of children 
CASE "住み込みイベント"
	LOCALS = Move-in events
CASE "宴会の発生"
	LOCALS = Banquet Events
CASE "相手からの告白"
	LOCALS = Others can confess
CASE "セフレ系から恋慕系への陥落変化"
	LOCALS = Enable Love despite【Sex Friend】or【Lust】
CASE "イベントによる[無知]喪失"
	LOCALS = Possible to lose【Ignorant】through daily event
CASE "テキスト設定"
	LOCALS = Text Settings
CASE "口上色"
	LOCALS = Colored Dialog
CASE "汚れ度表示"
	LOCALS = Display Room Dirtiness
CASE "カウンターの地の文"
	LOCALS = Counter Text
CASE "おっぱいテキスト"
	LOCALS = Breast Related Text
CASE "好意/理性の壁の表示"
	LOCALS = Reason/favor stars display
CASE "能力表示の表記"
	LOCALS = Ability Page Button Display Type
CASE "ターン毎のABLUP"
	LOCALS = Level up abilities only at the end of the day
CASE "ファーストキスの記録"
	LOCALS = First Kiss history settings
CASE "移動時立ち止まり"
	LOCALS = Input when encountering characters while moving
CASE "遭遇時の依頼提示"
	LOCALS = Display request when running into characters
CASE "消耗品の自動購入"
	LOCALS = Automatically Re-Purchase Consumable Items
CASE "自動時止め移動"
	LOCALS = Automatic TSP-usage
CASE "押し倒されなくなる判定"
	LOCALS = Use ability checks to determine if player gets pushed down
CASE "注意札使用"
	LOCALS = Allow Warning Talismans
CASE "来訪モード"
	LOCALS = Enable Visitors
CASE "脱衣コマンドの扱い"
	LOCALS = Undressing settings
CASE "時間停止脱衣コマンドの扱い"
	LOCALS = Steal underwear when undressing during time stop
CASE "一部キャラのニーソックス着用"
	LOCALS = Allow characters to wear knee-socks
CASE "エッチな下着の追加"
	LOCALS = Add lingerie to Gensokyo
CASE "パンツ収集状況表示"
	LOCALS = Panty collection status display
CASE "地図の表示タイプ"
	LOCALS = Map display type
CASE "カラーマップ + 動画モード"
	LOCALS = Color + Moving
CASE "カラーマップ"
	LOCALS = Color
CASE "クラシック"
	LOCALS = Normal
CASE "キャラリストの表示順"
	LOCALS = Display order in character list
CASE "放尿とおもらし癖の有効化"
	LOCALS = Enable Urination
CASE "採集時の再抽選機能"
	LOCALS = Allow to re-roll the result when foraging
CASE "有効"
	LOCALS = On
CASE "無効"
	LOCALS = Off
CASE "原作順"
	LOCALS = ZUN order
CASE "ＴＷ順"
	LOCALS = TW order
CASE "妊娠する ※何かあったら自己責任で"
	LOCALS = On
CASE "妊娠しない"
	LOCALS = Off
CASE "ランダム"
	LOCALS = Random
CASE "女の子"
	LOCALS = Female
CASE "男の子"
	LOCALS = Male
CASE "あり"
	LOCALS = Yes
CASE "なし"
	LOCALS = No
CASE "なし"
	LOCALS = No
CASE "あり"
	LOCALS = Yes
CASE "あり"
	LOCALS = Yes
CASE "なし"
	LOCALS = No
CASE "告白してこない"
	LOCALS = No
CASE "告白してくる"
	LOCALS = Yes
CASE "変化する"
	LOCALS = Yes
CASE "変化しない"
	LOCALS = No
CASE "喪失しない"
	LOCALS = No
CASE "喪失する"
	LOCALS = Yes
CASE "口上＋情景テキスト"
	LOCALS = Dialog + Description Text
CASE "情景テキストのみ"
	LOCALS = Description only
CASE "テキストを表示しない"
	LOCALS = No text
CASE "あり"
	LOCALS = Yes
CASE "なし"
	LOCALS = No
CASE "しない"
	LOCALS = No
CASE "する"
	LOCALS = Yes
CASE "素質で変化する"
	LOCALS = Varies by personality
CASE "変化しない"
	LOCALS = Never varies
CASE "全て固定"
	LOCALS = All fixed
CASE "乳房のみ固定"
	LOCALS = Breast only fixed
CASE "乳首のみ固定"
	LOCALS = Nipple only fixed
CASE "固定しない"
	LOCALS = All random
CASE "短縮する"
	LOCALS = Shorten
CASE "短縮しない"
	LOCALS = Do not shorten
CASE "数字表記"
	LOCALS = Numbers
CASE "記号表記"
	LOCALS = Symbols
CASE "省略する"
	LOCALS = Yes
CASE "省略しない"
	LOCALS = No
CASE "キスのみ・自覚のみ"
	LOCALS = Kiss only・Conscious only
CASE "キスのみ・未自覚あり"
	LOCALS = Kiss only・Unconscious as well
CASE "フェラあり・自覚のみ"
	LOCALS = Fellatio as well・Conscious only
CASE "フェラあり・未自覚あり"
	LOCALS = Fellatio as well・Unconscious as well
CASE "無条件で立ち止まる"
	LOCALS = Always wait
CASE "口上が存在する場合のみ"
	LOCALS = Wait only if there is dialog
CASE "立ち止まらない"
	LOCALS = Do not stop
CASE "表示しない"
	LOCALS = No
CASE "表示する"
	LOCALS = Yes
CASE "する"
	LOCALS = Yes
CASE "しない"
	LOCALS = No
CASE "ＯＦＦ"
	LOCALS = Off
CASE "外出先の散策時のみ"
	LOCALS = ON (When moving between areas)
CASE "拠点内の移動時のみ"
	LOCALS = ON (When moving locally)
CASE "外出先/拠点内両方"
	LOCALS = ON (Always)
CASE "あり"
	LOCALS = Yes
CASE "なし"
	LOCALS = No
CASE "あり"
	LOCALS = Yes
CASE "なし"
	LOCALS = No
CASE "通常"
	LOCALS = Can always visit
CASE "好感度50以下は来訪しない"
	LOCALS = Can only visit if favorability is greater than 50
CASE "陥落したキャラのみ"
	LOCALS = Only fallen characters
CASE "来訪しない"
	LOCALS = Can never visit
CASE "毎回選択"
	LOCALS = Ask every time
CASE "全裸"
	LOCALS = Always strip completely
CASE "半脱ぎ"
	LOCALS = Always unbutton clothes
CASE "毎回選択"
	LOCALS = Ask every time
CASE "常にくすねる"
	LOCALS = Always steal
CASE "常に脱がすだけ"
	LOCALS = Never steal
CASE "あり"
	LOCALS = Yes
CASE "なし"
	LOCALS = No
CASE "追加する"
	LOCALS = Yes
CASE "追加しない"
	LOCALS = No
CASE "未入手でも表示する"
	LOCALS = Show unobtained ones
CASE "未入手は表示しない"
	LOCALS = Do not show unobtained ones
CASEELSE
	LOCALS = %ARGS%
ENDSELECT
RETURNF LOCALS

;-------------------------------------------------
;types characters gradually, original from tohoJ's Flandre dialogue
;also supports change from typed kana to kanji, which probably won't have any practical application in english
;TODO - currently doesn't work properly if the line wasn't empty to begin with
;@KEYTYPING
;変換前の文字列を1文字ずつ順に表示した後でそれを消して変換後の文字列を表示する。奇数は変換前、偶数は変換後。"/"で区切る。
;使用例：CALL KEYTYPING("あくま/悪魔", "W", 2)；あ → あく → あくま → 悪魔
;ARGS：元の文字列
;ARGS:1：入力待ちの有無
;additional flags - d: use dialogue quote marks, dc: use default color for text, l: break the line after output is over, w: break the line and wait
;multiple flags can be used with : as a separator
;ARG：表示速度 (delay after printing each character, smaller - faster) 
;Warning - with extra long delay (>1000) key detection becomes wonky so it's very hard to skip
;ARG:1 - how many characters print at once
;-------------------------------------------------
@KEYTYPING(ARGS, ARGS:1, ARG = 1, ARG:1 = 2)
#DIM LCOUNT, 2
#DIM nInitColor
#DIM nInitRedraw

nInitRedraw = CURRENTREDRAW()
;limit the arguments
SIF ARG <= 0
	ARG = 1
ARG:1 = LIMIT(ARG:1, 1, 9)

;process dialogue flag
SIF SPLIT_CHECK(TOLOWER(ARGS:1), "d")
	ARGS = 「%ARGS%」
;remember color when it's not default, reset the color if flag is set
nInitColor = GETCOLOR()
SIF SPLIT_CHECK(TOLOWER(ARGS:1), "dc")
	RESETCOLOR
	
VARSET LOCALS

REDRAW 0

;"/"で区切る
SPLIT ARGS, "/", LOCALS, LOCAL
IF MESSKIP() ;go here if skipping
	$SKIP
	FOR LCOUNT, 0, LOCAL, 2
		SIF LOCALS:(LCOUNT + 1) == ""
			LOCALS:(LCOUNT + 1) = %LOCALS:LCOUNT%
		IF !LCOUNT
			LOCALS = %LOCALS:(LCOUNT + 1)%
		ELSE
			LOCALS = %LOCALS%%LOCALS:(LCOUNT + 1)%
		ENDIF
	NEXT
ELSE
	;reset left mouse click detection
	GETKEYTRIGGERED 0x01
	;文字列を表示
	FOR LCOUNT, 0, LOCAL, 2
		FOR LCOUNT:1, 0, STRLENS(LOCALS:LCOUNT), ARG:1
			LOCAL:1 = LINECOUNT
			SIF LCOUNT
				PRINTFORM %LOCALS%
			PRINTFORML %SUBSTRING(LOCALS:LCOUNT, 0, LCOUNT:1)%
			IF MESSKIP() || GETKEYTRIGGERED(0x01) ;skip on left click or if text skipping was enabled prior
				CLEARLINE (LINECOUNT - LOCAL:1)
				GOTO SKIP
			ENDIF
			TWAIT ARG, 1
			CLEARLINE (LINECOUNT - LOCAL:1)
		NEXT
		SIF LOCALS:(LCOUNT + 1) == ""
			LOCALS:(LCOUNT + 1) = %LOCALS:LCOUNT%
		IF !LCOUNT
			LOCALS = %LOCALS:(LCOUNT + 1)%
		ELSE
			LOCALS = %LOCALS%%LOCALS:(LCOUNT + 1)%
		ENDIF
	NEXT
ENDIF

;入力待ち
PRINTS LOCALS
SIF SPLIT_CHECK(TOLOWER(ARGS:1), "l")
	PRINTL
SIF SPLIT_CHECK(TOLOWER(ARGS:1), "w")
	PRINTW 
	
SETCOLOR nInitColor
REDRAW nInitRedraw

@PLANT_TR(ARGS)
#FUNCTIONS
SELECTCASE ARGS
CASE "ローター"
	LOCALS = rotor
CASEELSE
	LOCALS = %ARGS%
ENDSELECT
RETURNF LOCALS

@NAME_FIELD_TYPE_TR(ARG)
#FUNCTIONS
LOCALS = 
SIF GETBIT(ARG, 0)
	LOCALS += "[Grasslands]"
SIF GETBIT(ARG, 1)
	LOCALS += "[Flower Garden]"
SIF GETBIT(ARG, 2)
	LOCALS += "[Forest]"
SIF GETBIT(ARG, 3)
	LOCALS += "[Sandy Soil]"
SIF GETBIT(ARG, 4)
	LOCALS += "[Waterfront]"
SIF GETBIT(ARG, 5)
	LOCALS += "[Rocky]"
SIF GETBIT(ARG, 6)
	LOCALS += "[Indoors]"
SIF GETBIT(ARG, 7)
	LOCALS += "[Moon]"
RETURNF LOCALS

@FIX_DIALOGUE_STATUS
FOR LOCAL, 0, CHARANUM
	;edit - reset faulty dialogue switchers only (coming from old saves most likely)

	;don't bother if the value is not tampered with
	SIF !CFLAG:LOCAL:口上セレクタ
		CONTINUE
	;check if the main dialogue still works with it
	TRYCCALLFORM M_KOJO_K{LOCAL}_{CFLAG:LOCAL:口上セレクタ}
	CATCH
		CFLAG:LOCAL:口上セレクタ = 0
	ENDCATCH
NEXT

;searches for currently used dialogue and correctly sets color
@SET_KOJO_COLOR(ARG = -1)
SIF ARG == -1
	ARG = TARGET
	
RESULTS =
IF CFLAG:ARG:口上セレクタ
	TRYCALLFORM M_KOJO_K{NO:ARG}_{CFLAG:ARG:口上セレクタ}
ELSE
	TRYCALLFORM M_KOJO_K{NO:ARG}
ENDIF
SIF FLAG:口上色
	TRYCALLFORM M_KOJO%RESULTS%_COLOR_K{NO:ARG}
	
;warning for the faulty cflag value
@EVENTLOAD
#LATER

LOCALS '= ""
LOCAL:1 = 0
FOR LOCAL, 1, CHARANUM
	;don't bother if the value is not tampered with
	SIF !CFLAG:LOCAL:口上セレクタ
		CONTINUE
	;check if the main dialogue still works with it
	TRYCCALLFORM M_KOJO_K{LOCAL}_{CFLAG:LOCAL:口上セレクタ}
	CATCH
		LOCAL:1 ++
		LOCALS += CALLNAME:LOCAL + "、"
	ENDCATCH
NEXT
IF LOCAL:1
	CALL COLORMESSAGE("Warning! Abnormal value for the dialogue selector detected!",C_RED,2,1)
	PRINTFORML Number of characters: {LOCAL:1}
	PRINTFORML Affected characters: %LIST_IN_STRING(LOCALS)%
	CALL COLORMESSAGE("Make sure to run [500] Update option from the main menu first!",C_RED,2,1)
ENDIF
	

;fix unset dick size tweak and etc
@EVENTLOAD
#LATER
FOR LOCAL, 0, CHARANUM
	SIF !HAS_PENIS(LOCAL)
		CONTINUE
	IF TALENT:LOCAL:形状 <= 0 || MAXBASE:LOCAL:精力 <= 0 || MAXBASE:LOCAL:勃起 <= 0
		CALL COLORMESSAGE(@"Fixing incorrect penis properties for %CALLNAME:LOCAL%...",C_YELLOW,1,1)
		SIF TALENT:LOCAL:形状 <= 0 
			TALENT:LOCAL:形状 = 3
		SIF MAXBASE:LOCAL:勃起 <= 0
			MAXBASE:LOCAL:勃起 = 1500
		SIF MAXBASE:LOCAL:精力 <= 0
			MAXBASE:LOCAL:精力 = 1000
	ENDIF
	IF LOCAL == MASTER && MAXBASE:LOCAL:精力 == 1000 ;give back bonus vig the game owes you if you're at base VIG
		SIF GETBIT(FLAG:好感度ボーナス取得状況, 7)
			MAXBASE:LOCAL:精力 += 100
		SIF GETBIT(FLAG:パンツボーナス取得状況, 7)
			MAXBASE:LOCAL:精力 += 100
		SIF GETBIT(FLAG:陥落ボーナス取得状況, 6)
			MAXBASE:LOCAL:精力 += 100
		SIF GETBIT(FLAG:陥落ボーナス取得状況, 8)
			MAXBASE:LOCAL:精力 += 100
		MAXBASE:MASTER:精力 += nVigIncrease ;addition custom code
	ENDIF
NEXT

@CHARASORT_EX_TR
#FUNCTION
;the only issue here is that th98 characters start from range 201+, but it doesn't seem to be a big deal here?
VARSET RESULT, -1 ;set to -1 to include player character in the list
RESULT = MASTER, [[霊夢]], [[魔理沙]], [[ルーミア]], [[大妖精]], [[チルノ]], [[美鈴]], [[小悪魔]], [[パチュリー]], [[咲夜]], [[レミリア]], [[フラン]], [[レティ]], [[橙]], [[アリス]], [[リリーＷ]], [[リリーＢ]], [[リリカ]], [[メルラン]], [[ルナサ]], [[妖夢]], [[幽々子]], [[藍]], [[紫]], [[萃香]], [[リグル]], [[ミスティア]], [[慧音]], [[てゐ]], [[鈴仙]], [[永琳]], [[輝夜]], [[妹紅]], [[文]], [[メディスン]], [[幽香]], [[小町]], [[映姫]], [[静葉]], [[穣子]], [[雛]], [[にとり]], [[椛]], [[早苗]], [[神奈子]], [[諏訪子]], [[サニー]], [[ルナ]], [[スター]], [[阿求]], [[蓮子]], [[メリー]], [[衣玖]], [[天子]], [[豊姫]], [[依姫]], [[レイセン]], [[キスメ]], [[ヤマメ]], [[パルスィ]], [[勇儀]], [[さとり]], [[お燐]], [[お空]], [[こいし]], [[朱鷺子]], [[ナズーリン]], [[小傘]], [[一輪]], [[ムラサ]], [[星]], [[白蓮]], [[ぬえ]], [[はたて]], [[華扇]], [[響子]], [[芳香]], [[青娥]], [[屠自古]], [[布都]], [[神子]], [[マミゾウ]], [[小鈴]], [[こころ]], [[わかさぎ姫]], [[蛮奇]], [[影狼]], [[弁々]], [[八橋]], [[正邪]], [[針妙丸]], [[雷鼓]], [[菫子]], [[清蘭]], [[鈴瑚]], [[ドレミー]], [[サグメ]], [[クラウンピース]], [[純狐]], [[ヘカーティア]], [[ラルバ]], [[ネムノ]], [[あうん]], [[成美]], [[舞]], [[里乃]], [[隠岐奈]], [[女苑]], [[紫苑]], [[瓔花]], [[潤美]], [[久侘歌]], [[八千慧]], [[磨弓]], [[袿姫]], [[早鬼]], [[美宵]], [[ミケ]], [[たかね]], [[駒草]], [[魅須丸]], [[典]], [[龍]], [[千亦]], [[百々世]], [[尤魔]],  [[魅魔]], [[里香]], [[明羅]], [[エレン]], [[カナ]], [[理香子]], [[ちゆり]], [[夢美]], [[る～こと]], [[くるみ]], [[エリー]], [[夢月]], [[幻月]], [[ルイズ]], [[ユキ]], [[マイ]], [[夢子]], [[神綺]], [[モブ子]]

;create a list of options from branch mods as to not clog the option list
@OPTION_MOD
#DIM nLineCnt_Head 
FOR LOCAL, 0, 100
PRINTL
NEXT
CUSTOMDRAWLINE ＊
PRINTFORML Modded Options
CUSTOMDRAWLINE ＊
nLineCnt_Head = LINECOUNT
REDRAW 0
DO
	SIF LINECOUNT - nLineCnt_Head > 0
		CLEARLINE LINECOUNT - nLineCnt_Head
		
	FOR LOCAL, 0, 50
		TRYCALLFORM CUSTOM_OPTION_{LOCAL}
	NEXT
	
	CALL EQUATE_LINE, (nLineCnt_Head + 20) ;tweak when there's more options
	DRAWLINE
	PRINTFORML [999] - Return
	INPUT
	SELECTCASE RESULT
		CASE 999
			RETURN
	CASEELSE
		TRYCALLFORM CUSTOM_OPTION_RESULT_{RESULT}
	ENDSELECT
LOOP 1
